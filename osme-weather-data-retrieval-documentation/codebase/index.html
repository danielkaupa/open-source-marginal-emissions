
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://danielkaupa.github.io/open-source-marginal-emissions/osme-weather-data-retrieval-documentation/codebase/">
      
      
        <link rel="prev" href="../quickstart/">
      
      
        <link rel="next" href="../../osme-grid-data-retrieval-documentation/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.23">
    
    
      
        <title>Codebase - Open Source Marginal Emissions — Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#codebase-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Open Source Marginal Emissions — Docs" class="md-header__button md-logo" aria-label="Open Source Marginal Emissions — Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Open Source Marginal Emissions — Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Codebase
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_1">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/danielkaupa/open-source-marginal-emissions" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    danielkaupa/open-source-marginal-emissions
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  
  Overview

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
  Packages

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Open Source Marginal Emissions — Docs" class="md-nav__button md-logo" aria-label="Open Source Marginal Emissions — Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Open Source Marginal Emissions — Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/danielkaupa/open-source-marginal-emissions" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    danielkaupa/open-source-marginal-emissions
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Overview
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction to this Repository
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CORE_CONCEPTS_AND_DEFINITIONS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Core Concepts and Definitions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PROJECT_ROADMAP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Project Roadmap
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ACKNOWLEDGEMENTS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Acknowledgements
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Packages
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Packages
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Weather Data Retrieval
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Weather Data Retrieval
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Codebase
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Codebase
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#weather_data_retrieval.runner" class="md-nav__link">
    <span class="md-ellipsis">
      runner
    </span>
  </a>
  
    <nav class="md-nav" aria-label="runner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.runner.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.runner.run_batch_from_config" class="md-nav__link">
    <span class="md-ellipsis">
      run_batch_from_config
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#weather_data_retrieval.io.cli" class="md-nav__link">
    <span class="md-ellipsis">
      cli
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cli">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.io.cli.parse_args" class="md-nav__link">
    <span class="md-ellipsis">
      parse_args
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.io.cli.run_prompt_wizard" class="md-nav__link">
    <span class="md-ellipsis">
      run_prompt_wizard
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#weather_data_retrieval.io.config_loader" class="md-nav__link">
    <span class="md-ellipsis">
      config_loader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="config_loader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.io.config_loader.load_and_validate_config" class="md-nav__link">
    <span class="md-ellipsis">
      load_and_validate_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.io.config_loader.load_config" class="md-nav__link">
    <span class="md-ellipsis">
      load_config
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#weather_data_retrieval.io.prompts" class="md-nav__link">
    <span class="md-ellipsis">
      prompts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="prompts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.io.prompts.read_input" class="md-nav__link">
    <span class="md-ellipsis">
      read_input
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.io.prompts.say" class="md-nav__link">
    <span class="md-ellipsis">
      say
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.io.prompts.prompt_data_provider" class="md-nav__link">
    <span class="md-ellipsis">
      prompt_data_provider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.io.prompts.prompt_dataset_short_name" class="md-nav__link">
    <span class="md-ellipsis">
      prompt_dataset_short_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.io.prompts.prompt_cds_url" class="md-nav__link">
    <span class="md-ellipsis">
      prompt_cds_url
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.io.prompts.prompt_cds_api_key" class="md-nav__link">
    <span class="md-ellipsis">
      prompt_cds_api_key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.io.prompts.prompt_save_directory" class="md-nav__link">
    <span class="md-ellipsis">
      prompt_save_directory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.io.prompts.prompt_date_range" class="md-nav__link">
    <span class="md-ellipsis">
      prompt_date_range
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.io.prompts.prompt_coordinates" class="md-nav__link">
    <span class="md-ellipsis">
      prompt_coordinates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.io.prompts.prompt_variables" class="md-nav__link">
    <span class="md-ellipsis">
      prompt_variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.io.prompts.prompt_skip_overwrite_files" class="md-nav__link">
    <span class="md-ellipsis">
      prompt_skip_overwrite_files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.io.prompts.prompt_parallelisation_settings" class="md-nav__link">
    <span class="md-ellipsis">
      prompt_parallelisation_settings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.io.prompts.prompt_retry_settings" class="md-nav__link">
    <span class="md-ellipsis">
      prompt_retry_settings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.io.prompts.prompt_continue_confirmation" class="md-nav__link">
    <span class="md-ellipsis">
      prompt_continue_confirmation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#weather_data_retrieval.sources.cds_era5" class="md-nav__link">
    <span class="md-ellipsis">
      cds_era5
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cds_era5">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.sources.cds_era5.prepare_cds_download" class="md-nav__link">
    <span class="md-ellipsis">
      prepare_cds_download
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.sources.cds_era5.execute_cds_download" class="md-nav__link">
    <span class="md-ellipsis">
      execute_cds_download
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.sources.cds_era5.download_cds_month" class="md-nav__link">
    <span class="md-ellipsis">
      download_cds_month
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.sources.cds_era5.plan_cds_months" class="md-nav__link">
    <span class="md-ellipsis">
      plan_cds_months
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.sources.cds_era5.orchestrate_cds_downloads" class="md-nav__link">
    <span class="md-ellipsis">
      orchestrate_cds_downloads
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#weather_data_retrieval.sources.open_meteo" class="md-nav__link">
    <span class="md-ellipsis">
      open_meteo
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.data_validation" class="md-nav__link">
    <span class="md-ellipsis">
      data_validation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="data_validation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.data_validation.normalize_input" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_input
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.data_validation.format_duration" class="md-nav__link">
    <span class="md-ellipsis">
      format_duration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.data_validation.format_coordinates_nwse" class="md-nav__link">
    <span class="md-ellipsis">
      format_coordinates_nwse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.data_validation.month_days" class="md-nav__link">
    <span class="md-ellipsis">
      month_days
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.data_validation.validate_data_provider" class="md-nav__link">
    <span class="md-ellipsis">
      validate_data_provider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.data_validation.validate_dataset_short_name" class="md-nav__link">
    <span class="md-ellipsis">
      validate_dataset_short_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.data_validation.validate_cds_api_key" class="md-nav__link">
    <span class="md-ellipsis">
      validate_cds_api_key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.data_validation.validate_directory" class="md-nav__link">
    <span class="md-ellipsis">
      validate_directory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.data_validation.validate_date" class="md-nav__link">
    <span class="md-ellipsis">
      validate_date
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.data_validation.parse_date_with_defaults" class="md-nav__link">
    <span class="md-ellipsis">
      parse_date_with_defaults
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.data_validation.clamp_era5_available_end_date" class="md-nav__link">
    <span class="md-ellipsis">
      clamp_era5_available_end_date
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.data_validation.validate_coordinates" class="md-nav__link">
    <span class="md-ellipsis">
      validate_coordinates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.data_validation.validate_variables" class="md-nav__link">
    <span class="md-ellipsis">
      validate_variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.data_validation.validate_existing_file_action" class="md-nav__link">
    <span class="md-ellipsis">
      validate_existing_file_action
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.data_validation.validate_config" class="md-nav__link">
    <span class="md-ellipsis">
      validate_config
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.file_management" class="md-nav__link">
    <span class="md-ellipsis">
      file_management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="file_management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.file_management.generate_filename_hash" class="md-nav__link">
    <span class="md-ellipsis">
      generate_filename_hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.file_management.find_existing_month_file" class="md-nav__link">
    <span class="md-ellipsis">
      find_existing_month_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.file_management.estimate_era5_monthly_file_size" class="md-nav__link">
    <span class="md-ellipsis">
      estimate_era5_monthly_file_size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.file_management.estimate_cds_download" class="md-nav__link">
    <span class="md-ellipsis">
      estimate_cds_download
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.file_management.expected_save_path" class="md-nav__link">
    <span class="md-ellipsis">
      expected_save_path
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.logging" class="md-nav__link">
    <span class="md-ellipsis">
      logging
    </span>
  </a>
  
    <nav class="md-nav" aria-label="logging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.logging.build_download_summary" class="md-nav__link">
    <span class="md-ellipsis">
      build_download_summary
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.logging.setup_logger" class="md-nav__link">
    <span class="md-ellipsis">
      setup_logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.logging.log_msg" class="md-nav__link">
    <span class="md-ellipsis">
      log_msg
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.logging.create_final_log_file" class="md-nav__link">
    <span class="md-ellipsis">
      create_final_log_file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.session_management" class="md-nav__link">
    <span class="md-ellipsis">
      session_management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="session_management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.session_management.SessionState" class="md-nav__link">
    <span class="md-ellipsis">
      SessionState
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SessionState">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.session_management.SessionState.first_unfilled_key" class="md-nav__link">
    <span class="md-ellipsis">
      first_unfilled_key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.session_management.SessionState.summary" class="md-nav__link">
    <span class="md-ellipsis">
      summary
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.session_management.SessionState.to_dict" class="md-nav__link">
    <span class="md-ellipsis">
      to_dict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.session_management.get_cds_dataset_config" class="md-nav__link">
    <span class="md-ellipsis">
      get_cds_dataset_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.session_management.map_config_to_session" class="md-nav__link">
    <span class="md-ellipsis">
      map_config_to_session
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.session_management.ensure_cds_connection" class="md-nav__link">
    <span class="md-ellipsis">
      ensure_cds_connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather_data_retrieval.utils.session_management.internet_speedtest" class="md-nav__link">
    <span class="md-ellipsis">
      internet_speedtest
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Grid Data Retrieval
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Grid Data Retrieval
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../osme-grid-data-retrieval-documentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../osme-grid-data-retrieval-documentation/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../osme-grid-data-retrieval-documentation/codebase/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Codebase
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Data Cleaning and Joining
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Data Cleaning and Joining
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../osme-data-cleaning-and-joining-documentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../osme-data-cleaning-and-joining-documentation/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../osme-data-cleaning-and-joining-documentation/codebase/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Codebase
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Marginal Emissions Modelling
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Marginal Emissions Modelling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../osme-marginal-emissions-modelling-documentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../osme-marginal-emissions-modelling-documentation/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../osme-marginal-emissions-modelling-documentation/codebase/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Codebase
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Shared utilities
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Shared utilities
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../osme-common-utilities-documentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../osme-common-utilities-documentation/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../osme-common-utilities-documentation/codebase/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Codebase
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="codebase-reference">Codebase Reference<a class="headerlink" href="#codebase-reference" title="Permanent link">&para;</a></h1>
<p>This document provides an overview of the main components of the <code>weather_data_retrieval</code> package, detailing the primary modules and their functionalities.</p>


<div class="doc doc-object doc-module">



<h2 id="weather_data_retrieval.runner" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">weather_data_retrieval.runner</span>


<a href="#weather_data_retrieval.runner" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.runner.run" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">run</span>


<a href="#weather_data_retrieval.runner.run" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">run</span><span class="p">(</span>
    <span class="n">config</span><span class="p">,</span>
    <span class="n">run_mode</span><span class="o">=</span><span class="s2">&quot;interactive&quot;</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Unified orchestration entry point for both interactive and automatic runs.
Handles validation, logging, estimation, and download orchestration.</p>
<p>Returns: 0=success, 1=fatal error, 2=some downloads failed.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration dictionary with all required parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>run_mode</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Run mode, either 'interactive' or 'automatic', by default "interactive".</p>
              </div>
            </td>
            <td>
                  <code>&#39;interactive&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="logging.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pre-configured logger instance, by default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Exit code: 0=success, 1=fatal error, 2=some downloads failed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/runner.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span>
        <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">run_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;interactive&quot;</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unified orchestration entry point for both interactive and automatic runs.</span>
<span class="sd">    Handles validation, logging, estimation, and download orchestration.</span>

<span class="sd">    Returns: 0=success, 1=fatal error, 2=some downloads failed.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    config : dict</span>
<span class="sd">        Configuration dictionary with all required parameters.</span>
<span class="sd">    run_mode : str, optional</span>
<span class="sd">        Run mode, either &#39;interactive&#39; or &#39;automatic&#39;, by default &quot;interactive&quot;.</span>
<span class="sd">    logger : logging.Logger, optional</span>
<span class="sd">        Pre-configured logger instance, by default None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">        Exit code: 0=success, 1=fatal error, 2=some downloads failed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">console_handler_active</span> <span class="o">=</span> <span class="p">(</span><span class="n">run_mode</span> <span class="o">==</span> <span class="s2">&quot;interactive&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">verbose</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">echo_only_if_no_console_handler</span><span class="p">(</span><span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="c1"># In automatic non-verbose mode, console handler is absent.</span>
        <span class="c1"># Return True to echo only selected messages (summary, warnings/errors/exceptions).</span>
        <span class="k">return</span> <span class="n">force</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">console_handler_active</span><span class="p">)</span>

    <span class="n">save_base</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;save_dir&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_base</span><span class="p">:</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">resolve_under</span><span class="p">(</span><span class="n">data_dir</span><span class="p">(</span><span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">save_base</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">data_dir</span><span class="p">(</span><span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">setup_logger</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">log_dir</span><span class="p">(</span><span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span> <span class="n">run_mode</span><span class="o">=</span><span class="n">run_mode</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="c1"># Header</span>
    <span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_only_if_no_console_handler</span><span class="p">(</span><span class="kc">False</span><span class="p">))</span>
    <span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting </span><span class="si">{</span><span class="n">run_mode</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> run at </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_only_if_no_console_handler</span><span class="p">(</span><span class="kc">False</span><span class="p">))</span>
    <span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_only_if_no_console_handler</span><span class="p">(</span><span class="kc">False</span><span class="p">))</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># 1) Validate config</span>
        <span class="n">validate_config</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span> <span class="n">run_mode</span><span class="o">=</span><span class="n">run_mode</span><span class="p">)</span>
        <span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;Configuration validation successful.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_only_if_no_console_handler</span><span class="p">(</span><span class="kc">False</span><span class="p">))</span>

        <span class="c1"># 2) Map config → session</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">SessionState</span><span class="p">()</span>
        <span class="n">ok</span><span class="p">,</span> <span class="n">notes</span> <span class="o">=</span> <span class="n">map_config_to_session</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
            <span class="n">log_msg</span><span class="p">(</span><span class="n">note</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_only_if_no_console_handler</span><span class="p">(</span><span class="kc">False</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
            <span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;Config mapping reported blocking issues. Exiting.&quot;</span><span class="p">,</span>
                    <span class="n">logger</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_only_if_no_console_handler</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
            <span class="k">if</span> <span class="s2">&quot;filename_base&quot;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
                <span class="n">create_final_log_file</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">filename_base</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">delete_original</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">reattach_to_final</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;Skipping final log file creation because filename_base was not defined (run failed early).&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span>

        <span class="c1"># 2b) Automatic mode cannot be case-by-case for existing file policy (already coerced by validate_config)</span>
        <span class="c1"># Nothing to do here; messages already logged.</span>

        <span class="c1"># 3) Short internet speed test (both modes)</span>
        <span class="n">speed_mbps</span> <span class="o">=</span> <span class="n">internet_speedtest</span><span class="p">(</span><span class="n">test_urls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_seconds</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_only_if_no_console_handler</span><span class="p">(</span><span class="kc">False</span><span class="p">))</span>
        <span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Detected speed: </span><span class="si">{</span><span class="n">speed_mbps</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> Mbps&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_only_if_no_console_handler</span><span class="p">(</span><span class="kc">False</span><span class="p">))</span>

        <span class="n">dataset_short_name</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dataset_short_name&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dataset_short_name</span> <span class="o">==</span> <span class="s2">&quot;era5-world&quot;</span><span class="p">:</span>
            <span class="n">grid_res</span> <span class="o">=</span> <span class="mf">0.25</span>
        <span class="k">elif</span> <span class="n">dataset_short_name</span> <span class="o">==</span> <span class="s2">&quot;era5-land&quot;</span><span class="p">:</span>
            <span class="n">grid_res</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown dataset_short_name: </span><span class="si">{</span><span class="n">dataset_short_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># 4) Estimate size/time</span>
        <span class="n">estimates</span> <span class="o">=</span> <span class="n">estimate_cds_download</span><span class="p">(</span>
            <span class="n">variables</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;variables&quot;</span><span class="p">),</span>
            <span class="n">area</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;region_bounds&quot;</span><span class="p">),</span>
            <span class="n">start_date</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_date&quot;</span><span class="p">),</span>
            <span class="n">end_date</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end_date&quot;</span><span class="p">),</span>
            <span class="n">observed_speed_mbps</span><span class="o">=</span><span class="n">speed_mbps</span><span class="p">,</span>
            <span class="n">grid_resolution</span><span class="o">=</span><span class="n">grid_res</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Adjust for parallelisation — scale total_time_sec only</span>
        <span class="n">parallel_conf</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;parallel_settings&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parallel_conf</span> <span class="ow">and</span> <span class="n">parallel_conf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enabled&quot;</span><span class="p">):</span>
            <span class="n">efficiency_factor</span> <span class="o">=</span> <span class="mf">0.60</span>
            <span class="n">max_conc</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">parallel_conf</span><span class="p">[</span><span class="s2">&quot;max_concurrent&quot;</span><span class="p">]))</span>
            <span class="n">estimates</span><span class="p">[</span><span class="s2">&quot;total_time_sec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">estimates</span><span class="p">[</span><span class="s2">&quot;total_time_sec&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">max_conc</span> <span class="o">*</span> <span class="n">efficiency_factor</span><span class="p">)</span>
            <span class="n">log_msg</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Adjusted total time for parallel downloads: </span><span class="si">{</span><span class="n">format_duration</span><span class="p">(</span><span class="n">estimates</span><span class="p">[</span><span class="s1">&#39;total_time_sec&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_only_if_no_console_handler</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># 5) Filename + hash</span>
        <span class="n">coord_str</span> <span class="o">=</span> <span class="n">format_coordinates_nwse</span><span class="p">(</span><span class="n">boundaries</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;region_bounds&quot;</span><span class="p">))</span>
        <span class="n">hash_str</span> <span class="o">=</span> <span class="n">generate_filename_hash</span><span class="p">(</span>
            <span class="n">dataset_short_name</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dataset_short_name&quot;</span><span class="p">),</span>
            <span class="n">variables</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;variables&quot;</span><span class="p">),</span>
            <span class="n">boundaries</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;region_bounds&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">filename_base</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dataset_short_name&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">coord_str</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">hash_str</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># 6) Summary (ALWAYS printed in interactive/verbose; printed in non-verbose via echo)</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="n">build_download_summary</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">speed_mbps</span><span class="p">)</span>
        <span class="n">log_msg</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="n">summary</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_only_if_no_console_handler</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">log_msg</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Output base filename: </span><span class="si">{</span><span class="n">filename_base</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_only_if_no_console_handler</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>

        <span class="c1"># 7) Downloads</span>
        <span class="n">successful</span><span class="p">,</span> <span class="n">failed</span><span class="p">,</span> <span class="n">skipped</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n\n</span><span class="s2">Beginning download process...&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_only_if_no_console_handler</span><span class="p">(</span><span class="kc">False</span><span class="p">))</span>
        <span class="n">orchestrate_cds_downloads</span><span class="p">(</span>
            <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
            <span class="n">filename_base</span><span class="o">=</span><span class="n">filename_base</span><span class="p">,</span>
            <span class="n">successful_downloads</span><span class="o">=</span><span class="n">successful</span><span class="p">,</span>
            <span class="n">failed_downloads</span><span class="o">=</span><span class="n">failed</span><span class="p">,</span>
            <span class="n">skipped_downloads</span><span class="o">=</span><span class="n">skipped</span><span class="p">,</span>
            <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
            <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_only_if_no_console_handler</span><span class="p">(</span><span class="kc">False</span><span class="p">),</span>  <span class="c1"># internal steps won’t echo in non-verbose</span>
            <span class="n">allow_prompts</span><span class="o">=</span><span class="p">(</span><span class="n">run_mode</span> <span class="o">==</span> <span class="s2">&quot;interactive&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Final counts — treat as summary (echo in non-verbose)</span>
        <span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_only_if_no_console_handler</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;Download process completed.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_only_if_no_console_handler</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successful : </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">successful</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_only_if_no_console_handler</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipped    : </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">skipped</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_only_if_no_console_handler</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed     : </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">failed</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_only_if_no_console_handler</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_only_if_no_console_handler</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">failed</span><span class="p">:</span>
            <span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;Some downloads failed. Review logs for details.&quot;</span><span class="p">,</span>
                    <span class="n">logger</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_only_if_no_console_handler</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
            <span class="n">create_final_log_file</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">filename_base</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">delete_original</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">reattach_to_final</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">log_msg</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Program ended, goodbye.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_only_if_no_console_handler</span><span class="p">(</span><span class="kc">False</span><span class="p">))</span>
            <span class="k">return</span> <span class="mi">2</span>
        <span class="n">create_final_log_file</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">filename_base</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">delete_original</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">reattach_to_final</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">log_msg</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="o">*</span><span class="mi">60</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Program completed, thank you for using this tool. Goodbye!</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span><span class="o">*</span><span class="mi">60</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_only_if_no_console_handler</span><span class="p">(</span><span class="kc">False</span><span class="p">))</span>


    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Always echo errors in non-verbose mode</span>
        <span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Run failed with exception: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;exception&quot;</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_only_if_no_console_handler</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">coord_str</span> <span class="o">=</span> <span class="n">format_coordinates_nwse</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;region_bounds&quot;</span><span class="p">))</span>
        <span class="n">hash_str</span> <span class="o">=</span> <span class="n">generate_filename_hash</span><span class="p">(</span>
            <span class="n">dataset_short_name</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dataset_short_name&quot;</span><span class="p">),</span>
            <span class="n">variables</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;variables&quot;</span><span class="p">),</span>
            <span class="n">boundaries</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;region_bounds&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">filename_base</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dataset_short_name&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">coord_str</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">hash_str</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">create_final_log_file</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">filename_base</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">delete_original</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">reattach_to_final</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Program ended, goodbye.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_only_if_no_console_handler</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">return</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.runner.run_batch_from_config" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">run_batch_from_config</span>


<a href="#weather_data_retrieval.runner.run_batch_from_config" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">run_batch_from_config</span><span class="p">(</span><span class="n">cfg_path</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Run automatic batch from a config file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration dictionary with all required parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="logging.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pre-configured logger instance, by default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Exit code: 0=success, 1=fatal error, 2=some downloads failed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/runner.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run_batch_from_config</span><span class="p">(</span>
        <span class="n">cfg_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run automatic batch from a config file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    config : dict</span>
<span class="sd">        Configuration dictionary with all required parameters.</span>
<span class="sd">    logger : logging.Logger, optional</span>
<span class="sd">        Pre-configured logger instance, by default None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">        Exit code: 0=success, 1=fatal error, 2=some downloads failed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">load_config</span><span class="p">(</span><span class="n">cfg_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">run</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">run_mode</span><span class="o">=</span><span class="s2">&quot;automatic&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="weather_data_retrieval.io.cli" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">weather_data_retrieval.io.cli</span>


<a href="#weather_data_retrieval.io.cli" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.io.cli.parse_args" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">parse_args</span>


<a href="#weather_data_retrieval.io.cli.parse_args" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">parse_args</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Parse command-line arguments.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>None</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="argparse.Namespace">Namespace</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parsed arguments.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/io/cli.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_args</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse command-line arguments.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    None</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    argparse.Namespace</span>
<span class="sd">        Parsed arguments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;ERA5/Open-Meteo downloader — interactive or batch via config file.&quot;</span>
    <span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--config&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;?&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to JSON config file. If provided, runs in non-interactive (automatic) mode.&quot;</span>
    <span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--log-dir&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Directory where logs will be written (file name is auto-generated).&quot;</span>
    <span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--verbose&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Automatic mode only: also echo log messages to console and show a prompt-style transcript (no input).&quot;</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.io.cli.run_prompt_wizard" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">run_prompt_wizard</span>


<a href="#weather_data_retrieval.io.cli.run_prompt_wizard" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">run_prompt_wizard</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Drives the interactive prompt flow (no config-source step).
Returns True if all fields completed; False if user exits.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>session</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="SessionState (weather_data_retrieval.utils.session_management.SessionState)" href="#weather_data_retrieval.utils.session_management.SessionState">SessionState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The session state to populate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="logging.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger for logging messages, by default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if completed; False if exited early.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/io/cli.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run_prompt_wizard</span><span class="p">(</span>
        <span class="n">session</span><span class="p">:</span> <span class="n">SessionState</span><span class="p">,</span>
        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Drives the interactive prompt flow (no config-source step).</span>
<span class="sd">    Returns True if all fields completed; False if user exits.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    session : SessionState</span>
<span class="sd">        The session state to populate.</span>
<span class="sd">    logger : logging.Logger, optional</span>
<span class="sd">        Logger for logging messages, by default None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        True if completed; False if exited early.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
    <span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;Welcome to the Weather Data Retrieval Prompt Wizard!</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
    <span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Please follow the prompts to configure your data retrieval settings.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
    <span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;At any point, you may type:</span><span class="se">\n</span><span class="s2">   &#39;back&#39; to return to the previous prompt.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
    <span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;   &#39;exit&#39; to quit the wizard</span><span class="se">\n</span><span class="s2">   &#39;Ctrl+C&#39; to stop the program.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
    <span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>


    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">first_unfilled_key</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;data_provider&quot;</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">prompt_data_provider</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">res</span> <span class="o">==</span> <span class="s2">&quot;__EXIT__&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">res</span> <span class="o">==</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">:</span> <span class="k">continue</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;dataset_short_name&quot;</span><span class="p">:</span>
            <span class="n">provider</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data_provider&quot;</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">prompt_dataset_short_name</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">provider</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">res</span> <span class="o">==</span> <span class="s2">&quot;__EXIT__&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">res</span> <span class="o">==</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">:</span>
                <span class="n">session</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span><span class="s2">&quot;data_provider&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

        <span class="c1"># CDS-specific prompts</span>
        <span class="k">elif</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data_provider&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;cds&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;api_url&quot;</span><span class="p">:</span>
                <span class="n">res_url</span> <span class="o">=</span> <span class="n">prompt_cds_url</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="s2">&quot;https://cds.climate.copernicus.eu/api&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">res_url</span> <span class="o">==</span> <span class="s2">&quot;__EXIT__&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">res_url</span> <span class="o">==</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">:</span>
                    <span class="n">session</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span><span class="s2">&quot;dataset_short_name&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>

            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;api_key&quot;</span><span class="p">:</span>
                <span class="n">res_key</span> <span class="o">=</span> <span class="n">prompt_cds_api_key</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">res_key</span> <span class="o">==</span> <span class="s2">&quot;__EXIT__&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">res_key</span> <span class="o">==</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">:</span>
                    <span class="n">session</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span><span class="s2">&quot;api_url&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="n">client</span> <span class="o">=</span> <span class="n">validate_cds_api_key</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_url&quot;</span><span class="p">),</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">),</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;Authentication failed. Please re-enter your API details.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
                    <span class="n">session</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">)</span>
                    <span class="n">session</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span><span class="s2">&quot;api_url&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">session</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;session_client&quot;</span><span class="p">,</span> <span class="n">client</span><span class="p">)</span>

        <span class="c1"># Open-Meteo-specific prompts</span>
        <span class="k">elif</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data_provider&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;open-meteo&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Open-Meteo variable validation not yet implemented.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;save_dir&quot;</span><span class="p">:</span>
            <span class="n">raw_save_path</span> <span class="o">=</span> <span class="n">prompt_save_directory</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">default_save_dir</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">raw_save_path</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;__EXIT__&quot;</span><span class="p">,</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">raw_save_path</span> <span class="o">==</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">:</span>
                    <span class="n">session</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span><span class="s2">&quot;session_client&quot;</span><span class="p">)</span>
                    <span class="n">session</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="c1"># Normalize and resolve path safely</span>
            <span class="n">resolved_path</span> <span class="o">=</span> <span class="n">resolve_under</span><span class="p">(</span><span class="n">data_dir</span><span class="p">(</span><span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">raw_save_path</span><span class="p">)</span>
            <span class="n">session</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;save_dir&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">resolved_path</span><span class="p">))</span>
            <span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Save directory resolved to: </span><span class="si">{</span><span class="n">resolved_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
            <span class="k">continue</span>


        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;start_date&quot;</span><span class="p">:</span>
            <span class="c1"># This prompt sets BOTH start_date and end_date</span>
            <span class="n">s</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">prompt_date_range</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="s2">&quot;__EXIT__&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">:</span>
                <span class="n">session</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span><span class="s2">&quot;save_dir&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;end_date&quot;</span><span class="p">:</span>
            <span class="c1"># Will already be filled by prompt_date_range; just skip</span>
            <span class="k">continue</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;region_bounds&quot;</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">prompt_coordinates</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">bounds</span> <span class="o">==</span> <span class="s2">&quot;__EXIT__&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">bounds</span> <span class="o">==</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">:</span>
                <span class="n">session</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span><span class="s2">&quot;start_date&quot;</span><span class="p">)</span>
                <span class="n">session</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span><span class="s2">&quot;end_date&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;variables&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dataset_short_name&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;era5-world&quot;</span><span class="p">:</span>
                <span class="n">invalid_vars</span> <span class="o">=</span> <span class="n">invalid_era5_world_variables</span>
            <span class="k">elif</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dataset_short_name&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;era5-land&quot;</span><span class="p">:</span>
                <span class="n">invalid_vars</span> <span class="o">=</span> <span class="n">invalid_era5_land_variables</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown dataset for variable validation.&quot;</span><span class="p">)</span>
            <span class="n">variables</span> <span class="o">=</span> <span class="n">prompt_variables</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">invalid_vars</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">variables</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;__EXIT__&quot;</span><span class="p">,</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">variables</span> <span class="o">==</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">:</span>
                    <span class="n">session</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span><span class="s2">&quot;region_bounds&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;existing_file_action&quot;</span><span class="p">:</span>
            <span class="n">efa</span> <span class="o">=</span> <span class="n">prompt_skip_overwrite_files</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">efa</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;__EXIT__&quot;</span><span class="p">,</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">efa</span> <span class="o">==</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">:</span>
                    <span class="n">session</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span><span class="s2">&quot;variables&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;parallel_settings&quot;</span><span class="p">:</span>
            <span class="n">ps</span> <span class="o">=</span> <span class="n">prompt_parallelisation_settings</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ps</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;__EXIT__&quot;</span><span class="p">,</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">ps</span> <span class="o">==</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">:</span>
                    <span class="n">session</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span><span class="s2">&quot;existing_file_action&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;retry_settings&quot;</span><span class="p">:</span>
            <span class="n">rs</span> <span class="o">=</span> <span class="n">prompt_retry_settings</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rs</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;__EXIT__&quot;</span><span class="p">,</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">rs</span> <span class="o">==</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">:</span>
                    <span class="n">session</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span><span class="s2">&quot;parallel_settings&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;inputs_confirmed&quot;</span><span class="p">:</span>
            <span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
            <span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Prompting wizard complete. Please review your selections:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
            <span class="n">rs</span> <span class="o">=</span> <span class="n">prompt_continue_confirmation</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rs</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;__EXIT__&quot;</span><span class="p">,</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">rs</span> <span class="o">==</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">:</span>
                    <span class="n">session</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span><span class="s2">&quot;parallel_settings&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="n">session</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;inputs_confirmed&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Selections confirmed.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="weather_data_retrieval.io.config_loader" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">weather_data_retrieval.io.config_loader</span>


<a href="#weather_data_retrieval.io.config_loader" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.io.config_loader.load_and_validate_config" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">load_and_validate_config</span>


<a href="#weather_data_retrieval.io.config_loader.load_and_validate_config" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">load_and_validate_config</span><span class="p">(</span>
    <span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">run_mode</span><span class="o">=</span><span class="s2">&quot;automatic&quot;</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Load JSON config and validate it using the centralized validator.
This lets the validator log coercions/warnings (e.g., case_by_case → skip_all).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to JSON config file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="logging.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger instance for validation messages, by default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>run_mode</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Run mode, either 'interactive' or 'automatic', by default "automatic".</p>
              </div>
            </td>
            <td>
                  <code>&#39;automatic&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validated configuration dictionary.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/io/config_loader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_and_validate_config</span><span class="p">(</span>
        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">run_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;automatic&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load JSON config and validate it using the centralized validator.</span>
<span class="sd">    This lets the validator log coercions/warnings (e.g., case_by_case → skip_all).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path : str</span>
<span class="sd">        Path to JSON config file.</span>
<span class="sd">    logger : logging.Logger, optional</span>
<span class="sd">        Logger instance for validation messages, by default None.</span>
<span class="sd">    run_mode : str, optional</span>
<span class="sd">        Run mode, either &#39;interactive&#39; or &#39;automatic&#39;, by default &quot;automatic&quot;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        Validated configuration dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cfg_path</span> <span class="o">=</span> <span class="n">_resolve_config_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cfg_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="c1"># Let validate_config perform normalization/clamping with logging context</span>
    <span class="n">validate_config</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span> <span class="n">run_mode</span><span class="o">=</span><span class="n">run_mode</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">config</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.io.config_loader.load_config" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">load_config</span>


<a href="#weather_data_retrieval.io.config_loader.load_config" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">load_config</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Load configuration from a JSON requirements file (without validation).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to JSON config file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration dictionary.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/io/config_loader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_config</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load configuration from a JSON requirements file (without validation).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    file_path : str</span>
<span class="sd">        Path to JSON config file.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        Configuration dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># if not os.path.exists(file_path):</span>
    <span class="c1">#     raise FileNotFoundError(f&quot;Configuration file not found: {file_path}&quot;)</span>
    <span class="c1"># with open(file_path, &quot;r&quot;, encoding=&quot;utf-8&quot;) as f:</span>
    <span class="c1">#     return json.load(f)</span>
    <span class="n">cfg_path</span> <span class="o">=</span> <span class="n">_resolve_config_path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cfg_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="weather_data_retrieval.io.prompts" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">weather_data_retrieval.io.prompts</span>


<a href="#weather_data_retrieval.io.prompts" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.io.prompts.read_input" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">read_input</span>


<a href="#weather_data_retrieval.io.prompts.read_input" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">read_input</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Centralized input handler with built-in 'exit' and 'back' controls.</p>


<details class="parameters:" open>
  <summary>Parameters:</summary>
  <p>prompt : str
    The prompt to display to the user.
logger : logging.Logger, optional
    Logger to log the prompt message.</p>
</details>

<details class="returns:" open>
  <summary>Returns:</summary>
  <p>str
    The user input, or special command indicators.</p>
</details>

            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/io/prompts.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_input</span><span class="p">(</span>
        <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Centralized input handler with built-in &#39;exit&#39; and &#39;back&#39; controls.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    prompt : str</span>
<span class="sd">        The prompt to display to the user.</span>
<span class="sd">    logger : logging.Logger, optional</span>
<span class="sd">        Logger to log the prompt message.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        The user input, or special command indicators.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Log to file only (DEBUG won&#39;t be shown by the console handler at INFO)</span>
    <span class="k">if</span> <span class="n">logger</span><span class="p">:</span>
        <span class="c1"># Use level=&quot;debug&quot; so it doesn&#39;t appear on console</span>
        <span class="n">log_msg</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Show the prompt exactly once on the console</span>
    <span class="n">raw</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">lower</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;exit&quot;</span><span class="p">,</span> <span class="s2">&quot;quit&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;__EXIT__&quot;</span>
    <span class="k">if</span> <span class="n">lower</span> <span class="o">==</span> <span class="s2">&quot;back&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;__BACK__&quot;</span>

    <span class="k">return</span> <span class="n">lower</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.io.prompts.say" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">say</span>


<a href="#weather_data_retrieval.io.prompts.say" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">say</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Centralized output handler to log and print messages.</p>


<details class="parameters:" open>
  <summary>Parameters:</summary>
  <p>text : str
    The message to display.
logger : logging.Logger, optional
    Logger to log the message.</p>
</details>

<details class="returns:" open>
  <summary>Returns:</summary>
  <p>None</p>
</details>

            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/io/prompts.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">say</span><span class="p">(</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Centralized output handler to log and print messages.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    text : str</span>
<span class="sd">        The message to display.</span>
<span class="sd">    logger : logging.Logger, optional</span>
<span class="sd">        Logger to log the message.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># if logger:</span>
    <span class="c1">#     logger.info(text)</span>
    <span class="n">log_msg</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.io.prompts.prompt_data_provider" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">prompt_data_provider</span>


<a href="#weather_data_retrieval.io.prompts.prompt_data_provider" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">prompt_data_provider</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Prompt user for which data provider to use (CDS or Open-Meteo).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>session</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="SessionState (weather_data_retrieval.utils.session_management.SessionState)" href="#weather_data_retrieval.utils.session_management.SessionState">SessionState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current session state to store selected data provider.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="logging.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger for logging messages, by default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Normalized provider name ("cds" or "open-meteo"),
or special control token "<strong>BACK</strong>" or "<strong>EXIT</strong>".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/io/prompts.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prompt_data_provider</span><span class="p">(</span>
        <span class="n">session</span><span class="p">:</span> <span class="n">SessionState</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prompt user for which data provider to use (CDS or Open-Meteo).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    session : SessionState</span>
<span class="sd">        Current session state to store selected data provider.</span>
<span class="sd">    logger : logging.Logger, optional</span>
<span class="sd">        Logger for logging messages, by default None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        Normalized provider name (&quot;cds&quot; or &quot;open-meteo&quot;),</span>
<span class="sd">        or special control token &quot;__BACK__&quot; or &quot;__EXIT__&quot;.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">60</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data Provider Selection:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;Available data providers:</span><span class="se">\n\t</span><span class="s2">1. Copernicus Climate Data Store (CDS)</span><span class="se">\n\t</span><span class="s2">2. Open-Meteo&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="n">read_input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Please enter the data provider you would like to use (name or number): &quot;</span><span class="p">,</span>
                         <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">raw</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;__EXIT__&quot;</span><span class="p">,</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">raw</span>

        <span class="n">data_provider</span> <span class="o">=</span> <span class="n">normalize_input</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="s2">&quot;data_provider&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_data_provider</span><span class="p">(</span><span class="n">data_provider</span><span class="p">):</span>
            <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ERROR: Invalid provider. Please enter &#39;1&#39; for CDS or &#39;2&#39; for Open-Meteo&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">data_provider</span> <span class="o">==</span> <span class="s2">&quot;open-meteo&quot;</span><span class="p">:</span>
            <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ERROR: Open-Meteo support is not yet implemented. Please select CDS.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">say</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">You selected: [</span><span class="si">{</span><span class="n">data_provider</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

        <span class="n">session</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;data_provider&quot;</span><span class="p">,</span> <span class="n">data_provider</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data_provider</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.io.prompts.prompt_dataset_short_name" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">prompt_dataset_short_name</span>


<a href="#weather_data_retrieval.io.prompts.prompt_dataset_short_name" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">prompt_dataset_short_name</span><span class="p">(</span>
    <span class="n">session</span><span class="p">,</span> <span class="n">provider</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Prompt for dataset choice.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>session</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="SessionState (weather_data_retrieval.utils.session_management.SessionState)" href="#weather_data_retrieval.utils.session_management.SessionState">SessionState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current session state to store selected dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>provider</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Data provider name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="logging.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger for logging messages, by default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>    str: Normalized dataset name or &#39;exit&#39; / &#39;back&#39;.</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/io/prompts.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prompt_dataset_short_name</span><span class="p">(</span>
        <span class="n">session</span><span class="p">:</span> <span class="n">SessionState</span><span class="p">,</span>
        <span class="n">provider</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prompt for dataset choice.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    session: SessionState</span>
<span class="sd">        Current session state to store selected dataset.</span>
<span class="sd">    provider : str</span>
<span class="sd">        Data provider name.</span>
<span class="sd">    logger : logging.Logger, optional</span>
<span class="sd">        Logger for logging messages, by default None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        str: Normalized dataset name or &#39;exit&#39; / &#39;back&#39;.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">provider</span> <span class="o">!=</span> <span class="s2">&quot;cds&quot;</span><span class="p">:</span>
        <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Currently only CDS datasets are supported.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;__BACK__&quot;</span>

    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">60</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Dataset Selection:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;Available CDS datasets:</span><span class="se">\n\t</span><span class="s2">1. ERA5-Land</span><span class="se">\n\t</span><span class="s2">2. ERA5-World&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="n">read_input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Please enter the dataset you would like to use (name or number): &quot;</span><span class="p">,</span>
                         <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">raw</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;__EXIT__&quot;</span><span class="p">,</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">raw</span>

        <span class="n">dataset_short_name</span> <span class="o">=</span> <span class="n">normalize_input</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="s2">&quot;era5_dataset_short_name&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_dataset_short_name</span><span class="p">(</span><span class="n">dataset_short_name</span><span class="p">,</span> <span class="n">provider</span><span class="p">):</span>
            <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ERROR: Invalid or unsupported dataset. Try again.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="c1"># if dataset_short_name != &quot;era5-world&quot;:</span>
        <span class="c1">#     say(&quot;\nERROR: Only ERA5-World dataset is implemented in this version. Please select ERA5-World.&quot;, logger=logger)</span>
        <span class="c1">#     continue</span>

        <span class="n">say</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">You selected: [</span><span class="si">{</span><span class="n">dataset_short_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
        <span class="n">session</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dataset_short_name&quot;</span><span class="p">,</span> <span class="n">dataset_short_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dataset_short_name</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.io.prompts.prompt_cds_url" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">prompt_cds_url</span>


<a href="#weather_data_retrieval.io.prompts.prompt_cds_url" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">prompt_cds_url</span><span class="p">(</span>
    <span class="n">session</span><span class="p">,</span>
    <span class="n">api_url_default</span><span class="o">=</span><span class="s2">&quot;https://cds.climate.copernicus.eu/api&quot;</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">logger</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Prompt for CDS API URL.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>session</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="SessionState (weather_data_retrieval.utils.session_management.SessionState)" href="#weather_data_retrieval.utils.session_management.SessionState">SessionState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current session state to store API URL.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>api_url_default</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Default CDS API URL. https://cds.climate.copernicus.eu/api</p>
              </div>
            </td>
            <td>
                  <code>&#39;https://cds.climate.copernicus.eu/api&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>    str: CDS API URL or &#39;exit&#39; / &#39;back&#39;.</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/io/prompts.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prompt_cds_url</span><span class="p">(</span>
        <span class="n">session</span><span class="p">:</span> <span class="n">SessionState</span><span class="p">,</span>
        <span class="n">api_url_default</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://cds.climate.copernicus.eu/api&quot;</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prompt for CDS API URL.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    session : SessionState</span>
<span class="sd">        Current session state to store API URL.</span>
<span class="sd">    api_url_default : str</span>
<span class="sd">        Default CDS API URL. https://cds.climate.copernicus.eu/api</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        str: CDS API URL or &#39;exit&#39; / &#39;back&#39;.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">60</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">CDS API url:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
    <span class="n">say</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Default: </span><span class="si">{</span><span class="n">api_url_default</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="n">read_input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Enter the CDS API url (or press Enter to keep default): &quot;</span><span class="p">,</span>
                         <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">raw</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;__EXIT__&quot;</span><span class="p">,</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">raw</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">raw</span> <span class="ow">or</span> <span class="n">api_url_default</span>
        <span class="n">session</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;api_url&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="n">say</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">You entered the url : </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">url</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.io.prompts.prompt_cds_api_key" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">prompt_cds_api_key</span>


<a href="#weather_data_retrieval.io.prompts.prompt_cds_api_key" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">prompt_cds_api_key</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Prompt only for the CDS API key (hidden input).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>session</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="SessionState (weather_data_retrieval.utils.session_management.SessionState)" href="#weather_data_retrieval.utils.session_management.SessionState">SessionState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current session state to store API key.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="logging.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger for logging messages, by default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>CDS API key or 'exit' / 'back'.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/io/prompts.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prompt_cds_api_key</span><span class="p">(</span>
        <span class="n">session</span><span class="p">:</span> <span class="n">SessionState</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prompt only for the CDS API key (hidden input).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    session : SessionState</span>
<span class="sd">        Current session state to store API key.</span>
<span class="sd">    logger : logging.Logger, optional</span>
<span class="sd">        Logger for logging messages, by default None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        CDS API key or &#39;exit&#39; / &#39;back&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">60</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">CDS API key:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">getpass</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Enter your CDS API key: &quot;</span><span class="p">)</span>
        <span class="c1"># getpass cannot log input value; we just log the action</span>
        <span class="n">low</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">low</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;exit&quot;</span><span class="p">,</span> <span class="s2">&quot;quit&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;__EXIT__&quot;</span>
        <span class="k">if</span> <span class="n">low</span> <span class="o">==</span> <span class="s2">&quot;back&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;__BACK__&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="p">:</span>
            <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ERROR: No API key entered. Please try again.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="n">session</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="n">say</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">You entered an API key of length </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="si">}</span><span class="s2"> characters.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">key</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.io.prompts.prompt_save_directory" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">prompt_save_directory</span>


<a href="#weather_data_retrieval.io.prompts.prompt_save_directory" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">prompt_save_directory</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">default_dir</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Ask for save directory, create if necessary.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>session</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="SessionState (weather_data_retrieval.utils.session_management.SessionState)" href="#weather_data_retrieval.utils.session_management.SessionState">SessionState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current session state to store save directory.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_dir</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Default directory to suggest.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="logging.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger for logging messages, by default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pathlib.Path">Path</span> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save directory, or control token "<strong>BACK</strong>" / "<strong>EXIT</strong>".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/io/prompts.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prompt_save_directory</span><span class="p">(</span>
        <span class="n">session</span><span class="p">:</span> <span class="n">SessionState</span><span class="p">,</span>
        <span class="n">default_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">str</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ask for save directory, create if necessary.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    session : SessionState</span>
<span class="sd">        Current session state to store save directory.</span>
<span class="sd">    default_dir : Path</span>
<span class="sd">        Default directory to suggest.</span>
<span class="sd">    logger : logging.Logger, optional</span>
<span class="sd">        Logger for logging messages, by default None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Path | str</span>
<span class="sd">        Path to save directory, or control token &quot;__BACK__&quot; / &quot;__EXIT__&quot;.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">60</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data Save Directory Selection:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
    <span class="n">say</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Default: </span><span class="si">{</span><span class="n">default_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="n">read_input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Enter a path (or press Enter to use default): &quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">raw</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;__EXIT__&quot;</span><span class="p">,</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">raw</span>
        <span class="c1"># resolve under repo_root/data if relative</span>
        <span class="n">resolved_path</span> <span class="o">=</span> <span class="n">resolve_under</span><span class="p">(</span><span class="n">data_dir</span><span class="p">(</span><span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">raw</span> <span class="ow">or</span> <span class="n">default_dir</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">validate_directory</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">resolved_path</span><span class="p">)):</span>
            <span class="n">say</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">You set the save directory to: </span><span class="si">{</span><span class="n">resolved_path</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="n">session</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;save_dir&quot;</span><span class="p">,</span> <span class="n">resolved_path</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">resolved_path</span>
        <span class="n">say</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ERROR: Directory [</span><span class="si">{</span><span class="n">resolved_path</span><span class="si">}</span><span class="s2">] could not be created or accessed. Try another path.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.io.prompts.prompt_date_range" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">prompt_date_range</span>


<a href="#weather_data_retrieval.io.prompts.prompt_date_range" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">prompt_date_range</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Ask user for start and end date, with validation.
Accepts formats: YYYY-MM-DD or YYYY-MM
- Start dates without day default to first day of month (YYYY-MM-01)
- End dates without day default to last day of month (YYYY-MM-[last day])</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>session</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="SessionState (weather_data_retrieval.utils.session_management.SessionState)" href="#weather_data_retrieval.utils.session_management.SessionState">SessionState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current session state to store date range.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="logging.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger for logging messages, by default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(start_date_str, end_date_str) in ISO format (YYYY-MM-DD),
or ("<strong>EXIT</strong>", "<strong>EXIT</strong>") / ("<strong>BACK</strong>", "<strong>BACK</strong>")</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/io/prompts.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prompt_date_range</span><span class="p">(</span>
        <span class="n">session</span><span class="p">:</span> <span class="n">SessionState</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ask user for start and end date, with validation.</span>
<span class="sd">    Accepts formats: YYYY-MM-DD or YYYY-MM</span>
<span class="sd">    - Start dates without day default to first day of month (YYYY-MM-01)</span>
<span class="sd">    - End dates without day default to last day of month (YYYY-MM-[last day])</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    session : SessionState</span>
<span class="sd">        Current session state to store date range.</span>
<span class="sd">    logger : logging.Logger, optional</span>
<span class="sd">        Logger for logging messages, by default None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple[str, str]</span>
<span class="sd">        (start_date_str, end_date_str) in ISO format (YYYY-MM-DD),</span>
<span class="sd">        or (&quot;__EXIT__&quot;, &quot;__EXIT__&quot;) / (&quot;__BACK__&quot;, &quot;__BACK__&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">60</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Date Range Selection:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;Enter dates as YYYY-MM-DD or YYYY-MM</span><span class="se">\n</span><span class="s2">(YYYY-MM will default to first day for start, last day for end)&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">start_raw</span> <span class="o">=</span> <span class="n">read_input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Enter start date: &quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">start_raw</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;__EXIT__&quot;</span><span class="p">,</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">):</span> <span class="k">return</span> <span class="n">start_raw</span><span class="p">,</span> <span class="n">start_raw</span>
        <span class="n">end_raw</span> <span class="o">=</span> <span class="n">read_input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Enter end date: &quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">end_raw</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;__EXIT__&quot;</span><span class="p">,</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">):</span> <span class="k">return</span> <span class="n">end_raw</span><span class="p">,</span> <span class="n">end_raw</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_date</span><span class="p">(</span><span class="n">start_raw</span><span class="p">,</span> <span class="n">allow_month_only</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ERROR: Invalid start date format. Use YYYY-MM-DD or YYYY-MM.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_date</span><span class="p">(</span><span class="n">end_raw</span><span class="p">,</span> <span class="n">allow_month_only</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ERROR: Invalid end date format. Use YYYY-MM-DD or YYYY-MM.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">start_str</span> <span class="o">=</span> <span class="n">parse_date_with_defaults</span><span class="p">(</span><span class="n">start_raw</span><span class="p">,</span> <span class="n">default_to_month_end</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">start_raw</span><span class="p">)</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="n">say</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">Start date set to: </span><span class="si">{</span><span class="n">start_str</span><span class="si">}</span><span class="s2"> (first day of month)&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="n">end</span><span class="p">,</span> <span class="n">end_str</span> <span class="o">=</span> <span class="n">parse_date_with_defaults</span><span class="p">(</span><span class="n">end_raw</span><span class="p">,</span> <span class="n">default_to_month_end</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">end_raw</span><span class="p">)</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="n">say</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">End date set to: </span><span class="si">{</span><span class="n">end_str</span><span class="si">}</span><span class="s2"> (last day of month)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">say</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ERROR: Could not parse dates: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">end</span> <span class="o">&lt;=</span> <span class="n">start</span><span class="p">:</span>
            <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ERROR: End date must be after start date.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data_provider&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;cds&quot;</span><span class="p">:</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">clamp_era5_available_end_date</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
            <span class="n">end_str</span> <span class="o">=</span> <span class="n">end</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

        <span class="n">say</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">You selected a date range of start [</span><span class="si">{</span><span class="n">start</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span><span class="si">}</span><span class="s2">] → end [</span><span class="si">{</span><span class="n">end</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span><span class="si">}</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
        <span class="n">session</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;start_date&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">())</span>
        <span class="n">session</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;end_date&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">start</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span> <span class="n">end</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.io.prompts.prompt_coordinates" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">prompt_coordinates</span>


<a href="#weather_data_retrieval.io.prompts.prompt_coordinates" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">prompt_coordinates</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Prompt user for geographic boundaries (N, S, W, E) with validation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>session</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="SessionState (weather_data_retrieval.utils.session_management.SessionState)" href="#weather_data_retrieval.utils.session_management.SessionState">SessionState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current session state to store geographic boundaries.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>[north, west, south, east] boundaries or special tokens "<strong>EXIT</strong>" / "<strong>BACK</strong>".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/io/prompts.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prompt_coordinates</span><span class="p">(</span>
        <span class="n">session</span><span class="p">:</span> <span class="n">SessionState</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prompt user for geographic boundaries (N, S, W, E) with validation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    session : SessionState</span>
<span class="sd">        Current session state to store geographic boundaries.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list[float]</span>
<span class="sd">        [north, west, south, east] boundaries or special tokens &quot;__EXIT__&quot; / &quot;__BACK__&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">say</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Grid Area Selection (EPSG: 4326):</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[(</span><span class="s2">&quot;Northern latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;north&quot;</span><span class="p">),</span>
                           <span class="p">(</span><span class="s2">&quot;Southern latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;south&quot;</span><span class="p">),</span>
                           <span class="p">(</span><span class="s2">&quot;Western longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;west&quot;</span><span class="p">),</span>
                           <span class="p">(</span><span class="s2">&quot;Eastern longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;east&quot;</span><span class="p">)]:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">read_input</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Enter </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> boundary: &quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;__BACK__&quot;</span><span class="p">,</span> <span class="s2">&quot;__EXIT__&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">value</span>
            <span class="n">entries</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">entries</span><span class="p">[</span><span class="s2">&quot;north&quot;</span><span class="p">]),</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">entries</span><span class="p">[</span><span class="s2">&quot;south&quot;</span><span class="p">]),</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">entries</span><span class="p">[</span><span class="s2">&quot;west&quot;</span><span class="p">]),</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">entries</span><span class="p">[</span><span class="s2">&quot;east&quot;</span><span class="p">]),</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Please enter numeric values for all coordinates.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_coordinates</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
            <span class="n">say</span><span class="p">(</span><span class="s2">&quot;Invalid bounds. Check that -90 ≤ lat ≤ 90, -180 ≤ lon ≤ 180, and North &gt; South.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">]</span>
        <span class="n">say</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;You entered boundaries of: [N</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">, W</span><span class="si">{</span><span class="n">w</span><span class="si">}</span><span class="s2">, S</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">, E</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
        <span class="n">session</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;region_bounds&quot;</span><span class="p">,</span> <span class="n">bounds</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bounds</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.io.prompts.prompt_variables" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">prompt_variables</span>


<a href="#weather_data_retrieval.io.prompts.prompt_variables" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">prompt_variables</span><span class="p">(</span>
    <span class="n">session</span><span class="p">,</span>
    <span class="n">variable_restrictions_list</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="n">restriction_allow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">logger</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Ask for variables to download, validate each against allowed/disallowed list,
and only update session if the full set is valid.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>session</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="SessionState (weather_data_retrieval.utils.session_management.SessionState)" href="#weather_data_retrieval.utils.session_management.SessionState">SessionState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current session state to store selected variables.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>variable_restrictions_list</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of variables that are either allowed or disallowed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>restriction_allow</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, variable_restrictions_list is an allowlist (i.e. in).
If False, it's a denylist (i.e. not in)</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="logging.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger for logging messages, by default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of selected variable names, or control token "<strong>BACK</strong>" / "<strong>EXIT</strong>".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/io/prompts.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prompt_variables</span><span class="p">(</span>
        <span class="n">session</span><span class="p">:</span> <span class="n">SessionState</span><span class="p">,</span>
        <span class="n">variable_restrictions_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="n">restriction_allow</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ask for variables to download, validate each against allowed/disallowed list,</span>
<span class="sd">    and only update session if the full set is valid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    session : SessionState</span>
<span class="sd">        Current session state to store selected variables.</span>
<span class="sd">    variable_restrictions_list : list[str]</span>
<span class="sd">        List of variables that are either allowed or disallowed.</span>
<span class="sd">    restriction_allow : bool</span>
<span class="sd">        If True, variable_restrictions_list is an allowlist (i.e. in).</span>
<span class="sd">        If False, it&#39;s a denylist (i.e. not in)</span>
<span class="sd">    logger : logging.Logger, optional</span>
<span class="sd">        Logger for logging messages, by default None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list[str] | str</span>
<span class="sd">        List of selected variable names, or control token &quot;__BACK__&quot; / &quot;__EXIT__&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Variable Selection [</span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dataset_short_name&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">]:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;(Type &#39;back&#39; to return to previous step or &#39;exit&#39; to quit.)&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="n">read_input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Enter variable names (comma-separated): &quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">raw</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;__EXIT__&quot;</span><span class="p">,</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">raw</span>

        <span class="n">variable_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">raw</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">variable_list</span><span class="p">:</span>
            <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ERROR: Please enter at least one variable name.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">all_valid</span> <span class="o">=</span> <span class="n">validate_variables</span><span class="p">(</span><span class="n">variable_list</span><span class="p">,</span> <span class="n">variable_restrictions_list</span><span class="p">,</span> <span class="n">restriction_allow</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">all_valid</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">restriction_allow</span><span class="p">:</span>
                <span class="n">valid_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">variable_list</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">variable_restrictions_list</span><span class="p">]</span>
                <span class="n">invalid_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">variable_list</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">variable_restrictions_list</span><span class="p">]</span>
                <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ERROR: Some variables are not recognized or not available for this dataset:&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">iv</span> <span class="ow">in</span> <span class="n">invalid_vars</span><span class="p">:</span>
                    <span class="n">say</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - </span><span class="si">{</span><span class="n">iv</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">valid_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">variable_list</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">variable_restrictions_list</span><span class="p">]</span>
                <span class="n">invalid_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">variable_list</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">variable_restrictions_list</span><span class="p">]</span>
                <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ERROR: The following variables are known to cause issues or are disallowed for this dataset:&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">iv</span> <span class="ow">in</span> <span class="n">invalid_vars</span><span class="p">:</span>
                    <span class="n">say</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - </span><span class="si">{</span><span class="n">iv</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
                <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Please edit the invalid variable list for this dataset if you believe this is an error.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">valid_vars</span><span class="p">:</span>
                <span class="n">proceed</span> <span class="o">=</span> <span class="n">read_input</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Would you like to proceed with only the valid variables (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">valid_vars</span><span class="p">)</span><span class="si">}</span><span class="s2">)? (y/n): &quot;</span><span class="p">,</span>
                    <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">proceed</span> <span class="ow">in</span> <span class="n">NORMALIZATION_MAP</span><span class="p">[</span><span class="s2">&quot;confirmation&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">NORMALIZATION_MAP</span><span class="p">[</span><span class="s2">&quot;confirmation&quot;</span><span class="p">][</span><span class="n">proceed</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
                    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Proceeding with valid subset.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
                    <span class="n">session</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;variables&quot;</span><span class="p">,</span> <span class="n">valid_vars</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">valid_vars</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Let&#39;s try again.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
                    <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ERROR: No valid variables remain. Please try again.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
                <span class="k">continue</span>

        <span class="n">say</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">You selected [</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">variable_list</span><span class="p">)</span><span class="si">}</span><span class="s2">] valid variables:</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">variable_list</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
        <span class="n">confirm</span> <span class="o">=</span> <span class="n">read_input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Confirm selection? (y/n): &quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">confirm</span> <span class="ow">in</span> <span class="n">NORMALIZATION_MAP</span><span class="p">[</span><span class="s2">&quot;confirmation&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">NORMALIZATION_MAP</span><span class="p">[</span><span class="s2">&quot;confirmation&quot;</span><span class="p">][</span><span class="n">confirm</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
            <span class="n">session</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;variables&quot;</span><span class="p">,</span> <span class="n">variable_list</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">variable_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Let&#39;s try again.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.io.prompts.prompt_skip_overwrite_files" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">prompt_skip_overwrite_files</span>


<a href="#weather_data_retrieval.io.prompts.prompt_skip_overwrite_files" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">prompt_skip_overwrite_files</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Prompt user to choose skip/overwrite/case-by-case for existing files.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>session</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="SessionState (weather_data_retrieval.utils.session_management.SessionState)" href="#weather_data_retrieval.utils.session_management.SessionState">SessionState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Session state to store user choice.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="logging.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger for logging messages, by default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>One of "overwrite_all", "skip_all", "case_by_case"</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/io/prompts.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prompt_skip_overwrite_files</span><span class="p">(</span>
        <span class="n">session</span><span class="p">:</span> <span class="n">SessionState</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prompt user to choose skip/overwrite/case-by-case for existing files.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    session : SessionState</span>
<span class="sd">        Session state to store user choice.</span>
<span class="sd">    logger : logging.Logger, optional</span>
<span class="sd">        Logger for logging messages, by default None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        One of &quot;overwrite_all&quot;, &quot;skip_all&quot;, &quot;case_by_case&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Existing File Policy:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">1. Overwrite all existing files</span><span class="se">\n\t</span><span class="s2">2. Skip all existing files</span><span class="se">\n\t</span><span class="s2">3. Case-by-case confirmation&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">choice</span> <span class="o">=</span> <span class="n">read_input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Enter choice (1/2/3): &quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">choice</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;__EXIT__&quot;</span><span class="p">,</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">choice</span>
        <span class="k">if</span> <span class="n">choice</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">]:</span>
            <span class="k">break</span>
        <span class="n">say</span><span class="p">(</span><span class="s2">&quot;Invalid input. Please enter 1, 2, or 3.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">choice</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span>
        <span class="n">session</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;existing_file_action&quot;</span><span class="p">,</span> <span class="s2">&quot;overwrite_all&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">choice</span> <span class="o">==</span> <span class="s2">&quot;2&quot;</span><span class="p">:</span>
        <span class="n">session</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;existing_file_action&quot;</span><span class="p">,</span> <span class="s2">&quot;skip_all&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">session</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;existing_file_action&quot;</span><span class="p">,</span> <span class="s2">&quot;case_by_case&quot;</span><span class="p">)</span>

    <span class="n">say</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;You selected option [</span><span class="si">{</span><span class="n">choice</span><span class="si">}</span><span class="s2">] - [</span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;existing_file_action&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">] </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;existing_file_action&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.io.prompts.prompt_parallelisation_settings" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">prompt_parallelisation_settings</span>


<a href="#weather_data_retrieval.io.prompts.prompt_parallelisation_settings" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">prompt_parallelisation_settings</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Ask user about parallel downloads and concurrency cap.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>session</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="SessionState (weather_data_retrieval.utils.session_management.SessionState)" href="#weather_data_retrieval.utils.session_management.SessionState">SessionState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current session state to store parallelisation settings.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="logging.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger for logging messages, by default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with parallelisation settings, or control token "<strong>BACK</strong>" / "<strong>EXIT</strong>".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/io/prompts.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prompt_parallelisation_settings</span><span class="p">(</span>
        <span class="n">session</span><span class="p">:</span> <span class="n">SessionState</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ask user about parallel downloads and concurrency cap.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    session : SessionState</span>
<span class="sd">        Current session state to store parallelisation settings.</span>
<span class="sd">    logger : logging.Logger, optional</span>
<span class="sd">        Logger for logging messages, by default None.</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict | str</span>
<span class="sd">        Dictionary with parallelisation settings, or control token &quot;__BACK__&quot; / &quot;__EXIT__&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">60</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Parallelisation Settings:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;You can enable multiple parallel downloads to speed up retrieval.</span><span class="se">\n</span><span class="s2">Note: The CDS API may throttle or reject requests if too many are opened concurrently.&quot;</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="n">read_input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Enable parallel downloads? (y/n) [default y]: &quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">raw</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;__EXIT__&quot;</span><span class="p">,</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">raw</span>

        <span class="k">if</span> <span class="n">raw</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">user_choice</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span>
        <span class="k">elif</span> <span class="n">raw</span> <span class="ow">in</span> <span class="n">NORMALIZATION_MAP</span><span class="p">[</span><span class="s2">&quot;confirmation&quot;</span><span class="p">]:</span>
            <span class="n">user_choice</span> <span class="o">=</span> <span class="n">NORMALIZATION_MAP</span><span class="p">[</span><span class="s2">&quot;confirmation&quot;</span><span class="p">][</span><span class="n">raw</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Invalid input. Please enter &#39;y&#39; or &#39;n&#39;.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">user_choice</span> <span class="o">==</span> <span class="s2">&quot;no&quot;</span><span class="p">:</span>
            <span class="n">settings</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;max_concurrent&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
            <span class="n">session</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;parallel_settings&quot;</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>
            <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">You have disabled parallel downloads (single-threaded mode).&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">settings</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">mc</span> <span class="o">=</span> <span class="n">read_input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Enter the maximum number of concurrent downloads you would like to allow (integer ≥ 2) [default 2]: &quot;</span><span class="p">,</span>
                            <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mc</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;__EXIT__&quot;</span><span class="p">,</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">mc</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">mc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mc</span><span class="p">)</span> <span class="k">if</span> <span class="n">mc</span> <span class="k">else</span> <span class="mi">2</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ERROR: Please enter a valid integer.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">mc</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ERROR: Parallel mode requires at least 2 concurrent downloads.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">mc</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">WARNING: Using more than 2 parallel CDS downloads may cause throttling or request failures.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
                <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">confirm</span> <span class="o">=</span> <span class="n">read_input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Do you still want to continue? (y/n): &quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">confirm</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;__EXIT__&quot;</span><span class="p">,</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">):</span>
                        <span class="k">return</span> <span class="n">confirm</span>
                    <span class="k">if</span> <span class="n">confirm</span> <span class="ow">in</span> <span class="n">NORMALIZATION_MAP</span><span class="p">[</span><span class="s2">&quot;confirmation&quot;</span><span class="p">]:</span>
                        <span class="n">confirm_choice</span> <span class="o">=</span> <span class="n">NORMALIZATION_MAP</span><span class="p">[</span><span class="s2">&quot;confirmation&quot;</span><span class="p">][</span><span class="n">confirm</span><span class="p">]</span>
                        <span class="k">break</span>
                    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Invalid input. Please enter &#39;y&#39; or &#39;n&#39;.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">confirm_choice</span> <span class="o">==</span> <span class="s2">&quot;no&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>

            <span class="n">settings</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;max_concurrent&quot;</span><span class="p">:</span> <span class="n">mc</span><span class="p">}</span>
            <span class="n">session</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;parallel_settings&quot;</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>
            <span class="n">say</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">You have enabled parallel downloads with a maximum of [</span><span class="si">{</span><span class="n">mc</span><span class="si">}</span><span class="s2">] concurrent downloads.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">settings</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.io.prompts.prompt_retry_settings" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">prompt_retry_settings</span>


<a href="#weather_data_retrieval.io.prompts.prompt_retry_settings" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">prompt_retry_settings</span><span class="p">(</span>
    <span class="n">session</span><span class="p">,</span>
    <span class="n">default_retries</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">default_delay</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">logger</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Ask user for retry limits.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>session</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="SessionState (weather_data_retrieval.utils.session_management.SessionState)" href="#weather_data_retrieval.utils.session_management.SessionState">SessionState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current session state to store retry settings.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_retries</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Default number of retry attempts (default = 6).</p>
              </div>
            </td>
            <td>
                  <code>6</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_delay</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Default delay (in seconds) between retries (default = 15).</p>
              </div>
            </td>
            <td>
                  <code>15</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="logging.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger for logging messages, by default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with 'max_retries' and 'retry_delay_sec', or control token "<strong>BACK</strong>" / "<strong>EXIT</strong>".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/io/prompts.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prompt_retry_settings</span><span class="p">(</span>
        <span class="n">session</span><span class="p">:</span> <span class="n">SessionState</span><span class="p">,</span>
        <span class="n">default_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
        <span class="n">default_delay</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ask user for retry limits.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    session : SessionState</span>
<span class="sd">        Current session state to store retry settings.</span>
<span class="sd">    default_retries : int</span>
<span class="sd">        Default number of retry attempts (default = 6).</span>
<span class="sd">    default_delay : int</span>
<span class="sd">        Default delay (in seconds) between retries (default = 15).</span>
<span class="sd">    logger : logging.Logger, optional</span>
<span class="sd">        Logger for logging messages, by default None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict | str</span>
<span class="sd">        Dictionary with &#39;max_retries&#39; and &#39;retry_delay_sec&#39;, or control token &quot;__BACK__&quot; / &quot;__EXIT__&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">60</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Retry Settings:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;These settings control how the program handles failed download attempts.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
    <span class="n">say</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Default values → Retries: </span><span class="si">{</span><span class="n">default_retries</span><span class="si">}</span><span class="s2">, Delay: </span><span class="si">{</span><span class="n">default_delay</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">user_input</span> <span class="o">=</span> <span class="n">read_input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Would you like to use the default retry settings? (y/n) [default y]: &quot;</span><span class="p">,</span>
                                <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user_input</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;__EXIT__&quot;</span><span class="p">,</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">user_input</span>

        <span class="k">if</span> <span class="n">user_input</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">normalized</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span>
        <span class="k">elif</span> <span class="n">user_input</span> <span class="ow">in</span> <span class="n">NORMALIZATION_MAP</span><span class="p">[</span><span class="s2">&quot;confirmation&quot;</span><span class="p">]:</span>
            <span class="n">normalized</span> <span class="o">=</span> <span class="n">NORMALIZATION_MAP</span><span class="p">[</span><span class="s2">&quot;confirmation&quot;</span><span class="p">][</span><span class="n">user_input</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ERROR: Invalid input. Please enter &#39;y&#39; or &#39;n&#39;.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">normalized</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
            <span class="n">settings</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;max_retries&quot;</span><span class="p">:</span> <span class="n">default_retries</span><span class="p">,</span> <span class="s2">&quot;retry_delay_sec&quot;</span><span class="p">:</span> <span class="n">default_delay</span><span class="p">}</span>
            <span class="n">session</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;retry_settings&quot;</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>
            <span class="n">say</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Using default retry settings of max_retries: [</span><span class="si">{</span><span class="n">default_retries</span><span class="si">}</span><span class="s2">], retry_delay_sec: [</span><span class="si">{</span><span class="n">default_delay</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">settings</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">max_retries_raw</span> <span class="o">=</span> <span class="n">read_input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Enter maximum number of retries (integer ≥ 0): &quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">max_retries_raw</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;__EXIT__&quot;</span><span class="p">,</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">max_retries_raw</span>
            <span class="n">delay_raw</span> <span class="o">=</span> <span class="n">read_input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Enter delay between retries (seconds, integer ≥ 0): &quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">delay_raw</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;__EXIT__&quot;</span><span class="p">,</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">delay_raw</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">max_retries</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_retries_raw</span><span class="p">)</span> <span class="k">if</span> <span class="n">max_retries_raw</span> <span class="k">else</span> <span class="n">default_retries</span>
                <span class="n">retry_delay_sec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">delay_raw</span><span class="p">)</span> <span class="k">if</span> <span class="n">delay_raw</span> <span class="k">else</span> <span class="n">default_delay</span>
                <span class="k">if</span> <span class="n">max_retries</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">retry_delay_sec</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ERROR: Values must be non-negative integers.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">settings</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;max_retries&quot;</span><span class="p">:</span> <span class="n">max_retries</span><span class="p">,</span> <span class="s2">&quot;retry_delay_sec&quot;</span><span class="p">:</span> <span class="n">retry_delay_sec</span><span class="p">}</span>
                <span class="n">session</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;retry_settings&quot;</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>
                <span class="n">say</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">You set max_retries=[</span><span class="si">{</span><span class="n">max_retries</span><span class="si">}</span><span class="s2">], retry_delay_sec=[</span><span class="si">{</span><span class="n">retry_delay_sec</span><span class="si">}</span><span class="s2">].&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">settings</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">say</span><span class="p">(</span><span class="s2">&quot;Please enter valid integer values for retries and delay.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.io.prompts.prompt_continue_confirmation" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">prompt_continue_confirmation</span>


<a href="#weather_data_retrieval.io.prompts.prompt_continue_confirmation" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">prompt_continue_confirmation</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Display a formatted download summary and confirm before starting downloads.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>session</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="SessionState (weather_data_retrieval.utils.session_management.SessionState)" href="#weather_data_retrieval.utils.session_management.SessionState">SessionState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>session state to summarise.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="logging.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger for logging messages, by default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if user confirms, False if user declines,
or control token "<strong>BACK</strong>" / "<strong>EXIT</strong>".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/io/prompts.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prompt_continue_confirmation</span><span class="p">(</span>
        <span class="n">session</span><span class="p">:</span> <span class="n">SessionState</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Display a formatted download summary and confirm before starting downloads.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    session : SessionState</span>
<span class="sd">        session state to summarise.</span>
<span class="sd">    logger : logging.Logger, optional</span>
<span class="sd">        Logger for logging messages, by default None.</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool | str</span>
<span class="sd">        True if user confirms, False if user declines,</span>
<span class="sd">        or control token &quot;__BACK__&quot; / &quot;__EXIT__&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
    <span class="n">say</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">user_input</span> <span class="o">=</span> <span class="n">read_input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Proceed with download? (y/n): &quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user_input</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;__EXIT__&quot;</span><span class="p">,</span> <span class="s2">&quot;__BACK__&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">user_input</span>
        <span class="k">if</span> <span class="n">user_input</span> <span class="ow">in</span> <span class="n">NORMALIZATION_MAP</span><span class="p">[</span><span class="s2">&quot;confirmation&quot;</span><span class="p">]:</span>
            <span class="n">choice</span> <span class="o">=</span> <span class="n">NORMALIZATION_MAP</span><span class="p">[</span><span class="s2">&quot;confirmation&quot;</span><span class="p">][</span><span class="n">user_input</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">choice</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
                <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Proceeding with download...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Download cancelled by user.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ERROR: Invalid input. Please enter &#39;y&#39; or &#39;n&#39;.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="weather_data_retrieval.sources.cds_era5" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">weather_data_retrieval.sources.cds_era5</span>


<a href="#weather_data_retrieval.sources.cds_era5" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.sources.cds_era5.prepare_cds_download" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">prepare_cds_download</span>


<a href="#weather_data_retrieval.sources.cds_era5.prepare_cds_download" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">prepare_cds_download</span><span class="p">(</span>
    <span class="n">session</span><span class="p">,</span>
    <span class="n">filename_base</span><span class="p">,</span>
    <span class="n">year</span><span class="p">,</span>
    <span class="n">month</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">,</span>
    <span class="n">echo_console</span><span class="p">,</span>
    <span class="n">allow_prompts</span><span class="p">,</span>
    <span class="n">dataset_config_mapping</span><span class="o">=</span><span class="n">CDS_DATASETS</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if a monthly ERA5 file already exists and decide whether to download.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>session</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="SessionState (weather_data_retrieval.utils.session_management.SessionState)" href="#weather_data_retrieval.utils.session_management.SessionState">SessionState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Session containing user configuration.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filename_base</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base name for the file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>year</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Year of the data to download.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>month</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Month of the data to download.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="logging.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger for logging messages.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>echo_console</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to echo prompts to console.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>allow_prompts</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to allow interactive prompts.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dataset_config_mapping</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mapping of dataset short names to their configurations.</p>
              </div>
            </td>
            <td>
                  <code><span title="weather_data_retrieval.utils.data_validation.CDS_DATASETS">CDS_DATASETS</span></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
                  <code>(download: bool, save_path: str)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>download: Whether to perform the download.
save_path: Full path for the target file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/sources/cds_era5.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prepare_cds_download</span><span class="p">(</span>
    <span class="n">session</span><span class="p">:</span> <span class="n">SessionState</span><span class="p">,</span>
    <span class="n">filename_base</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">month</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">,</span>
    <span class="n">echo_console</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">allow_prompts</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">dataset_config_mapping</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">CDS_DATASETS</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if a monthly ERA5 file already exists and decide whether to download.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    session : SessionState</span>
<span class="sd">        Session containing user configuration.</span>
<span class="sd">    filename_base : str</span>
<span class="sd">        Base name for the file.</span>
<span class="sd">    year : int</span>
<span class="sd">        Year of the data to download.</span>
<span class="sd">    month : int</span>
<span class="sd">        Month of the data to download.</span>
<span class="sd">    logger : logging.Logger, optional</span>
<span class="sd">        Logger for logging messages.</span>
<span class="sd">    echo_console : bool</span>
<span class="sd">        Whether to echo prompts to console.</span>
<span class="sd">    allow_prompts : bool</span>
<span class="sd">        Whether to allow interactive prompts.</span>
<span class="sd">    dataset_config_mapping : dict, optional</span>
<span class="sd">        Mapping of dataset short names to their configurations.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple: (download: bool, save_path: str)</span>
<span class="sd">        download: Whether to perform the download.</span>
<span class="sd">        save_path: Full path for the target file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">get_cds_dataset_config</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">dataset_config_mapping</span><span class="p">)</span>
    <span class="n">data_file_format</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data_download_format&quot;</span><span class="p">,</span> <span class="s2">&quot;grib&quot;</span><span class="p">)</span>

    <span class="c1"># Resolve base save directory</span>
    <span class="n">raw_save_dir</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;save_dir&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">data_dir</span><span class="p">(</span><span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">save_dir</span> <span class="o">=</span> <span class="n">resolve_under</span><span class="p">(</span><span class="n">data_dir</span><span class="p">(</span><span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">raw_save_dir</span><span class="p">)</span>

    <span class="c1"># Construct canonical save path</span>
    <span class="n">save_path</span> <span class="o">=</span> <span class="n">expected_save_path</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">filename_base</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">data_file_format</span><span class="p">)</span>
    <span class="n">policy</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;existing_file_action&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;case_by_case&quot;</span>
    <span class="n">download</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">save_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">policy</span> <span class="o">==</span> <span class="s2">&quot;skip_all&quot;</span><span class="p">:</span>
            <span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping existing file for </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span><span class="p">)</span>
            <span class="n">download</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">elif</span> <span class="n">policy</span> <span class="o">==</span> <span class="s2">&quot;overwrite_all&quot;</span><span class="p">:</span>
            <span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overwriting existing file for </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">policy</span> <span class="o">==</span> <span class="s2">&quot;case_by_case&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_prompts</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;existing_file_action=&#39;case_by_case&#39; requires interactive mode. &quot;</span>
                    <span class="s2">&quot;Use &#39;skip_all&#39; or &#39;overwrite_all&#39; for automatic runs.&quot;</span>
                <span class="p">)</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">user_input</span> <span class="o">=</span> <span class="n">read_input</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">File already exists for </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;Do you want to overwrite it? (y/n): &quot;</span><span class="p">,</span>
                    <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">user_input</span> <span class="ow">in</span> <span class="n">NORMALIZATION_MAP</span><span class="p">[</span><span class="s2">&quot;confirmation&quot;</span><span class="p">]:</span>
                    <span class="n">yn</span> <span class="o">=</span> <span class="n">NORMALIZATION_MAP</span><span class="p">[</span><span class="s2">&quot;confirmation&quot;</span><span class="p">][</span><span class="n">user_input</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">yn</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
                        <span class="n">log_msg</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Overwriting existing file for </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span>
                        <span class="p">)</span>
                        <span class="n">download</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">log_msg</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Skipping existing file for </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span>
                        <span class="p">)</span>
                        <span class="n">download</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">break</span>
                <span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;Invalid input. Please enter &#39;y&#39; or &#39;n&#39;.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log_msg</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unknown existing_file_action policy &#39;</span><span class="si">{</span><span class="n">policy</span><span class="si">}</span><span class="s2">&#39;; defaulting to &#39;skip_all&#39;.&quot;</span><span class="p">,</span>
                <span class="n">logger</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span>
            <span class="p">)</span>
            <span class="n">session</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;existing_file_action&quot;</span><span class="p">,</span> <span class="s2">&quot;skip_all&quot;</span><span class="p">)</span>
            <span class="n">download</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="n">download</span><span class="p">,</span> <span class="n">save_path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.sources.cds_era5.execute_cds_download" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">execute_cds_download</span>


<a href="#weather_data_retrieval.sources.cds_era5.execute_cds_download" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">execute_cds_download</span><span class="p">(</span>
    <span class="n">session</span><span class="p">,</span>
    <span class="n">save_path</span><span class="p">,</span>
    <span class="n">year</span><span class="p">,</span>
    <span class="n">month</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">,</span>
    <span class="n">echo_console</span><span class="p">,</span>
    <span class="n">dataset_config_mapping</span><span class="o">=</span><span class="n">CDS_DATASETS</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Execute a single ERA5 monthly download with retry logic.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>session</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="SessionState (weather_data_retrieval.utils.session_management.SessionState)" href="#weather_data_retrieval.utils.session_management.SessionState">SessionState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Session state containing the authenticated CDS API client.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Full path to save the downloaded file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>year</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Year of the data to download.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>month</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Month of the data to download.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="logging.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger for logging messages.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>echo_console</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to echo prompts to console.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dataset_config_mapping</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mapping of dataset short names to their configurations.</p>
              </div>
            </td>
            <td>
                  <code><span title="weather_data_retrieval.utils.data_validation.CDS_DATASETS">CDS_DATASETS</span></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>(year, month, status): tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>status = "success" | "failed"</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/sources/cds_era5.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">execute_cds_download</span><span class="p">(</span>
        <span class="n">session</span><span class="p">:</span> <span class="n">SessionState</span><span class="p">,</span>
        <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">month</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">logger</span><span class="p">,</span>
        <span class="n">echo_console</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">dataset_config_mapping</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">CDS_DATASETS</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Execute a single ERA5 monthly download with retry logic.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    session : SessionState</span>
<span class="sd">        Session state containing the authenticated CDS API client.</span>
<span class="sd">    save_path : str</span>
<span class="sd">        Full path to save the downloaded file.</span>
<span class="sd">    year : int</span>
<span class="sd">        Year of the data to download.</span>
<span class="sd">    month : int</span>
<span class="sd">        Month of the data to download.</span>
<span class="sd">    logger : logging.Logger, optional</span>
<span class="sd">        Logger for logging messages.</span>
<span class="sd">    echo_console : bool</span>
<span class="sd">        Whether to echo prompts to console.</span>
<span class="sd">    dataset_config_mapping : dict, optional</span>
<span class="sd">        Mapping of dataset short names to their configurations.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    (year, month, status): tuple</span>
<span class="sd">        status = &quot;success&quot; | &quot;failed&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Pull config fresh from CDS_DATASETS</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">get_cds_dataset_config</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">dataset_config_mapping</span><span class="o">=</span><span class="n">dataset_config_mapping</span><span class="p">)</span>
    <span class="n">dataset_product_name</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;dataset_product_name&quot;</span><span class="p">]</span>
    <span class="n">product_type</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;product_type&quot;</span><span class="p">]</span>
    <span class="n">data_download_format</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data_download_format&quot;</span><span class="p">,</span> <span class="s2">&quot;grib&quot;</span><span class="p">)</span>
    <span class="n">times</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;default_times&quot;</span><span class="p">,</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">h</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">:00&quot;</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">24</span><span class="p">)])</span>

    <span class="n">variables</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;variables&quot;</span><span class="p">)</span>
    <span class="n">grid_area</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;region_bounds&quot;</span><span class="p">)</span>
    <span class="n">cds_client_session</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;session_client&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cds_client_session</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;CDS client not initialized in session&quot;</span><span class="p">)</span>

    <span class="n">retry_conf</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;retry_settings&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{</span><span class="s2">&quot;max_retries&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;retry_delay_sec&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">}</span>
    <span class="n">max_retries</span> <span class="o">=</span> <span class="n">retry_conf</span><span class="p">[</span><span class="s2">&quot;max_retries&quot;</span><span class="p">]</span>
    <span class="n">retry_delay_sec</span> <span class="o">=</span> <span class="n">retry_conf</span><span class="p">[</span><span class="s2">&quot;retry_delay_sec&quot;</span><span class="p">]</span>
    <span class="n">days</span> <span class="o">=</span> <span class="n">month_days</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">)</span>

    <span class="n">month_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_retries</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Attempt </span><span class="si">{</span><span class="n">attempt</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="n">max_retries</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span><span class="p">)</span>
            <span class="n">cds_client_session</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span>
                <span class="n">dataset_product_name</span><span class="p">,</span>
                <span class="p">{</span>
                    <span class="s2">&quot;product_type&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">product_type</span><span class="p">],</span>
                    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="n">variables</span><span class="p">,</span>
                    <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">),</span>
                    <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;day&quot;</span><span class="p">:</span> <span class="n">days</span><span class="p">,</span>
                    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">times</span><span class="p">,</span>
                    <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="n">grid_area</span><span class="p">,</span>
                    <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="n">data_download_format</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">save_path</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">month_start</span>
            <span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SUCCESS: </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">format_duration</span><span class="p">(</span><span class="n">elapsed</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: Attempt </span><span class="si">{</span><span class="n">attempt</span><span class="si">}</span><span class="s2"> failed for </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="n">max_retries</span><span class="p">:</span>
                <span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Waiting </span><span class="si">{</span><span class="n">retry_delay_sec</span><span class="si">}</span><span class="s2"> seconds before retrying...&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">retry_delay_sec</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">api_url</span><span class="p">,</span> <span class="n">api_key</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_url&quot;</span><span class="p">),</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">)</span>
                    <span class="n">creds_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">api_url</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="n">api_key</span><span class="p">}</span>
                    <span class="n">cds_client_session_new</span> <span class="o">=</span> <span class="n">ensure_cds_connection</span><span class="p">(</span><span class="n">cds_client_session</span><span class="p">,</span> <span class="n">creds_dict</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">cds_client_session_new</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Re-authentication returned None client.&quot;</span><span class="p">)</span>
                    <span class="n">session</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;session_client&quot;</span><span class="p">,</span> <span class="n">cds_client_session_new</span><span class="p">)</span>
                    <span class="n">cds_client_session</span> <span class="o">=</span> <span class="n">cds_client_session_new</span>
                    <span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Re-authenticated CDS API client.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">auth_e</span><span class="p">:</span>
                    <span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Re-authentication failed: </span><span class="si">{</span><span class="n">auth_e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FAILURE: all </span><span class="si">{</span><span class="n">max_retries</span><span class="si">}</span><span class="s2"> attempts failed for </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="s2">&quot;failed&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.sources.cds_era5.download_cds_month" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">download_cds_month</span>


<a href="#weather_data_retrieval.sources.cds_era5.download_cds_month" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">download_cds_month</span><span class="p">(</span>
    <span class="n">session</span><span class="p">,</span>
    <span class="n">filename_base</span><span class="p">,</span>
    <span class="n">year</span><span class="p">,</span>
    <span class="n">month</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">,</span>
    <span class="n">echo_console</span><span class="p">,</span>
    <span class="n">allow_prompts</span><span class="p">,</span>
    <span class="n">successful_downloads</span><span class="p">,</span>
    <span class="n">failed_downloads</span><span class="p">,</span>
    <span class="n">skipped_downloads</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Orchestrate ERA5 monthly download: handle file checks, then execute download.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>Combines</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>(year, month, status): tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>status = "success" | "failed" | "skipped"</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/sources/cds_era5.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">download_cds_month</span><span class="p">(</span>
    <span class="n">session</span><span class="p">:</span> <span class="n">SessionState</span><span class="p">,</span>
    <span class="n">filename_base</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">month</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">,</span>
    <span class="n">echo_console</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">allow_prompts</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">successful_downloads</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="n">failed_downloads</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="n">skipped_downloads</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Orchestrate ERA5 monthly download: handle file checks, then execute download.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Combines parameters from `prepare_download` and `execute_download`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    (year, month, status): tuple</span>
<span class="sd">        status = &quot;success&quot; | &quot;failed&quot; | &quot;skipped&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">proceed</span><span class="p">,</span> <span class="n">save_path</span> <span class="o">=</span> <span class="n">prepare_cds_download</span><span class="p">(</span>
        <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
        <span class="n">filename_base</span><span class="o">=</span><span class="n">filename_base</span><span class="p">,</span>
        <span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span>
        <span class="n">month</span><span class="o">=</span><span class="n">month</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
        <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span><span class="p">,</span>
        <span class="n">allow_prompts</span><span class="o">=</span><span class="n">allow_prompts</span><span class="p">,</span>
        <span class="n">dataset_config_mapping</span><span class="o">=</span><span class="n">CDS_DATASETS</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">proceed</span><span class="p">:</span>
        <span class="n">skipped_downloads</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="s2">&quot;skipped&quot;</span><span class="p">)</span>

    <span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="n">execute_cds_download</span><span class="p">(</span>
        <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
        <span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span>
        <span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span>
        <span class="n">month</span><span class="o">=</span><span class="n">month</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
        <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span><span class="p">,</span>
        <span class="n">dataset_config_mapping</span><span class="o">=</span><span class="n">CDS_DATASETS</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;success&quot;</span><span class="p">:</span>
        <span class="n">successful_downloads</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">failed_downloads</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.sources.cds_era5.plan_cds_months" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">plan_cds_months</span>


<a href="#weather_data_retrieval.sources.cds_era5.plan_cds_months" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">plan_cds_months</span><span class="p">(</span>
    <span class="n">session</span><span class="p">,</span>
    <span class="n">filename_base</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">,</span>
    <span class="n">echo_console</span><span class="p">,</span>
    <span class="n">allow_prompts</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Build the list of months to download and which are being skipped due to existing files.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>session</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="SessionState (weather_data_retrieval.utils.session_management.SessionState)" href="#weather_data_retrieval.utils.session_management.SessionState">SessionState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Session containing user configuration.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filename_base</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base filename (without date or extension).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="logging.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger for logging messages.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>echo_console</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to echo prompts to console.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>allow_prompts</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to allow interactive prompts.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>(<span title="months_to_download">months_to_download</span>, <span title="months_skipped">months_skipped</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>months_to_download: list[(year, month)]</li>
<li>months_skipped: list[(year, month, path)]</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/sources/cds_era5.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plan_cds_months</span><span class="p">(</span>
    <span class="n">session</span><span class="p">:</span> <span class="n">SessionState</span><span class="p">,</span>
    <span class="n">filename_base</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">,</span>
    <span class="n">echo_console</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">allow_prompts</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">Path</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build the list of months to download and which are being skipped due to existing files.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    session : SessionState</span>
<span class="sd">        Session containing user configuration.</span>
<span class="sd">    filename_base : str</span>
<span class="sd">        Base filename (without date or extension).</span>
<span class="sd">    logger : logging.Logger, optional</span>
<span class="sd">        Logger for logging messages.</span>
<span class="sd">    echo_console : bool</span>
<span class="sd">        Whether to echo prompts to console.</span>
<span class="sd">    allow_prompts : bool</span>
<span class="sd">        Whether to allow interactive prompts.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    (months_to_download, months_skipped)</span>
<span class="sd">      - months_to_download: list[(year, month)]</span>
<span class="sd">      - months_skipped: list[(year, month, path)]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">policy</span> <span class="o">=</span> <span class="n">validate_existing_file_action</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">allow_prompts</span><span class="o">=</span><span class="n">allow_prompts</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span><span class="p">)</span>

    <span class="n">start_date</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_date&quot;</span><span class="p">)</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end_date&quot;</span><span class="p">)</span>
    <span class="n">save_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;save_dir&quot;</span><span class="p">))</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">end_date</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Build month list</span>
    <span class="n">months</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">cur</span> <span class="o">&lt;=</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">months</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">cur</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">cur</span><span class="o">.</span><span class="n">month</span><span class="p">))</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">12</span> <span class="k">else</span> <span class="n">datetime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">cur</span><span class="o">.</span><span class="n">month</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">months_to_download</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">months_skipped</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">Path</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="ow">in</span> <span class="n">months</span><span class="p">:</span>
        <span class="n">existing</span> <span class="o">=</span> <span class="n">find_existing_month_file</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">filename_base</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">existing</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">months_to_download</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">policy</span> <span class="o">==</span> <span class="s2">&quot;skip_all&quot;</span><span class="p">:</span>
            <span class="n">months_skipped</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">existing</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">policy</span> <span class="o">==</span> <span class="s2">&quot;overwrite_all&quot;</span><span class="p">:</span>
            <span class="n">months_skipped</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">existing</span><span class="p">))</span>
            <span class="n">months_to_download</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># interactive &#39;case_by_case&#39;</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">ans</span> <span class="o">=</span> <span class="n">read_input</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">File already exists for </span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">m</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">existing</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Overwrite this one? (y/n): &quot;</span><span class="p">,</span>
                    <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">ans</span> <span class="ow">in</span> <span class="n">NORMALIZATION_MAP</span><span class="p">[</span><span class="s2">&quot;confirmation&quot;</span><span class="p">]:</span>
                    <span class="n">yn</span> <span class="o">=</span> <span class="n">NORMALIZATION_MAP</span><span class="p">[</span><span class="s2">&quot;confirmation&quot;</span><span class="p">][</span><span class="n">ans</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">yn</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
                        <span class="n">months_to_download</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">months_skipped</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">existing</span><span class="p">))</span>
                    <span class="k">break</span>
                <span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;Please enter &#39;y&#39; or &#39;n&#39;.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span><span class="p">)</span>

    <span class="c1"># Report</span>
    <span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">===&gt; Checking for existing files...</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">months_skipped</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">months_skipped</span><span class="p">[:</span><span class="mi">5</span><span class="p">]:</span>
            <span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">m</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">months_skipped</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ... and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">months_skipped</span><span class="p">)</span><span class="o">-</span><span class="mi">5</span><span class="si">}</span><span class="s2"> more.&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span><span class="p">)</span>
    <span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Found [</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">months_skipped</span><span class="p">)</span><span class="si">}</span><span class="s2">] existing month(s) out of [</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">months</span><span class="p">)</span><span class="si">}</span><span class="s2">] requested month(s)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span><span class="p">)</span>
    <span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Policy for existing files: &#39;</span><span class="si">{</span><span class="n">policy</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">months_to_download</span><span class="p">,</span> <span class="n">months_skipped</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.sources.cds_era5.orchestrate_cds_downloads" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">orchestrate_cds_downloads</span>


<a href="#weather_data_retrieval.sources.cds_era5.orchestrate_cds_downloads" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">orchestrate_cds_downloads</span><span class="p">(</span>
    <span class="n">session</span><span class="p">,</span>
    <span class="n">filename_base</span><span class="p">,</span>
    <span class="n">successful_downloads</span><span class="p">,</span>
    <span class="n">failed_downloads</span><span class="p">,</span>
    <span class="n">skipped_downloads</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">,</span>
    <span class="n">echo_console</span><span class="p">,</span>
    <span class="n">allow_prompts</span><span class="p">,</span>
    <span class="n">dataset_config_mapping</span><span class="o">=</span><span class="n">CDS_DATASETS</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Handle and orchestrate ERA5 monthly downloads, supporting parallel or sequential execution.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>session</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="SessionState (weather_data_retrieval.utils.session_management.SessionState)" href="#weather_data_retrieval.utils.session_management.SessionState">SessionState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Session containing user configuration and authenticated client.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>successful_downloads</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mutable list to collect (year, month) tuples for successful downloads.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>failed_downloads</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mutable list to collect (year, month) tuples for failed downloads.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>skipped_downloads</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mutable list to collect (year, month) tuples for skipped downloads.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="logging.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger for logging messages.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>echo_console</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to echo prompts to console.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>allow_prompts</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to allow interactive prompts.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dataset_config_mapping</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mapping of dataset configurations, by default CDS_DATASETS.</p>
              </div>
            </td>
            <td>
                  <code><span title="weather_data_retrieval.utils.data_validation.CDS_DATASETS">CDS_DATASETS</span></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/sources/cds_era5.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">orchestrate_cds_downloads</span><span class="p">(</span>
        <span class="n">session</span><span class="p">:</span> <span class="n">SessionState</span><span class="p">,</span>
        <span class="n">filename_base</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">successful_downloads</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">failed_downloads</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">skipped_downloads</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">logger</span><span class="p">,</span>
        <span class="n">echo_console</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">allow_prompts</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">dataset_config_mapping</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">CDS_DATASETS</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handle and orchestrate ERA5 monthly downloads, supporting parallel or sequential execution.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    session : SessionState</span>
<span class="sd">        Session containing user configuration and authenticated client.</span>
<span class="sd">    successful_downloads : list</span>
<span class="sd">        Mutable list to collect (year, month) tuples for successful downloads.</span>
<span class="sd">    failed_downloads : list</span>
<span class="sd">        Mutable list to collect (year, month) tuples for failed downloads.</span>
<span class="sd">    skipped_downloads : list</span>
<span class="sd">        Mutable list to collect (year, month) tuples for skipped downloads.</span>
<span class="sd">    logger : logging.Logger, optional</span>
<span class="sd">        Logger for logging messages.</span>
<span class="sd">    echo_console : bool</span>
<span class="sd">        Whether to echo prompts to console.</span>
<span class="sd">    allow_prompts : bool</span>
<span class="sd">        Whether to allow interactive prompts.</span>
<span class="sd">    dataset_config_mapping : dict, optional</span>
<span class="sd">        Mapping of dataset configurations, by default CDS_DATASETS.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># (Optional) touch cfg to ensure dataset is valid; not stored, just validation side-effect</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">get_cds_dataset_config</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">CDS_DATASETS</span><span class="p">)</span>

    <span class="n">months_to_download</span><span class="p">,</span> <span class="n">months_skipped</span> <span class="o">=</span> <span class="n">plan_cds_months</span><span class="p">(</span>
        <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
        <span class="n">filename_base</span><span class="o">=</span><span class="n">filename_base</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
        <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span><span class="p">,</span>
        <span class="n">allow_prompts</span><span class="o">=</span><span class="n">allow_prompts</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">months_skipped</span><span class="p">:</span>
        <span class="n">skipped_downloads</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">months_to_download</span><span class="p">:</span>
        <span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Nothing to download (all months skipped).&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">parallel_conf</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;parallel_settings&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{</span><span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;max_concurrent&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">perf_counter</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">parallel_conf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enabled&quot;</span><span class="p">):</span>
        <span class="n">max_workers</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">parallel_conf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_concurrent&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
        <span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Parallelisation : Enabled -&gt; Beginning download with [</span><span class="si">{</span><span class="n">max_workers</span><span class="si">}</span><span class="s2">] concurrent tasks...</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
                    <span class="n">download_cds_month</span><span class="p">,</span>
                    <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
                    <span class="n">filename_base</span><span class="o">=</span><span class="n">filename_base</span><span class="p">,</span>
                    <span class="n">year</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
                    <span class="n">month</span><span class="o">=</span><span class="n">m</span><span class="p">,</span>
                    <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
                    <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span><span class="p">,</span>
                    <span class="n">allow_prompts</span><span class="o">=</span><span class="n">allow_prompts</span><span class="p">,</span>
                    <span class="n">successful_downloads</span><span class="o">=</span><span class="n">successful_downloads</span><span class="p">,</span>
                    <span class="n">failed_downloads</span><span class="o">=</span><span class="n">failed_downloads</span><span class="p">,</span>
                    <span class="n">skipped_downloads</span><span class="o">=</span><span class="n">skipped_downloads</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="ow">in</span> <span class="n">months_to_download</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">tasks</span><span class="p">):</span>
                <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Parallelisation : Disabled -&gt; Beginning download in sequential download mode ...</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="ow">in</span> <span class="n">months_to_download</span><span class="p">:</span>
            <span class="n">download_cds_month</span><span class="p">(</span>
                <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
                <span class="n">filename_base</span><span class="o">=</span><span class="n">filename_base</span><span class="p">,</span>
                <span class="n">year</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
                <span class="n">month</span><span class="o">=</span><span class="n">m</span><span class="p">,</span>
                <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
                <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span><span class="p">,</span>
                <span class="n">allow_prompts</span><span class="o">=</span><span class="n">allow_prompts</span><span class="p">,</span>
                <span class="n">successful_downloads</span><span class="o">=</span><span class="n">successful_downloads</span><span class="p">,</span>
                <span class="n">failed_downloads</span><span class="o">=</span><span class="n">failed_downloads</span><span class="p">,</span>
                <span class="n">skipped_downloads</span><span class="o">=</span><span class="n">skipped_downloads</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="n">elapsed</span> <span class="o">=</span> <span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
    <span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Total download wall time: </span><span class="si">{</span><span class="n">format_duration</span><span class="p">(</span><span class="n">elapsed</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="weather_data_retrieval.sources.open_meteo" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">weather_data_retrieval.sources.open_meteo</span>


<a href="#weather_data_retrieval.sources.open_meteo" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">








    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="weather_data_retrieval.utils.data_validation" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">weather_data_retrieval.utils.data_validation</span>


<a href="#weather_data_retrieval.utils.data_validation" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.utils.data_validation.normalize_input" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">normalize_input</span>


<a href="#weather_data_retrieval.utils.data_validation.normalize_input" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">normalize_input</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Normalize user input to canonical internal value as defined in NORMALIZATION_MAP.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The user input value to normalize.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>category</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The category of normalization (e.g., 'data_provider', 'dataset_short_name')</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The normalized value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/utils/data_validation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">normalize_input</span><span class="p">(</span>
        <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">category</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalize user input to canonical internal value as defined in NORMALIZATION_MAP.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    value : str</span>
<span class="sd">        The user input value to normalize.</span>
<span class="sd">    category : str</span>
<span class="sd">        The category of normalization (e.g., &#39;data_provider&#39;, &#39;dataset_short_name&#39;)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        The normalized value.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">NORMALIZATION_MAP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.utils.data_validation.format_duration" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">format_duration</span>


<a href="#weather_data_retrieval.utils.data_validation.format_duration" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">format_duration</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert seconds to a nice Hh Mm Ss string (with decimal seconds).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>seconds</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Duration in seconds.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>    str: Formatted duration string.</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/utils/data_validation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">format_duration</span><span class="p">(</span><span class="n">seconds</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert seconds to a nice Hh Mm Ss string (with decimal seconds).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    seconds : float</span>
<span class="sd">        Duration in seconds.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        str: Formatted duration string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">seconds</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">seconds</span><span class="p">)</span>

    <span class="n">hours</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">seconds</span> <span class="o">//</span> <span class="mi">3600</span><span class="p">)</span>
    <span class="n">days</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hours</span> <span class="o">//</span> <span class="mi">24</span><span class="p">)</span>
    <span class="n">minutes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">seconds</span> <span class="o">%</span> <span class="mi">3600</span><span class="p">)</span> <span class="o">//</span> <span class="mi">60</span><span class="p">)</span>
    <span class="n">secs</span> <span class="o">=</span> <span class="n">seconds</span> <span class="o">%</span> <span class="mi">60</span>  <span class="c1"># keep remainder as float</span>

    <span class="k">if</span> <span class="n">days</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">hours</span> <span class="o">=</span> <span class="n">hours</span> <span class="o">%</span> <span class="mi">24</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">days</span><span class="si">}</span><span class="s2">d </span><span class="si">{</span><span class="n">hours</span><span class="si">}</span><span class="s2">h </span><span class="si">{</span><span class="n">minutes</span><span class="si">}</span><span class="s2">m </span><span class="si">{</span><span class="n">secs</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span>
    <span class="k">if</span> <span class="n">hours</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hours</span><span class="si">}</span><span class="s2">h </span><span class="si">{</span><span class="n">minutes</span><span class="si">}</span><span class="s2">m </span><span class="si">{</span><span class="n">secs</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span>
    <span class="k">elif</span> <span class="n">minutes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">minutes</span><span class="si">}</span><span class="s2">m </span><span class="si">{</span><span class="n">secs</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">secs</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">s&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.utils.data_validation.format_coordinates_nwse" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">format_coordinates_nwse</span>


<a href="#weather_data_retrieval.utils.data_validation.format_coordinates_nwse" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">format_coordinates_nwse</span><span class="p">(</span><span class="n">boundaries</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Extracts and formats coordinates as integers in N-W-S-E order
Used for compact representation in filenames.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>boundaries</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of boundaries in the order [north, west, south, east]</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>    str: Formatted string in the format &#39;N{north}W{west}S{south}E{east}&#39;</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/utils/data_validation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">format_coordinates_nwse</span><span class="p">(</span><span class="n">boundaries</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts and formats coordinates as integers in N-W-S-E order</span>
<span class="sd">    Used for compact representation in filenames.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    boundaries : list</span>
<span class="sd">        List of boundaries in the order [north, west, south, east]</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        str: Formatted string in the format &#39;N{north}W{west}S{south}E{east}&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">boundaries</span>
    <span class="c1"># compact string for filenames</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;N</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="si">}</span><span class="s2">W</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="si">}</span><span class="s2">S</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">}</span><span class="s2">E</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.utils.data_validation.month_days" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">month_days</span>


<a href="#weather_data_retrieval.utils.data_validation.month_days" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">month_days</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get list of days in a month formatted as two-digit strings.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>year</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Year of interest.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>month</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Month of interest.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of days in the month as two-digit strings.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/utils/data_validation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">month_days</span><span class="p">(</span>
        <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">month</span><span class="p">:</span> <span class="nb">int</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get list of days in a month formatted as two-digit strings.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    year : int</span>
<span class="sd">        Year of interest.</span>
<span class="sd">    month : int</span>
<span class="sd">        Month of interest.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    List[str]</span>
<span class="sd">        List of days in the month as two-digit strings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">d</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">last</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.utils.data_validation.validate_data_provider" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">validate_data_provider</span>


<a href="#weather_data_retrieval.utils.data_validation.validate_data_provider" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">validate_data_provider</span><span class="p">(</span><span class="n">provider</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Ensure dataprovider is recognized and implemented.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>provider</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the data provider.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>    bool: True if valid, False otherwise.</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/utils/data_validation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_data_provider</span><span class="p">(</span><span class="n">provider</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensure dataprovider is recognized and implemented.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    provider : str</span>
<span class="sd">        Name of the data provider.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        bool: True if valid, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">provider</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;cds&quot;</span><span class="p">,</span> <span class="s2">&quot;open-meteo&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.utils.data_validation.validate_dataset_short_name" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">validate_dataset_short_name</span>


<a href="#weather_data_retrieval.utils.data_validation.validate_dataset_short_name" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">validate_dataset_short_name</span><span class="p">(</span><span class="n">dataset_short_name</span><span class="p">,</span> <span class="n">provider</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check dataset compatibility with provider.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dataset_short_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset short name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>provider</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the data provider.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if valid, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/utils/data_validation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_dataset_short_name</span><span class="p">(</span>
        <span class="n">dataset_short_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">provider</span><span class="p">:</span> <span class="nb">str</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check dataset compatibility with provider.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dataset_short_name : str</span>
<span class="sd">        Dataset short name.</span>
<span class="sd">    provider : str</span>
<span class="sd">        Name of the data provider.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        True if valid, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">provider</span> <span class="o">==</span> <span class="s2">&quot;cds&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dataset_short_name</span> <span class="ow">in</span> <span class="n">CDS_DATASETS</span>
    <span class="k">if</span> <span class="n">provider</span> <span class="o">==</span> <span class="s2">&quot;open-meteo&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Open-Meteo dataset validation not yet implemented.&quot;</span><span class="p">)</span>
    <span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Unknown provider &#39;</span><span class="si">{</span><span class="n">provider</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.utils.data_validation.validate_cds_api_key" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">validate_cds_api_key</span>


<a href="#weather_data_retrieval.utils.data_validation.validate_cds_api_key" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">validate_cds_api_key</span><span class="p">(</span>
    <span class="n">url</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Validate CDS API credentials by attempting to initialize a cdsapi.Client.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>url</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>CDS API URL.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>CDS API key.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="weather_data_retrieval.utils.logging.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger for logging messages, by default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>echo_console</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to echo messages to console, by default False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="cdsapi.Client">Client</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Authenticated client if successful, otherwise None.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/utils/data_validation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_cds_api_key</span><span class="p">(</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">echo_console</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">cdsapi</span><span class="o">.</span><span class="n">Client</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate CDS API credentials by attempting to initialize a cdsapi.Client.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    url : str</span>
<span class="sd">        CDS API URL.</span>
<span class="sd">    key : str</span>
<span class="sd">        CDS API key.</span>
<span class="sd">    logger : logging.Logger, optional</span>
<span class="sd">        Logger for logging messages, by default None.</span>
<span class="sd">    echo_console : bool, optional</span>
<span class="sd">        Whether to echo messages to console, by default False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cdsapi.Client | None</span>
<span class="sd">        Authenticated client if successful, otherwise None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">logger</span><span class="p">:</span>
        <span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;Testing CDS API connection with provided credentials...&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">)</span>

    <span class="c1"># 1) Initialize client</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">cdsapi</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">logger</span><span class="p">:</span>
            <span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Failed to initialize CDS client: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># 2) Probe using the predefined payload (normalize keys minimally)</span>
    <span class="c1">#    Expecting a dict like: test_payload = {&quot;dataset&quot;: &quot;...&quot;, &quot;request&quot;: {...}}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">test_payload</span><span class="p">[</span><span class="s2">&quot;dataset&quot;</span><span class="p">]</span>
        <span class="n">request</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">test_payload</span><span class="p">[</span><span class="s2">&quot;request&quot;</span><span class="p">])</span>  <span class="c1"># shallow copy so we can tweak keys safely</span>

        <span class="c1"># product_type must be a string</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;product_type&quot;</span><span class="p">),</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">request</span><span class="p">[</span><span class="s2">&quot;product_type&quot;</span><span class="p">]:</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;product_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="s2">&quot;product_type&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># -------------------------------------------------------------------</span>
        <span class="n">tmp_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">())</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;cds_probe_</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span><span class="si">}</span><span class="s2">.grib&quot;</span>

        <span class="k">if</span> <span class="n">logger</span><span class="p">:</span>
            <span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Probing ERA5 permissions with a minimal retrieve...&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
            <span class="n">request_items</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">request_items</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">   </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Request details: dataset=&#39;</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">&#39; </span><span class="si">{</span><span class="n">request_items</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>

        <span class="n">client</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">logger</span><span class="p">:</span>
            <span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Permission probe succeeded.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">client</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">logger</span><span class="p">:</span>
            <span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Authentication/probe failed: </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;401&quot;</span> <span class="ow">in</span> <span class="n">msg</span> <span class="ow">or</span> <span class="s2">&quot;Unauthorized&quot;</span> <span class="ow">in</span> <span class="n">msg</span> <span class="ow">or</span> <span class="s2">&quot;operation not allowed&quot;</span> <span class="ow">in</span> <span class="n">msg</span><span class="p">:</span>
                <span class="n">log_msg</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">CDS returned 401/Unauthorized. This usually means you haven’t accepted the &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;licence for &#39;</span><span class="si">{</span><span class="n">test_payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dataset&#39;</span><span class="p">,</span><span class="s1">&#39;(unknown)&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;. Please log into the CDS website and accept it.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">logger</span><span class="p">,</span>
                    <span class="n">level</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="c1"># Cleanup</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;tmp_path&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span> <span class="ow">and</span> <span class="n">tmp_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">tmp_path</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.utils.data_validation.validate_directory" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">validate_directory</span>


<a href="#weather_data_retrieval.utils.data_validation.validate_directory" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">validate_directory</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if path exists or can be created.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory path to validate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if path exists or was created successfully, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/utils/data_validation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_directory</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if path exists or can be created.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path : str</span>
<span class="sd">        Directory path to validate.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        True if path exists or was created successfully, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.utils.data_validation.validate_date" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">validate_date</span>


<a href="#weather_data_retrieval.utils.data_validation.validate_date" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">validate_date</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">allow_month_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Validate date format as YYYY-MM-DD or optionally YYYY-MM.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Date string to validate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>allow_month_only</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, also accept YYYY-MM format, by default False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if valid, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/utils/data_validation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_date</span><span class="p">(</span>
        <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">allow_month_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate date format as YYYY-MM-DD or optionally YYYY-MM.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    value : str</span>
<span class="sd">        Date string to validate.</span>
<span class="sd">    allow_month_only : bool, optional</span>
<span class="sd">        If True, also accept YYYY-MM format, by default False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        True if valid, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Try full date format first</span>
        <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">allow_month_only</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Try year-month format</span>
                <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;%Y-%m&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid date format &#39;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;. Expected YYYY-MM-DD or YYYY-MM.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.utils.data_validation.parse_date_with_defaults" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">parse_date_with_defaults</span>


<a href="#weather_data_retrieval.utils.data_validation.parse_date_with_defaults" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">parse_date_with_defaults</span><span class="p">(</span>
    <span class="n">date_str</span><span class="p">,</span> <span class="n">default_to_month_end</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Parse date string and apply defaults for incomplete dates.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>date_str</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Date string in format YYYY-MM-DD or YYYY-MM.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_to_month_end</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True and date is YYYY-MM format, default to last day of month.
If False and date is YYYY-MM format, default to first day of month.
By default False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="datetime.datetime">datetime</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of (parsed datetime object, ISO format string YYYY-MM-DD)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If date string is invalid.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/utils/data_validation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_date_with_defaults</span><span class="p">(</span>
        <span class="n">date_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">default_to_month_end</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">datetime</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse date string and apply defaults for incomplete dates.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    date_str : str</span>
<span class="sd">        Date string in format YYYY-MM-DD or YYYY-MM.</span>
<span class="sd">    default_to_month_end : bool, optional</span>
<span class="sd">        If True and date is YYYY-MM format, default to last day of month.</span>
<span class="sd">        If False and date is YYYY-MM format, default to first day of month.</span>
<span class="sd">        By default False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple[datetime, str]</span>
<span class="sd">        Tuple of (parsed datetime object, ISO format string YYYY-MM-DD)</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If date string is invalid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">date_str</span><span class="p">)</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>  <span class="c1"># YYYY-MM format</span>
        <span class="n">year</span><span class="p">,</span> <span class="n">month</span> <span class="o">=</span> <span class="n">date_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">year</span><span class="p">,</span> <span class="n">month</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">month</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">default_to_month_end</span><span class="p">:</span>
            <span class="c1"># Get last day of month</span>
            <span class="n">last_day</span> <span class="o">=</span> <span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">date_str_full</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">last_day</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Default to first day</span>
            <span class="n">date_str_full</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">-01&quot;</span>

        <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date_str_full</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dt</span><span class="p">,</span> <span class="n">date_str_full</span>

    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">date_str</span><span class="p">)</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>  <span class="c1"># YYYY-MM-DD format</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date_str</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dt</span><span class="p">,</span> <span class="n">date_str</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid date format &#39;</span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s2">&#39;. Expected YYYY-MM-DD or YYYY-MM.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.utils.data_validation.clamp_era5_available_end_date" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">clamp_era5_available_end_date</span>


<a href="#weather_data_retrieval.utils.data_validation.clamp_era5_available_end_date" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">clamp_era5_available_end_date</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Clamp end date to ERA5 data availability boundary (8 days ago).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>end</code>
            </td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Desired end date.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td></td>            <td>
                  <code>    datetime: Clamped end date.</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>NOTES</code></td>            <td>
                  <code>ERA5 data is available up to 8 days prior to the current date.</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td></td>            <td>
                  <code>8-day lag is used to ensure data availability.</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/utils/data_validation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">clamp_era5_available_end_date</span><span class="p">(</span><span class="n">end</span><span class="p">:</span> <span class="n">datetime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clamp end date to ERA5 data availability boundary (8 days ago).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    end : datetime</span>
<span class="sd">        Desired end date.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        datetime: Clamped end date.</span>

<span class="sd">    NOTES: ERA5 data is available up to 8 days prior to the current date.</span>
<span class="sd">    8-day lag is used to ensure data availability.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">EIGHT_DAY_LAG</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">microsecond</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">EIGHT_DAY_LAG</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">end</span> <span class="o">&gt;</span> <span class="n">upper</span><span class="p">:</span>
        <span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adjusting end date from </span><span class="si">{</span><span class="n">end</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="si">}</span><span class="s2"> to data availability boundary </span><span class="si">{</span><span class="n">upper</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="si">}</span><span class="s2"> (−</span><span class="si">{</span><span class="n">EIGHT_DAY_LAG</span><span class="si">}</span><span class="s2"> days).&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">upper</span>
    <span class="k">return</span> <span class="n">end</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.utils.data_validation.validate_coordinates" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">validate_coordinates</span>


<a href="#weather_data_retrieval.utils.data_validation.validate_coordinates" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">validate_coordinates</span><span class="p">(</span><span class="n">north</span><span class="p">,</span> <span class="n">west</span><span class="p">,</span> <span class="n">south</span><span class="p">,</span> <span class="n">east</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Ensure coordinates are within realistic bounds.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>north</code>
            </td>
            <td>
                  <code><span title="int">int</span> | <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Northern latitude boundary.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>west</code>
            </td>
            <td>
                  <code><span title="int">int</span> | <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Western longitude boundary.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>south</code>
            </td>
            <td>
                  <code><span title="int">int</span> | <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Southern latitude boundary.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>east</code>
            </td>
            <td>
                  <code><span title="int">int</span> | <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Eastern longitude boundary.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if coordinates are valid, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/utils/data_validation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_coordinates</span><span class="p">(</span>
        <span class="n">north</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">west</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">south</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">east</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensure coordinates are within realistic bounds.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    north : int | float</span>
<span class="sd">        Northern latitude boundary.</span>
<span class="sd">    west : int | float</span>
<span class="sd">        Western longitude boundary.</span>
<span class="sd">    south : int | float</span>
<span class="sd">        Southern latitude boundary.</span>
<span class="sd">    east : int | float</span>
<span class="sd">        Eastern longitude boundary.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        True if coordinates are valid, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">([</span>
        <span class="o">-</span><span class="mi">90</span> <span class="o">&lt;=</span> <span class="n">south</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">,</span>
        <span class="o">-</span><span class="mi">90</span> <span class="o">&lt;=</span> <span class="n">north</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">,</span>
        <span class="o">-</span><span class="mi">180</span> <span class="o">&lt;=</span> <span class="n">west</span> <span class="o">&lt;=</span> <span class="mi">180</span><span class="p">,</span>
        <span class="o">-</span><span class="mi">180</span> <span class="o">&lt;=</span> <span class="n">east</span> <span class="o">&lt;=</span> <span class="mi">180</span><span class="p">,</span>
        <span class="n">north</span> <span class="o">&gt;</span> <span class="n">south</span>
    <span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.utils.data_validation.validate_variables" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">validate_variables</span>


<a href="#weather_data_retrieval.utils.data_validation.validate_variables" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">validate_variables</span><span class="p">(</span>
    <span class="n">variable_list</span><span class="p">,</span>
    <span class="n">variable_restrictions</span><span class="p">,</span>
    <span class="n">restriction_allow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Ensure user-specified variables are available for this dataset.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>variable_list</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of variable names to validate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>variable_restrictions</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of variables that are either allowed or disallowed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>restriction_allow</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, variable_restrictions is an allowlist (i.e. in). If False, it's a denylist
(i.e. not in)</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if all variables are valid, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/utils/data_validation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_variables</span><span class="p">(</span>
        <span class="n">variable_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">variable_restrictions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">restriction_allow</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensure user-specified variables are available for this dataset.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    variable_list : list[str]</span>
<span class="sd">        List of variable names to validate.</span>
<span class="sd">    variable_restrictions : list[str]</span>
<span class="sd">        List of variables that are either allowed or disallowed.</span>
<span class="sd">    restriction_allow : bool</span>
<span class="sd">        If True, variable_restrictions is an allowlist (i.e. in). If False, it&#39;s a denylist</span>
<span class="sd">        (i.e. not in)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        True if all variables are valid, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">variable_list</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Normalize for case consistency</span>
    <span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">variable_list</span><span class="p">]</span>
    <span class="n">restrictions</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">variable_restrictions</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">restriction_allow</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">v</span> <span class="ow">in</span> <span class="n">restrictions</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">restrictions</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.utils.data_validation.validate_existing_file_action" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">validate_existing_file_action</span>


<a href="#weather_data_retrieval.utils.data_validation.validate_existing_file_action" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">validate_existing_file_action</span><span class="p">(</span>
    <span class="n">session</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">allow_prompts</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Normalize existing_file_action for the current run-mode.
- If 'case_by_case' is set but prompts are not allowed (automatic mode),
  coerce to 'skip_all' and warn.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>session</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current session state.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>allow_prompts</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether prompts are allowed (i.e., interactive mode).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="weather_data_retrieval.utils.logging.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger for logging messages.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>echo_console</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to echo messages to console.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Normalized existing_file_action policy.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/utils/data_validation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_existing_file_action</span><span class="p">(</span>
        <span class="n">session</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">allow_prompts</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">logger</span><span class="p">,</span>
        <span class="n">echo_console</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalize existing_file_action for the current run-mode.</span>
<span class="sd">    - If &#39;case_by_case&#39; is set but prompts are not allowed (automatic mode),</span>
<span class="sd">      coerce to &#39;skip_all&#39; and warn.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    session : Any</span>
<span class="sd">        Current session state.</span>
<span class="sd">    allow_prompts : bool</span>
<span class="sd">        Whether prompts are allowed (i.e., interactive mode).</span>
<span class="sd">    logger : logging.Logger</span>
<span class="sd">        Logger for logging messages.</span>
<span class="sd">    echo_console : bool</span>
<span class="sd">        Whether to echo messages to console.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        Normalized existing_file_action policy.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">policy</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;existing_file_action&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;case_by_case&quot;</span>
    <span class="n">allowed</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;overwrite_all&quot;</span><span class="p">,</span> <span class="s2">&quot;skip_all&quot;</span><span class="p">,</span> <span class="s2">&quot;case_by_case&quot;</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">policy</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">allow_prompts</span><span class="p">:</span>
            <span class="c1"># treat as case-by-case if we can prompt</span>
            <span class="n">log_msg</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unrecognized existing_file_action=&#39;</span><span class="si">{</span><span class="n">policy</span><span class="si">}</span><span class="s2">&#39;; treating as &#39;case_by_case&#39; due to interactive mode.&quot;</span><span class="p">,</span>
                <span class="n">logger</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="s2">&quot;case_by_case&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># automatic: force skip_all</span>
            <span class="n">log_msg</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unrecognized existing_file_action=&#39;</span><span class="si">{</span><span class="n">policy</span><span class="si">}</span><span class="s2">&#39;; coercing to &#39;skip_all&#39; for automatic mode.&quot;</span><span class="p">,</span>
                <span class="n">logger</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span>
            <span class="p">)</span>
            <span class="n">session</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;existing_file_action&quot;</span><span class="p">,</span> <span class="s2">&quot;skip_all&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="s2">&quot;skip_all&quot;</span>

    <span class="k">if</span> <span class="n">policy</span> <span class="o">==</span> <span class="s2">&quot;case_by_case&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">allow_prompts</span><span class="p">:</span>
        <span class="n">log_msg</span><span class="p">(</span>
            <span class="s2">&quot;existing_file_action=&#39;case_by_case&#39; is not supported without prompts; &quot;</span>
            <span class="s2">&quot;coercing to &#39;skip_all&#39; for automatic mode.&quot;</span><span class="p">,</span>
            <span class="n">logger</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span>
        <span class="p">)</span>
        <span class="n">session</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;existing_file_action&quot;</span><span class="p">,</span> <span class="s2">&quot;skip_all&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;skip_all&quot;</span>

    <span class="k">return</span> <span class="n">policy</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.utils.data_validation.validate_config" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">validate_config</span>


<a href="#weather_data_retrieval.utils.data_validation.validate_config" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">validate_config</span><span class="p">(</span>
    <span class="n">config</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">run_mode</span><span class="o">=</span><span class="s2">&quot;automatic&quot;</span><span class="p">,</span>
    <span class="n">echo_console</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">live_auth_check</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Entry point. Validates common shape then dispatches to provider-specific validator.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration dictionary.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="weather_data_retrieval.utils.logging.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger for logging messages, by default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>run_mode</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Run mode, either 'interactive' or 'automatic', by default "automatic".</p>
              </div>
            </td>
            <td>
                  <code>&#39;automatic&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>echo_console</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to echo messages to console, by default False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>live_auth_check</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to perform live authentication checks (e.g., CDS API), by default False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/utils/data_validation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_config</span><span class="p">(</span>
        <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">run_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;automatic&quot;</span><span class="p">,</span>
        <span class="n">echo_console</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">live_auth_check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Entry point. Validates common shape then dispatches to provider-specific validator.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    config : dict</span>
<span class="sd">        Configuration dictionary.</span>
<span class="sd">    logger : logging.Logger, optional</span>
<span class="sd">        Logger for logging messages, by default None.</span>
<span class="sd">    run_mode : str, optional</span>
<span class="sd">        Run mode, either &#39;interactive&#39; or &#39;automatic&#39;, by default &quot;automatic&quot;.</span>
<span class="sd">    echo_console : bool, optional</span>
<span class="sd">        Whether to echo messages to console, by default False.</span>
<span class="sd">    live_auth_check : bool, optional</span>
<span class="sd">        Whether to perform live authentication checks (e.g., CDS API), by default False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_validate_common</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span> <span class="n">run_mode</span><span class="o">=</span><span class="n">run_mode</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span><span class="p">)</span>

    <span class="n">provider</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;data_provider&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">provider</span> <span class="o">==</span> <span class="s2">&quot;cds&quot;</span><span class="p">:</span>
        <span class="n">_validate_cds</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span> <span class="n">run_mode</span><span class="o">=</span><span class="n">run_mode</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span><span class="p">,</span> <span class="n">live_auth_check</span><span class="o">=</span><span class="n">live_auth_check</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">provider</span> <span class="o">==</span> <span class="s2">&quot;open-meteo&quot;</span><span class="p">:</span>
        <span class="n">_validate_open_meteo</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span> <span class="n">run_mode</span><span class="o">=</span><span class="n">run_mode</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="n">echo_console</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported provider: </span><span class="si">{</span><span class="n">provider</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="weather_data_retrieval.utils.file_management" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">weather_data_retrieval.utils.file_management</span>


<a href="#weather_data_retrieval.utils.file_management" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.utils.file_management.generate_filename_hash" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">generate_filename_hash</span>


<a href="#weather_data_retrieval.utils.file_management.generate_filename_hash" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">generate_filename_hash</span><span class="p">(</span>
    <span class="n">dataset_short_name</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> <span class="n">boundaries</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generate a unique hash for the download parameters that will be used to create the filename.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dataset_short_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dataset short name (era5-world etc).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>variables</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of variable names.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>boundaries</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of boundaries [north, west, south, east].</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>    str: A unique hash string representing the download parameters.</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/utils/file_management.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_filename_hash</span><span class="p">(</span>
        <span class="n">dataset_short_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">variables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">boundaries</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a unique hash for the download parameters that will be used to create the filename.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dataset_short_name : str</span>
<span class="sd">        The dataset short name (era5-world etc).</span>
<span class="sd">    variables : list[str]</span>
<span class="sd">        List of variable names.</span>
<span class="sd">    boundaries : list[float]</span>
<span class="sd">        List of boundaries [north, west, south, east].</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        str: A unique hash string representing the download parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create unique string from all parameters</span>
    <span class="n">param_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dataset_short_name</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="nb">sorted</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">boundaries</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Generate hash</span>
    <span class="n">hash_object</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">param_string</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">hash_object</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">12</span><span class="p">]</span>  <span class="c1"># 12 characters</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.utils.file_management.find_existing_month_file" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">find_existing_month_file</span>


<a href="#weather_data_retrieval.utils.file_management.find_existing_month_file" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">find_existing_month_file</span><span class="p">(</span>
    <span class="n">save_dir</span><span class="p">,</span> <span class="n">filename_base</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Tolerant matcher that finds an existing file for the given month.
Accepts both <code>_YYYY-MM.ext</code> and <code>_YYYY_MM.ext</code> patterns and any extension.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>save_dir</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory where files are saved.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filename_base</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base filename (without date or extension).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>year</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Year of the file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>month</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Month of the file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="pathlib.Path">Path</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the existing file if found, else None.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/utils/file_management.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_existing_month_file</span><span class="p">(</span>
        <span class="n">save_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
        <span class="n">filename_base</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">month</span><span class="p">:</span> <span class="nb">int</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tolerant matcher that finds an existing file for the given month.</span>
<span class="sd">    Accepts both `_YYYY-MM.ext` and `_YYYY_MM.ext` patterns and any extension.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    save_dir : Path</span>
<span class="sd">        Directory where files are saved.</span>
<span class="sd">    filename_base : str</span>
<span class="sd">        Base filename (without date or extension).</span>
<span class="sd">    year : int</span>
<span class="sd">        Year of the file.</span>
<span class="sd">    month : int</span>
<span class="sd">        Month of the file.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Optional[Path]</span>
<span class="sd">        Path to the existing file if found, else None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">save_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">save_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Accept dash or underscore between year-month; any extension</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="sa">rf</span><span class="s2">&quot;^</span><span class="si">{</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">filename_base</span><span class="p">)</span><span class="si">}</span><span class="s2">_(?:</span><span class="si">{</span><span class="n">year</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">[-_]</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">)\.[A-Za-z0-9]+$&quot;</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">save_dir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">and</span> <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">p</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.utils.file_management.estimate_era5_monthly_file_size" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">estimate_era5_monthly_file_size</span>


<a href="#weather_data_retrieval.utils.file_management.estimate_era5_monthly_file_size" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">estimate_era5_monthly_file_size</span><span class="p">(</span>
    <span class="n">variables</span><span class="p">,</span>
    <span class="n">area</span><span class="p">,</span>
    <span class="n">grid_resolution</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
    <span class="n">timestep_hours</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">bytes_per_value</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Estimate ERA5 GRIB file size (MB) for a monthly dataset.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>variables</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Variables requested (e.g. ['2m_temperature', 'total_precipitation']).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>area</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>[north, west, south, east] geographic bounds in degrees.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>grid_resolution</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Grid spacing in degrees (default 0.25° for ERA5).</p>
              </div>
            </td>
            <td>
                  <code>0.25</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>timestep_hours</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Temporal resolution in hours (1 = hourly, 3 = 3-hourly, 6 = 6-hourly, etc.).</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bytes_per_value</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bytes per gridpoint per variable (float32 = 4 bytes).</p>
              </div>
            </td>
            <td>
                  <code>4.0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Estimated monthly file size in MB.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/utils/file_management.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">estimate_era5_monthly_file_size</span><span class="p">(</span>
    <span class="n">variables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">area</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
    <span class="n">grid_resolution</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span>
    <span class="n">timestep_hours</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">bytes_per_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0</span><span class="p">,</span>  <span class="c1"># typically float32</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimate ERA5 GRIB file size (MB) for a monthly dataset.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    variables : list[str]</span>
<span class="sd">        Variables requested (e.g. [&#39;2m_temperature&#39;, &#39;total_precipitation&#39;]).</span>
<span class="sd">    area : list[float]</span>
<span class="sd">        [north, west, south, east] geographic bounds in degrees.</span>
<span class="sd">    grid_resolution : float</span>
<span class="sd">        Grid spacing in degrees (default 0.25° for ERA5).</span>
<span class="sd">    timestep_hours : float</span>
<span class="sd">        Temporal resolution in hours (1 = hourly, 3 = 3-hourly, 6 = 6-hourly, etc.).</span>
<span class="sd">    bytes_per_value : float</span>
<span class="sd">        Bytes per gridpoint per variable (float32 = 4 bytes).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Estimated monthly file size in MB.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">variables</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">area</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="n">north</span><span class="p">,</span> <span class="n">west</span><span class="p">,</span> <span class="n">south</span><span class="p">,</span> <span class="n">east</span> <span class="o">=</span> <span class="n">area</span>
    <span class="n">n_vars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>

    <span class="c1"># --- Reference (from empirical files)</span>
    <span class="n">ref_size_MB</span> <span class="o">=</span> <span class="mf">0.509</span>
    <span class="n">ref_vars</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">ref_area_deg2</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="n">ref_res</span> <span class="o">=</span> <span class="mf">0.25</span>
    <span class="n">ref_timestep_hours</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">days_per_month</span> <span class="o">=</span> <span class="mi">30</span>

    <span class="c1"># --- Compute derived quantities</span>
    <span class="c1"># Handle wrap-around longitude</span>
    <span class="n">lon_span</span> <span class="o">=</span> <span class="p">(</span><span class="n">east</span> <span class="o">-</span> <span class="n">west</span><span class="p">)</span> <span class="k">if</span> <span class="n">east</span> <span class="o">&gt;</span> <span class="n">west</span> <span class="k">else</span> <span class="p">(</span><span class="mi">360</span> <span class="o">+</span> <span class="n">east</span> <span class="o">-</span> <span class="n">west</span><span class="p">)</span>
    <span class="n">lat_span</span> <span class="o">=</span> <span class="n">north</span> <span class="o">-</span> <span class="n">south</span>
    <span class="n">req_area_deg2</span> <span class="o">=</span> <span class="n">lat_span</span> <span class="o">*</span> <span class="n">lon_span</span>

    <span class="c1"># --- Compute scaling factors</span>
    <span class="n">area_factor</span> <span class="o">=</span> <span class="n">req_area_deg2</span> <span class="o">/</span> <span class="n">ref_area_deg2</span>
    <span class="n">var_factor</span> <span class="o">=</span> <span class="n">n_vars</span> <span class="o">/</span> <span class="n">ref_vars</span>
    <span class="n">res_factor</span> <span class="o">=</span> <span class="p">(</span><span class="n">ref_res</span> <span class="o">/</span> <span class="n">grid_resolution</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">timestep_factor</span> <span class="o">=</span> <span class="p">(</span><span class="n">ref_timestep_hours</span> <span class="o">/</span> <span class="n">timestep_hours</span><span class="p">)</span>
    <span class="n">time_factor</span> <span class="o">=</span> <span class="n">timestep_factor</span> <span class="o">*</span> <span class="p">(</span><span class="n">days_per_month</span> <span class="o">/</span> <span class="mi">30</span><span class="p">)</span>  <span class="c1"># normalize to 30 days</span>

    <span class="c1"># --- Estimated size (MB)</span>
    <span class="n">estimated_MB</span> <span class="o">=</span> <span class="n">ref_size_MB</span> <span class="o">*</span> <span class="n">var_factor</span> <span class="o">*</span> <span class="n">area_factor</span> <span class="o">*</span> <span class="n">res_factor</span> <span class="o">*</span> <span class="n">time_factor</span>

    <span class="c1"># --- Safety floor</span>
    <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">estimated_MB</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># at least 0.05 MB</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.utils.file_management.estimate_cds_download" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">estimate_cds_download</span>


<a href="#weather_data_retrieval.utils.file_management.estimate_cds_download" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">estimate_cds_download</span><span class="p">(</span>
    <span class="n">variables</span><span class="p">,</span>
    <span class="n">area</span><span class="p">,</span>
    <span class="n">start_date</span><span class="p">,</span>
    <span class="n">end_date</span><span class="p">,</span>
    <span class="n">observed_speed_mbps</span><span class="p">,</span>
    <span class="n">grid_resolution</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
    <span class="n">timestep_hours</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">bytes_per_value</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span>
    <span class="n">overhead_per_request_s</span><span class="o">=</span><span class="mf">180.0</span><span class="p">,</span>
    <span class="n">overhead_per_var_s</span><span class="o">=</span><span class="mf">12.0</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Estimate per-file and total download size/time for CDS (ERA5) retrievals,
using an empirically grounded file size model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>variables</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Variables selected (e.g. ['2m_temperature', 'total_precipitation']).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>area</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>[north, west, south, east] bounds in degrees.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_date</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Date range (YYYY-MM-DD).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_date</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Date range (YYYY-MM-DD).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>observed_speed_mbps</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Measured internet speed in megabits per second (Mbps).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>grid_resolution</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Grid resolution in degrees (default 0.25°).</p>
              </div>
            </td>
            <td>
                  <code>0.25</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>timestep_hours</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Temporal resolution in hours (default 1-hourly).</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bytes_per_value</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bytes per stored value (float32 = 4).</p>
              </div>
            </td>
            <td>
                  <code>4.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>overhead_per_request_s</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fixed CDS request overhead time (queue/prep).</p>
              </div>
            </td>
            <td>
                  <code>180.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>overhead_per_var_s</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Per-variable overhead for CDS throttling/prep.</p>
              </div>
            </td>
            <td>
                  <code>12.0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>{
  "months": int,
  "file_size_MB": float,
  "total_size_MB": float,
  "time_per_file_sec": float,
  "total_time_sec": float
}</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/utils/file_management.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">estimate_cds_download</span><span class="p">(</span>
        <span class="n">variables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">area</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
        <span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">observed_speed_mbps</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">grid_resolution</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span>
        <span class="n">timestep_hours</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">bytes_per_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0</span><span class="p">,</span>
        <span class="n">overhead_per_request_s</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">180.0</span><span class="p">,</span>      <span class="c1"># ignored but kept for signature consistency</span>
        <span class="n">overhead_per_var_s</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">12.0</span><span class="p">,</span>       <span class="c1"># ignored but kept for signature consistency</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimate per-file and total download size/time for CDS (ERA5) retrievals,</span>
<span class="sd">    using an empirically grounded file size model.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    variables : list[str]</span>
<span class="sd">        Variables selected (e.g. [&#39;2m_temperature&#39;, &#39;total_precipitation&#39;]).</span>
<span class="sd">    area : list[float]</span>
<span class="sd">        [north, west, south, east] bounds in degrees.</span>
<span class="sd">    start_date, end_date : str</span>
<span class="sd">        Date range (YYYY-MM-DD).</span>
<span class="sd">    observed_speed_mbps : float</span>
<span class="sd">        Measured internet speed in megabits per second (Mbps).</span>
<span class="sd">    grid_resolution : float, optional</span>
<span class="sd">        Grid resolution in degrees (default 0.25°).</span>
<span class="sd">    timestep_hours : float, optional</span>
<span class="sd">        Temporal resolution in hours (default 1-hourly).</span>
<span class="sd">    bytes_per_value : float, optional</span>
<span class="sd">        Bytes per stored value (float32 = 4).</span>
<span class="sd">    overhead_per_request_s : float, optional</span>
<span class="sd">        Fixed CDS request overhead time (queue/prep).</span>
<span class="sd">    overhead_per_var_s : float, optional</span>
<span class="sd">        Per-variable overhead for CDS throttling/prep.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        {</span>
<span class="sd">          &quot;months&quot;: int,</span>
<span class="sd">          &quot;file_size_MB&quot;: float,</span>
<span class="sd">          &quot;total_size_MB&quot;: float,</span>
<span class="sd">          &quot;time_per_file_sec&quot;: float,</span>
<span class="sd">          &quot;total_time_sec&quot;: float</span>
<span class="sd">        }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">variables</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">area</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">start_date</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">end_date</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;months&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;file_size_MB&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;total_size_MB&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;time_per_file_sec&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;total_time_sec&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="c1"># ---------- month list (inclusive) ----------</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">end_date</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">months</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">month</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">e</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">y</span> <span class="o">==</span> <span class="n">e</span><span class="o">.</span><span class="n">year</span> <span class="ow">and</span> <span class="n">m</span> <span class="o">&lt;=</span> <span class="n">e</span><span class="o">.</span><span class="n">month</span><span class="p">):</span>
        <span class="c1"># days in this month</span>
        <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
            <span class="n">next_first</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">next_first</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">this_first</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="p">(</span><span class="n">next_first</span> <span class="o">-</span> <span class="n">this_first</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
        <span class="n">months</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">dim</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
            <span class="n">y</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">n_files</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">months</span><span class="p">)</span>
    <span class="n">n_vars</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">))</span>

    <span class="c1"># ---------- area → grid cells ----------</span>
    <span class="n">north</span><span class="p">,</span> <span class="n">west</span><span class="p">,</span> <span class="n">south</span><span class="p">,</span> <span class="n">east</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span>
    <span class="c1"># handle wrap-around longitude</span>
    <span class="n">lon_span</span> <span class="o">=</span> <span class="p">(</span><span class="n">east</span> <span class="o">-</span> <span class="n">west</span><span class="p">)</span> <span class="k">if</span> <span class="n">east</span> <span class="o">&gt;</span> <span class="n">west</span> <span class="k">else</span> <span class="p">(</span><span class="mf">360.0</span> <span class="o">+</span> <span class="n">east</span> <span class="o">-</span> <span class="n">west</span><span class="p">)</span>
    <span class="n">lat_span</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">north</span> <span class="o">-</span> <span class="n">south</span><span class="p">)</span>
    <span class="n">lat_cells</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">lat_span</span> <span class="o">/</span> <span class="n">grid_resolution</span><span class="p">)))</span>
    <span class="n">lon_cells</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">lon_span</span> <span class="o">/</span> <span class="n">grid_resolution</span><span class="p">)))</span>
    <span class="n">grid_cells</span> <span class="o">=</span> <span class="n">lat_cells</span> <span class="o">*</span> <span class="n">lon_cells</span>

    <span class="c1"># ---------- file sizes (use your existing estimator for MB) ----------</span>
    <span class="n">file_size_MB</span> <span class="o">=</span> <span class="n">estimate_era5_monthly_file_size</span><span class="p">(</span>
        <span class="n">variables</span><span class="o">=</span><span class="n">variables</span><span class="p">,</span>
        <span class="n">area</span><span class="o">=</span><span class="n">area</span><span class="p">,</span>
        <span class="n">grid_resolution</span><span class="o">=</span><span class="n">grid_resolution</span><span class="p">,</span>
        <span class="n">timestep_hours</span><span class="o">=</span><span class="n">timestep_hours</span><span class="p">,</span>
        <span class="n">bytes_per_value</span><span class="o">=</span><span class="n">bytes_per_value</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">total_size_MB</span> <span class="o">=</span> <span class="n">file_size_MB</span> <span class="o">*</span> <span class="n">n_files</span>

    <span class="c1"># ---------- timing model constants (tune if you like) ----------</span>
    <span class="n">BASELINE_SEC</span>   <span class="o">=</span> <span class="mf">30.0</span>            <span class="c1"># small per-request overhead</span>
    <span class="n">UNITS_PER_SEC</span>  <span class="o">=</span> <span class="mf">8_000_000.0</span>     <span class="c1"># processing throughput (units -&gt; seconds); lower = more conservative</span>
    <span class="n">SERVER_CAP_Mbps</span> <span class="o">=</span> <span class="mf">400.0</span>          <span class="c1"># upper network cap in megabits/sec (≈ 50 MB/s)</span>
    <span class="n">SAFETY_FACTOR</span>  <span class="o">=</span> <span class="mf">5.0</span>             <span class="c1"># inflate to capture throttling, retries, etc.</span>

    <span class="c1"># Effective MB/s (convert from Mbps → MB/s)</span>
    <span class="n">line_MBps</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">observed_speed_mbps</span><span class="p">)</span> <span class="o">/</span> <span class="mf">8.0</span><span class="p">)</span>
    <span class="n">srv_MBps</span>  <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">SERVER_CAP_Mbps</span> <span class="o">/</span> <span class="mf">8.0</span><span class="p">)</span>
    <span class="n">eff_MBps</span>  <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">line_MBps</span><span class="p">,</span> <span class="n">srv_MBps</span><span class="p">)</span>

    <span class="n">per_file_secs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">days_in_month</span><span class="p">)</span> <span class="ow">in</span> <span class="n">months</span><span class="p">:</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="mf">24.0</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">timestep_hours</span><span class="p">))</span> <span class="o">*</span> <span class="n">days_in_month</span><span class="p">)</span>

        <span class="c1"># processing “units” = grid_cells × steps × vars</span>
        <span class="n">units</span> <span class="o">=</span> <span class="n">grid_cells</span> <span class="o">*</span> <span class="n">steps</span> <span class="o">*</span> <span class="n">n_vars</span>
        <span class="n">processing_sec</span> <span class="o">=</span> <span class="n">BASELINE_SEC</span> <span class="o">+</span> <span class="p">(</span><span class="n">units</span> <span class="o">/</span> <span class="n">UNITS_PER_SEC</span><span class="p">)</span>

        <span class="c1"># network time based on file size and effective MB/s</span>
        <span class="n">network_sec</span> <span class="o">=</span> <span class="n">file_size_MB</span> <span class="o">/</span> <span class="n">eff_MBps</span>

        <span class="n">per_file_secs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">processing_sec</span> <span class="o">+</span> <span class="n">network_sec</span><span class="p">)</span> <span class="o">*</span> <span class="n">SAFETY_FACTOR</span><span class="p">)</span>

    <span class="n">time_per_file_sec</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">per_file_secs</span><span class="p">)</span> <span class="k">if</span> <span class="n">per_file_secs</span> <span class="k">else</span> <span class="mf">0.0</span>
    <span class="n">total_time_sec</span>    <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">per_file_secs</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;months&quot;</span><span class="p">:</span> <span class="n">n_files</span><span class="p">,</span>
        <span class="s2">&quot;file_size_MB&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">file_size_MB</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
        <span class="s2">&quot;total_size_MB&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">total_size_MB</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
        <span class="s2">&quot;time_per_file_sec&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">time_per_file_sec</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="s2">&quot;total_time_sec&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="n">total_time_sec</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.utils.file_management.expected_save_path" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">expected_save_path</span>


<a href="#weather_data_retrieval.utils.file_management.expected_save_path" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">expected_save_path</span><span class="p">(</span>
    <span class="n">save_dir</span><span class="p">,</span> <span class="n">filename_base</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">data_format</span><span class="o">=</span><span class="s2">&quot;grib&quot;</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Construct canonical save path for monthly data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>save_dir</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base directory for saving. If None, defaults to osme_common.paths.data_dir().</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filename_base</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base name without date or extension.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>year</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Year and month of the file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>month</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Year and month of the file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_format</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>File extension, e.g., 'grib' or 'nc'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;grib&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Resolved path under the proper data directory.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/utils/file_management.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">expected_save_path</span><span class="p">(</span>
        <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filename_base</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">month</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">data_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;grib&quot;</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Construct canonical save path for monthly data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    save_dir : str | Path | None</span>
<span class="sd">        Base directory for saving. If None, defaults to osme_common.paths.data_dir().</span>
<span class="sd">    filename_base : str</span>
<span class="sd">        Base name without date or extension.</span>
<span class="sd">    year, month : int</span>
<span class="sd">        Year and month of the file.</span>
<span class="sd">    data_format : str</span>
<span class="sd">        File extension, e.g., &#39;grib&#39; or &#39;nc&#39;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Path</span>
<span class="sd">        Resolved path under the proper data directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">resolve_under</span><span class="p">(</span><span class="n">data_dir</span><span class="p">(</span><span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">save_dir</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">base</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename_base</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">year</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">data_format</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="weather_data_retrieval.utils.logging" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">weather_data_retrieval.utils.logging</span>


<a href="#weather_data_retrieval.utils.logging" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.utils.logging.build_download_summary" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">build_download_summary</span>


<a href="#weather_data_retrieval.utils.logging.build_download_summary" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">build_download_summary</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">speed_mbps</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Construct a formatted summary string of the current download configuration.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>session</code>
            </td>
            <td>
                  <code><span title="SessionState">SessionState</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current session state containing all parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>estimates</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing download size and time estimates.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>speed_mbps</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Measured or estimated internet speed in Mbps.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Nicely formatted summary string for display or logging.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/utils/logging.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build_download_summary</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
                           <span class="n">estimates</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                           <span class="n">speed_mbps</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Construct a formatted summary string of the current download configuration.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    session : SessionState</span>
<span class="sd">        Current session state containing all parameters.</span>
<span class="sd">    estimates : dict</span>
<span class="sd">        Dictionary containing download size and time estimates.</span>
<span class="sd">    speed_mbps : float</span>
<span class="sd">        Measured or estimated internet speed in Mbps.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        Nicely formatted summary string for display or logging.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span> <span class="mi">60</span> <span class="o">+</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Download Request Summary</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Provider: </span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data_provider&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Dataset: </span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dataset_short_name&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Dates: </span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;start_date&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> → </span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;end_date&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Area: </span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;region_bounds&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Variables: </span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;variables&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Save Directory: </span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;save_dir&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Retries: </span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;retry_settings&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Parallelisation: </span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parallel_settings&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;----------------------------------------</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Estimated number of monthly files: </span><span class="si">{</span><span class="n">estimates</span><span class="p">[</span><span class="s1">&#39;months&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Estimated size per file: </span><span class="si">{</span><span class="n">estimates</span><span class="p">[</span><span class="s1">&#39;file_size_MB&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,.1f</span><span class="si">}</span><span class="s2"> MB</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Estimated total size: </span><span class="si">{</span><span class="n">estimates</span><span class="p">[</span><span class="s1">&#39;total_size_MB&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,.1f</span><span class="si">}</span><span class="s2"> MB</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Measured connection speed: </span><span class="si">{</span><span class="n">speed_mbps</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> Mbps</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Estimated maximum time per file: </span><span class="si">{</span><span class="n">_format_duration</span><span class="p">(</span><span class="n">estimates</span><span class="p">[</span><span class="s1">&#39;time_per_file_sec&#39;</span><span class="p">])</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Estimated maximum total time: </span><span class="si">{</span><span class="n">_format_duration</span><span class="p">(</span><span class="n">estimates</span><span class="p">[</span><span class="s1">&#39;total_time_sec&#39;</span><span class="p">])</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">summary</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.utils.logging.setup_logger" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">setup_logger</span>


<a href="#weather_data_retrieval.utils.logging.setup_logger" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">setup_logger</span><span class="p">(</span>
    <span class="n">save_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">run_mode</span><span class="o">=</span><span class="s2">&quot;interactive&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize and return a configured logger.</p>
<p>Logs are written to <repo_root>/logs (or $OSME_LOG_DIR) by default,
with optional console output in interactive or verbose modes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>save_dir</code>
            </td>
            <td>
                  <code><span title="str">str</span> or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory to save log files. If None, defaults to osme_common.paths.log_dir().</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>run_mode</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Either 'interactive' or 'automatic', by default 'interactive'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;interactive&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to echo logs to console in automatic mode, by default False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="logging.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configured logger instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/utils/logging.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">setup_logger</span><span class="p">(</span>
        <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">run_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;interactive&quot;</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize and return a configured logger.</span>

<span class="sd">    Logs are written to &lt;repo_root&gt;/logs (or $OSME_LOG_DIR) by default,</span>
<span class="sd">    with optional console output in interactive or verbose modes.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    save_dir : str or None, optional</span>
<span class="sd">        Directory to save log files. If None, defaults to osme_common.paths.log_dir().</span>
<span class="sd">    run_mode : str, optional</span>
<span class="sd">        Either &#39;interactive&#39; or &#39;automatic&#39;, by default &#39;interactive&#39;.</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        Whether to echo logs to console in automatic mode, by default False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    logging.Logger</span>
<span class="sd">        Configured logger instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># --- Resolve log directory ---</span>
    <span class="n">base_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">save_dir</span> <span class="k">else</span> <span class="n">log_dir</span><span class="p">(</span><span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">base_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M%S&quot;</span><span class="p">)</span>
    <span class="n">log_path</span> <span class="o">=</span> <span class="n">base_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;run_</span><span class="si">{</span><span class="n">run_mode</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">.log&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;weather_retrieval&quot;</span><span class="p">)</span>
    <span class="c1"># Make sure logger captures everything; handlers will filter</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

    <span class="c1"># Clear old handlers safely</span>
    <span class="k">if</span> <span class="n">logger</span><span class="o">.</span><span class="n">hasHandlers</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

    <span class="c1"># File handler — DEBUG (captures prompts + everything)</span>
    <span class="n">fh</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">log_path</span><span class="p">)</span>
    <span class="n">fh</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
    <span class="n">fh</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> | </span><span class="si">%(levelname)s</span><span class="s2"> | </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>

    <span class="c1"># Console handler:</span>
    <span class="c1"># - interactive: always show console at INFO+</span>
    <span class="c1"># - automatic: show console only if verbose=True</span>
    <span class="n">add_console</span> <span class="o">=</span> <span class="p">(</span><span class="n">run_mode</span> <span class="o">==</span> <span class="s2">&quot;interactive&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">run_mode</span> <span class="o">==</span> <span class="s2">&quot;automatic&quot;</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">add_console</span><span class="p">:</span>
        <span class="n">ch</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
        <span class="n">ch</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>   <span class="c1"># &lt;- no DEBUG on console, so prompts won&#39;t duplicate</span>
        <span class="n">ch</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Logging initialized at </span><span class="si">{</span><span class="n">log_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">logger</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.utils.logging.log_msg" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">log_msg</span>


<a href="#weather_data_retrieval.utils.logging.log_msg" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">log_msg</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="n">echo_console</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Unified logging utility.
- Always logs to file.
- Echo to console (via tqdm.write) only in interactive mode.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>msg</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Message to log.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="logging.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>level</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logging level: 'info', 'warning', 'error', 'exception', by default "info".</p>
              </div>
            </td>
            <td>
                  <code>&#39;info&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>echo_console</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to also echo to console, by default False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/utils/logging.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">log_msg</span><span class="p">(</span>
        <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">logger</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;info&quot;</span><span class="p">,</span>
        <span class="n">echo_console</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unified logging utility.</span>
<span class="sd">    - Always logs to file.</span>
<span class="sd">    - Echo to console (via tqdm.write) only in interactive mode.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    msg : str</span>
<span class="sd">        Message to log.</span>
<span class="sd">    logger : logging.Logger</span>
<span class="sd">        Logger instance.</span>
<span class="sd">    level : str, optional</span>
<span class="sd">        Logging level: &#39;info&#39;, &#39;warning&#39;, &#39;error&#39;, &#39;exception&#39;, by default &quot;info&quot;.</span>
<span class="sd">    echo_console : bool, optional</span>
<span class="sd">        Whether to also echo to console, by default False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">logger</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Logger instance must be provided to log_msg().&quot;</span><span class="p">)</span>

    <span class="n">log_fn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
    <span class="n">log_fn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">echo_console</span><span class="p">:</span>
        <span class="n">tqdm</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.utils.logging.create_final_log_file" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">create_final_log_file</span>


<a href="#weather_data_retrieval.utils.logging.create_final_log_file" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">create_final_log_file</span><span class="p">(</span>
    <span class="n">session</span><span class="p">,</span>
    <span class="n">filename_base</span><span class="p">,</span>
    <span class="n">original_logger</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">delete_original</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">reattach_to_final</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a final log file with the same naming pattern as data files.
Copies content from the original log file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>session</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span>(<span title="SessionState">SessionState</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current session state.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filename_base</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base filename pattern (same as data files).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>original_logger</code>
            </td>
            <td>
                  <code><span title="logging.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The original logger instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>delete_original</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to delete the original log file after creating the final one, by default True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reattach_to_final</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to reattach the logger to the final log file, by default True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the final log file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>packages/weather_data_retrieval/src/weather_data_retrieval/utils/logging.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_final_log_file</span><span class="p">(</span>
        <span class="n">session</span><span class="p">,</span>
        <span class="n">filename_base</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">original_logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">delete_original</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">reattach_to_final</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a final log file with the same naming pattern as data files.</span>
<span class="sd">    Copies content from the original log file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    session : Any (SessionState)</span>
<span class="sd">        Current session state.</span>
<span class="sd">    filename_base : str</span>
<span class="sd">        Base filename pattern (same as data files).</span>
<span class="sd">    original_logger : logging.Logger</span>
<span class="sd">        The original logger instance.</span>
<span class="sd">    delete_original : bool, optional</span>
<span class="sd">        Whether to delete the original log file after creating the final one, by default True.</span>
<span class="sd">    reattach_to_final : bool, optional</span>
<span class="sd">        Whether to reattach the logger to the final log file, by default True.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        Path to the final log file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># 1) locate the current FileHandler</span>
    <span class="n">fh</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">original_logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">):</span>
            <span class="n">fh</span> <span class="o">=</span> <span class="n">h</span>
            <span class="k">break</span>

    <span class="k">if</span> <span class="n">fh</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fh</span><span class="p">,</span> <span class="s2">&quot;baseFilename&quot;</span><span class="p">):</span>
        <span class="c1"># No file handler found</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">original_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">fh</span><span class="o">.</span><span class="n">baseFilename</span><span class="p">)</span>

    <span class="c1"># 2) build final path</span>
    <span class="n">save_dir_raw</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;save_dir&quot;</span><span class="p">)</span>
    <span class="n">save_dir</span> <span class="o">=</span> <span class="n">resolve_under</span><span class="p">(</span><span class="n">data_dir</span><span class="p">(</span><span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">save_dir_raw</span><span class="p">)</span> <span class="k">if</span> <span class="n">save_dir_raw</span> <span class="k">else</span> <span class="n">data_dir</span><span class="p">(</span><span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">start</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_date&quot;</span><span class="p">)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end_date&quot;</span><span class="p">)</span>
    <span class="n">retrieved</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">T%H%M%S&quot;</span><span class="p">)</span>

    <span class="n">final_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename_base</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">end</span><span class="si">}</span><span class="s2">_retrieved-</span><span class="si">{</span><span class="n">retrieved</span><span class="si">}</span><span class="s2">.log&quot;</span>
    <span class="n">final_path</span> <span class="o">=</span> <span class="n">save_dir</span> <span class="o">/</span> <span class="n">final_name</span>
    <span class="n">final_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># 3) flush &amp; close the original handler, detach from logger</span>
    <span class="n">fh</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">original_logger</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>

    <span class="c1"># 4) copy to final and optionally delete original</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># If same filesystem, you could also use os.replace to move instead of copy</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">original_path</span><span class="p">,</span> <span class="n">final_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">delete_original</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">original_path</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Reattach the original handler if something failed so we don&#39;t lose logging</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fh</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">original_path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> | </span><span class="si">%(levelname)s</span><span class="s2"> | </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">))</span>
            <span class="n">original_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c1"># Log to console if possible</span>
        <span class="n">original_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create final log file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># 5) optionally attach a new FileHandler pointing at the final file</span>
    <span class="k">if</span> <span class="n">reattach_to_final</span><span class="p">:</span>
        <span class="n">new_fh</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">final_path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="n">new_fh</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
        <span class="n">new_fh</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> | </span><span class="si">%(levelname)s</span><span class="s2"> | </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="n">original_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">new_fh</span><span class="p">)</span>

    <span class="c1"># 6) log a confirmation (now goes to final file if reattached, and to console in interactive mode)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">original_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Final log file created: </span><span class="si">{</span><span class="n">final_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">final_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="weather_data_retrieval.utils.session_management" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">weather_data_retrieval.utils.session_management</span>


<a href="#weather_data_retrieval.utils.session_management" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="weather_data_retrieval.utils.session_management.SessionState" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">SessionState</span>


<a href="#weather_data_retrieval.utils.session_management.SessionState" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">












  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="weather_data_retrieval.utils.session_management.SessionState.first_unfilled_key" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">first_unfilled_key</span>


<a href="#weather_data_retrieval.utils.session_management.SessionState.first_unfilled_key" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">first_unfilled_key</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return the first key in the ordered fields that is not filled.
This enables a simple wizard-like progression and supports
backtracking by clearing fields with <code>unset(key)</code>.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="weather_data_retrieval.utils.session_management.SessionState.summary" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">summary</span>


<a href="#weather_data_retrieval.utils.session_management.SessionState.summary" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">summary</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return a nice printable summary of all fields in a tabular format.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="weather_data_retrieval.utils.session_management.SessionState.to_dict" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">to_dict</span>


<a href="#weather_data_retrieval.utils.session_management.SessionState.to_dict" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">to_dict</span><span class="p">(</span><span class="n">only_filled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Flatten the session into a plain dict suitable for runner.run(...).
If only_filled=True, include only keys that have been filled.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>only_filled</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to include only filled keys, by default False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flattened session dictionary.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.utils.session_management.get_cds_dataset_config" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_cds_dataset_config</span>


<a href="#weather_data_retrieval.utils.session_management.get_cds_dataset_config" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_cds_dataset_config</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">dataset_config_mapping</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return dataset configuration dictionary based on session short name.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>session</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="SessionState (weather_data_retrieval.utils.session_management.SessionState)" href="#weather_data_retrieval.utils.session_management.SessionState">SessionState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current session state containing user selections.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dataset_config_mapping</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The mapping of dataset short names to their configurations.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The configuration dictionary for the selected dataset.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.utils.session_management.map_config_to_session" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">map_config_to_session</span>


<a href="#weather_data_retrieval.utils.session_management.map_config_to_session" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">map_config_to_session</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Validate and map a loaded JSON config into SessionState.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cfg</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Loaded configuration dictionary.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>session</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="SessionState (weather_data_retrieval.utils.session_management.SessionState)" href="#weather_data_retrieval.utils.session_management.SessionState">SessionState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The session state to populate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="returns:" open>
  <summary>Returns:</summary>
  <p>tuple : (bool, list[str])
    (ok, messages): ok=False if any hard error prevents continuing.</p>
</details>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.utils.session_management.ensure_cds_connection" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">ensure_cds_connection</span>


<a href="#weather_data_retrieval.utils.session_management.ensure_cds_connection" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">ensure_cds_connection</span><span class="p">(</span>
    <span class="n">client</span><span class="p">,</span>
    <span class="n">creds</span><span class="p">,</span>
    <span class="n">max_reauth_attempts</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">wait_between_attempts</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Ensure a valid CDS API client. Re-authenticate automatically if the connection drops.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="cdsapi.Client">Client</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current CDS API client.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>creds</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>{'url': str, 'key': str} stored from initial login.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_reauth_attempts</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum reconnection attempts before aborting.</p>
              </div>
            </td>
            <td>
                  <code>6</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wait_between_attempts</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Wait time (seconds) between re-auth attempts.</p>
              </div>
            </td>
            <td>
                  <code>15</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="cdsapi.Client">Client</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Valid client or None if re-authentication ultimately fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="weather_data_retrieval.utils.session_management.internet_speedtest" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">internet_speedtest</span>


<a href="#weather_data_retrieval.utils.session_management.internet_speedtest" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">internet_speedtest</span><span class="p">(</span>
    <span class="n">test_urls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">max_seconds</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
    <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">echo_console</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Download ~100MB test file from a fast CDN to estimate speed (MB/s).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>test_urls</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of URLs of the test files.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_seconds</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum time to wait for a response, by default 15 seconds.</p>
              </div>
            </td>
            <td>
                  <code>15</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>    float: Estimated download speed in Mbps.</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.instant", "search.suggest", "search.highlight", "toc.integrate", "content.code.copy", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>