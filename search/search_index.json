{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"A Public-Data Framework for Marginal Emissions Factor Estimation","text":""},{"location":"#repository-overview","title":"Repository Overview","text":"<p>The purpose of this project is to develop an open-source framework that transforms publicly available weather and grid data into directionally accurate marginal emissions factors (MEFs).</p> <p>This project is currently under development, and this repository will be updated as new code is developed.</p> <p>The status of the various modules can be found in the Repository Structure and Contents section below.</p> <p></p>"},{"location":"#project-context-and-overview","title":"Project Context and Overview","text":"<p>Marginal emissions are an important concept when evaluating the carbon impact of electricity usage, and they differ from the better known and more widely used average emissions. Average emissions tell you the carbon intensity of all electricity generated over some period, while marginal emissions tell you the carbon intensity of the next unit of electricity (or the last unit avoided). When evaluating the specific impacts of electricity usage in a given time and location, marginal emissions become much more relevant.</p> <p>In order to truly calculate marginal emissions factors, one needs access to detailed grid data traditionally only held by grid operators. However, there is a growing body of research exploring the possibility of estimating marginal emissions factors using publicly available data sources, such as weather data and aggregate grid demand and emissions data.</p> <p></p>"},{"location":"#project-purpose","title":"Project Purpose","text":"<p>The goal of this project is to provide a transparent, reproducible framework for estimating marginal emissions factors (MEFs) using only publicly available data sources. In doing so, this work aims to make meaningful, time- and location-specific carbon insights available in regions where access to grid dispatch data is limited.</p> <p>This framework focuses on two core capabilities: </p> <ol> <li> <p>Data Acquisition and Preparation - A pipeline to retrieve, clean, and integrate large-scale weather and generation/emissions datasets in a consistent, analysis-ready format.</p> </li> <li> <p>Marginal Emissions Estimation - A modeling workflow for estimating MEFs that are:</p> <ul> <li>directionally accurate,</li> <li>stable across seasonal and diurnal conditions, and</li> <li>transparent to inspect and extend.</li> </ul> </li> </ol> <p>While this project currently develops use cases for India, the workflow is intended to be generalizable, enabling users to adapt the approach to other regions with publicly available data.</p> <p>The documentation for this repository contains more information and definitions for the core concepts of energy, emissions, the grid, and techniques used in this project.</p> <p></p>"},{"location":"#repository-structure-and-contents","title":"Repository Structure and Contents","text":"<p>This repository is designed as a modular framework, where each module can evolve or be replaced independently. The top-level modules are packaged for long-term maintainability and distributed development.</p> <p></p>"},{"location":"#module-overview","title":"Module Overview","text":"Module Description Status weather_data_retrieval Fully packaged CLI + batch utilities to download ERA5 and ERA5-Land data from ECMWF CDS. Open-Meteo under development \u2705 Available Now [grid_data_retrieval]((packages/grid_data_retrieval/docs/index.md) CLI + batch utilities to download demand, generation, and emissions data from public grid sources. \ud83d\udea7 Under Development data_cleaning_and_joining Spatial alignment, temporal resampling, and integration of grid + weather datasets with memory-efficient formats. \ud83d\udea7 Under Development marginal_emissions_modelling Methods for estimating MEFs and evaluating models. Designed to accommodate several modelling approaches. \ud83d\udea7 Under Development"},{"location":"#repository-structure","title":"Repository Structure","text":"<pre><code>.open-source-marginal-emissions/\n    \u251c\u2500\u2500 configs                 # Configuration files for data retrieval and processing\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 grid                    # Grid data retrieval configurations\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 pipelines               # Data processing pipeline configurations\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 weather                 # Weather data retrieval configurations\n    \u2502\n    \u251c\u2500\u2500 information             # Documentation and additional information\n    \u2502\n    \u251c\u2500\u2500 notebooks               # Jupyter notebooks for exploration and analysis\n    \u2502\n    \u251c\u2500\u2500 packages                                # Modular packages for different components of the framework [Run order]\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 data_cleaning_and_joining               # Data cleaning, spatial alignment, and integration [3]\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 grid_data_retrieval                     # Public grid data retrieval utilities [2]\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 marginal_emissions_modelling            # MEF estimation methods and evaluation [4]\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 osme_common                             # Common utilities and functions for the framework [All]\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 weather_data_retrieval                  # ERA5 (from CDS) and Open-Meteo data retrieval [1]\n    \u2502\n    \u2514\u2500\u2500 README.md       # you are here\n</code></pre>"},{"location":"#additional-information","title":"Additional information","text":""},{"location":"#acknowledgements","title":"Acknowledgements","text":"<p>This work extends an MSc thesis at Imperial College London and benefited from support by collaborators and mentors. See ACKNOWLEDGEMENTS.</p>"},{"location":"#license","title":"License","text":"<p>This project is released under the terms in LICENSE.</p> <p>License: AGPL-3.0-or-later OR Commercial License For commercial use without AGPL obligations, email daniel.kaupa@outlook.com See COMMERCIAL-TERMS and LICENSE.</p>"},{"location":"ACKNOWLEDGEMENTS/","title":"Acknowledgements","text":"<p>This project extends research conducted as part of an MSc thesis at Imperial College London (Environmental Data Science &amp; Machine Learning). Sincere thanks to mentors, collaborators, and supporters for their invaluable contributions and encouragement throughout this work.</p>"},{"location":"ACKNOWLEDGEMENTS/#institutional-support","title":"Institutional support","text":"<ul> <li>Hitachi\u2013Imperial Centre for Decarbonisation and Natural Climate Solutions</li> <li>Imperial College London \u2013 Data Science Institute</li> </ul>"},{"location":"ACKNOWLEDGEMENTS/#individual-contributions","title":"Individual contributions","text":"<ul> <li>Dr Mirabelle Mu\u00fbls, Dr Shefali Khanna, and Dr Gareth Collins \u2014 supervision, feedback, and guidance.</li> <li>Brython Caley-Davies \u2014 assistance with data infrastructure centralisation and preprocessing.</li> <li>Colleagues and reviewers who provided feedback on methods and results.</li> </ul>"},{"location":"ACKNOWLEDGEMENTS/#resources-and-data","title":"Resources and data","text":"<ul> <li>Data provided by TATA Power.</li> <li>High-Performance Computing (HPC) resources provided by Imperial College London.</li> </ul> <p>If you supported this project and would like your contribution described differently, please open a Pull Request or contact the author.</p>"},{"location":"ACKNOWLEDGEMENTS/#references","title":"References","text":"<ol> <li>Aditya Tomar (2024). margE_India.Rmd [R]. Imperial College London. https://github.com/ese-ada-lovelace-2024/irp-dbk24/blob/main/emission_rate_methodologies/marginal%20emissions/margE_India.Rmd</li> <li>Ajay Shankar, A K Saxena, &amp; Taruna Idnani (2025). Roadmap to India\u2019s 2030 Decarbonization Target. The Energy and Resources Institute. https://www.energy-transitions.org/publications/roadmap-to-indias-2030-decarbonization-target/</li> <li>Bentsen, L. \u00d8., Warakagoda, N. D., Stenbro, R., &amp; Engelstad, P. (2023). Spatio-temporal wind speed forecasting using graph networks and novel Transformer architectures. Applied Energy, 333, 120565. https://doi.org/10.1016/j.apenergy.2022.120565</li> <li>Bracht, F., Khanna, S., Martin, R., &amp; Mu\u00fbls, M. (2025). Waiting for carbon reductions \u2014 A smart IV approach.</li> <li>Buchholz, K. (2022, November 9). Infographic: India\u2019s Electricity Mix. Statista Daily Data. https://www.statista.com/chart/27963/india-energy-mix</li> <li>Center for Social and Economic Progress (2020, September 22). The CSEP Electricity and Carbon Tracker. https://carbontracker.in/ (Accessed 14-07-2025)</li> <li>Clean Energy Buyers Institute (2022). Guide to Sourcing Marginal Emissions Factor Data. https://cebi.org/wp-content/uploads/2022/11/Guide-to-Sourcing-Marginal-Emissions-Factor-Data.pdf</li> <li>Cohen, J. (2013). Statistical Power Analysis for the Behavioral Sciences (2nd ed.). Routledge. https://doi.org/10.4324/9780203771587</li> <li>Council on Foreign Relations (2024, December 5). How Electrification Can Reduce Emissions. https://education.cfr.org/learn/reading/electrification-climate-change</li> <li>Dhesi, B. (2023, January 18). How much does it cost to boil a kettle? Hugo. https://hugoenergyapp.co.uk/cost-to-boil-a-kettle/</li> <li>EIA (2023, June 21). As solar capacity grows, duck curves are getting deeper in California. U.S. EIA \u2013 Today in Energy. https://www.eia.gov/todayinenergy/detail.php?id=56880</li> <li>EIA (n.d.). Hourly Electric Grid Monitor: U.S. Electricity Overview. Retrieved 27 Aug 2025 from https://www.eia.gov/electricity/gridmonitor/index.php</li> <li>Elecenergy (2013). Interval Energy Data, or Itemized Energy Data? https://elecenergy.co.uk/assets/white-paper-interval-energy-data-or-itemized-energy-data.pdf</li> <li>Electricity Maps (2025). Carbon Intensity (Version 2025-01-27) [Dataset]. https://github.com/electricitymaps/electricitymaps-contrib/</li> <li>Energy Dashboard (2025, August 12). Live Generation, Demand and Emissions. https://www.energydashboard.co.uk/live</li> <li>Fleschutz, M., Bohlayer, M., Braun, M., &amp; Murphy, M. D. (2022). Demand Response Analysis Framework (DRAF): An Open-Source Multi-Objective Decision Support Tool for Decarbonizing Local Multi-Energy Systems. Sustainability 14(13). https://doi.org/10.3390/su14138025</li> <li>Green, A. (2024, December 5). Average versus Marginal Carbon Emissions: Many professionals are getting this wrong. ADG Efficiency. https://adgefficiency.com/energy-basics-average-vs-marginal-carbon-emissions/</li> <li>Hawkes, A. D. (2010). Estimating marginal CO\u2082 emission rates for national electricity systems. Energy Policy, 38(10), 5977\u20135987. https://doi.org/10.1016/j.enpol.2010.05.053</li> <li>Hersbach, H. et al. (2023). ERA5 hourly data on single levels from 1940 to present. Copernicus C3S Climate Data Store. DOI: 10.24381/cds.adbb2d47 (Accessed 16-07-2025)</li> <li>How Many Watts Does an Electric Kettle Use? (2023, August 2). BLUETTI-PH. https://www.bluettipower.ph/blogs/news/how-many-watts-does-an-electric-kettle-use</li> <li>IEA (2025, February). Emissions \u2013 Electricity 2025 \u2013 Analysis. https://www.iea.org/reports/electricity-2025/emissions</li> <li>IEA (2025, August 13). Real-Time Electricity Tracker \u2013 Data Tools. https://www.iea.org/data-and-statistics/data-tools/real-time-electricity-tracker</li> <li>International Hydropower Association (2025, August 27). Sediment Management Case Studies: India \u2013 Teesta V. https://www.hydropower.org/sediment-management-case-studies/india-teesta-v</li> <li>LotusArise (2024, February 17). Hydroelectric Power Plants in India [UPSC Mapping]. https://lotusarise.com/hydroelectric-power-plants-in-india-upsc/</li> <li>Manembu, P., Kewo, A., Bramstoft, R., &amp; Nielsen, P. S. (2023). A Review of Residential Electricity Load Shifting at the Appliance Level. Engineering. https://doi.org/10.20944/preprints202310.0908.v1</li> <li>Mu\u00f1oz Sabater, J. (2019). ERA5-Land hourly data from 1950 to present. Copernicus C3S Climate Data Store. DOI: 10.24381/cds.e2161bac (Accessed 14-07-2025)</li> <li>Naga Gangadhar (2024, December 12). Top 7 Largest Hydroelectric Power Plants in India (2025). Blackridge Research &amp; Consulting. https://www.blackridgeresearch.com/blog/top-seven-hydroelectric-power-plants-in-india</li> <li>Open-Meteo.com (n.d.). Free Open-Source Weather API. Retrieved 27 Aug 2025 from https://open-meteo.com/</li> <li>Oracle (n.d.). Interval Data File Specifications. Retrieved 27 Aug 2025 from https://docs.oracle.com/en/industries/energy-water/opower-platform/data-transfer/interval_AMI_spec/DataFileSpecifications_AMI_.htm</li> <li>Ritchie, H., Roser, M., &amp; Rosado, P. (2020). Renewable Energy. Our World in Data. https://ourworldindata.org/renewable-energy</li> <li>Roser, M. (2020). Why did renewables become so cheap so fast? Our World in Data. https://ourworldindata.org/cheap-renewables-growth</li> <li>Cunningham, S. (2021). 7 Instrumental Variables. In Causal Inference: The Mixtape. Yale University Press. https://mixtape.scunning.com/07-instrumental_variables</li> <li>Sengupta, S. et al. (2022). Current and Future Estimates of Marginal Emission Factors for Indian Power Generation. Environmental Science &amp; Technology, 56(13), 9237\u20139250. https://doi.org/10.1021/acs.est.1c07500</li> <li>Siler-Evans, K., Azevedo, I. L., &amp; Morgan, M. G. (2012). Marginal Emissions Factors for the U.S. Electricity System. Environmental Science &amp; Technology, 46(9), 4742\u20134748. https://doi.org/10.1021/es300145v</li> <li>statstutor.ac.uk (2011, December 16). Pearson\u2019s correlation. https://www.statstutor.ac.uk/resources/uploaded/pearsons.pdf</li> <li>Singh, V. &amp; Bond, K. (2024). Powering Up the Global South: The Cleantech Path to Growth. Rocky Mountain Institute. https://rmi.org/insight/powering-up-the-global-south/</li> <li>WattTime (2022). Marginal Emissions Modeling: WattTime\u2019s Approach to Modeling and Validation. https://watttime.org/wp-content/uploads/2023/11/WattTime-MOER-modeling-20221004.pdf</li> <li>WattTime (n.d.). Average vs. Marginal Emissions. Retrieved 30 May 2025 from https://watttime.org/data-science/data-signals/average-vs-marginal/</li> </ol>"},{"location":"CORE_CONCEPTS_AND_DEFINITIONS/","title":"Core Concepts and Definitions:","text":"<p>The purpose of this page is to provide definitions and explanations of key terms and concepts related to this project.</p>"},{"location":"CORE_CONCEPTS_AND_DEFINITIONS/#emissions-and-emissions-factors","title":"Emissions and Emissions Factors","text":"Emission factors <ul> <li> <p>Definitions:</p> <ul> <li>\"An emission factor gives the relationship between the amount of a pollutant produced and the amount of raw material processed or burnt. For example, for mobile sources, the emission factor is given in terms of the relationship between the amount of a pollutant that is produced and the number of vehicle miles travelled. By using the emission factor of a pollutant and specific data regarding quantities of materials used by a given source, it is possible to compute emissions for the source. This approach is used in preparing an emissions inventory.\" DEFRA</li> <li>\"An emission factor (EF) is a coefficient that describes the rate at which a given activity releases greenhouse gases (GHGs) into the atmosphere. They are also referred to as conversion factors, emission intensity and carbon intensity.\" Climatiq</li> </ul> </li> <li> <p>Notes: This factor can vary on a number of factors including but not limited to the specific technology used, age and condition of a technology, the specific chemical properties of a given type of fuel. To illustrate the affect of the technology, take for example a coal-fired generator that is 30 years old. This generator will probably be less efficient than one that is 5 years old, and require more fuel to produce the same amount of electricity. More coal consumed in this scenario means more carbon and emissions per kWh. There can also be differences within the same category of fuel. For example bituminous coal generally has a higher heat content than lignite, and the overall footprint of carbon from natural gas may will vary based on its source or mixture</p> </li> </ul> Average Emissions <ul> <li> <p>Definition: The total carbon emissions per amount of electricity produced by all generators in a system. ADG Efficiency</p> </li> <li> <p>Notes: Average emissions are good for analysing environmental impact in the aggregate - over a year or over a large area. Using average emission factors helps simplify the calculations by providing a single value to represent the emissions from a system that contains a diverse set of power generation sources.</p> </li> </ul> Marginal Emissions <ul> <li> <p>Definition: \"Marginal emissions refer to the amount of greenhouse gases or other pollutants emitted per unit of energy generated or consumed by the last power plant brought online or taken offline to meet fluctuating demand.\" Powerledger</p> </li> <li> <p>Notes: To borrow from logistics and transportation - you can think of marginal emissions as analogous to the 'last mile' that your Amazon delivery takes on a shipment. Before getting to its final destination, there were likely a few different cargo ships, maybe rail cars or semi-trucks that carried your package before it was handed off to a local post office to be delivered. The cargo ship, train, and truck were all likely taking those routes regardless of your action to order this package. But the journey to your home to deliver the package was is a result directly caused by your action to order that package. Similarly, marginal emissions are the emissions associated with the last or next unit of electricity generated to meet demand (deliver your package in this analogy).</p> </li> <li> <p>Characteristics of Marginal Emissions:</p> <ul> <li>The marginal generator is likely to be the most expensive generator at that time. (It may not be if the plant needs to be kept on for technical reasons). As renewables are characterized by low marginal costs, they are the ones that are unlikely to be pushed off the grid. ADG Efficiency</li> <li>Additional sources: DESNZ, Electricity Maps, Lane Clark &amp; Peacock LLP</li> </ul> </li> </ul> When to use Average Emissions &amp; Marginal Emissions <ul> <li>Average emissions are useful for understanding the overall impact of a power generation system and for long-term planning and policy-making. They provide a broad view of emissions across all generators in a system.</li> <li>Marginal emissions are more relevant for understanding the impact of specific actions or changes in electricity consumption, such as shifting demand to different times of the day or adding new renewable energy sources. They help identify the emissions associated with the next unit of electricity generated or consumed.</li> <li>\"The scientific consensus is clear: marginal emissions rates are the appropriate metric to use for measuring the consequential impact of load shifting, siting new loads, and building new renewables.\" WattTime</li> </ul>"},{"location":"CORE_CONCEPTS_AND_DEFINITIONS/#energy-and-the-grid","title":"Energy and the Grid","text":"Baseload Power <ul> <li>Definition: The amount of power made available by an energy producer (such as a power plant) to meet fundamental demands by consumers. Merriam-Webster</li> </ul> Demand Response <ul> <li>Definitions:<ul> <li>\"The changes in electric usage by end-use customers from their normal consumption patterns in response to changes in the price of electricity over time.\"</li> <li>\"The incentive payments designed to induce lower electricity use at times of high wholesale market prices or when system reliability is jeopardized.\"</li> </ul> </li> <li>Notes:<ul> <li>It \"includes all intentional modifications to consumption patterns of electricity of end use customers that are intended to alter the timing, level of instantaneous demand, or the total electricity consumption.\"</li> </ul> </li> <li>Source: IEEE</li> </ul> Grid Energy Storage <ul> <li>Definition: The technologies that are connected to the electrical power grid that store energy for later use (e.g. pumped-storage hydroelectricity, Vehicle to Grid, Batteries).</li> <li>Purpose: These systems help balance supply and demand by storing excess electricity from variable renewables such as solar and inflexible sources like nuclear power, releasing it when needed.</li> <li>Source: Wikipedia</li> </ul> Load Balancing <ul> <li>Definition: Load Balancing refers to the processes and techniques used to store extra power during periods with lower demand, and then release that power during periods of high demand. The aim is for the power supply system to have a load factor of 1. Wikipedia</li> <li>For more information on load factors see Electrical Rates: The Load Factor and the Density Factor</li> <li>Also known as load matching or daily peak demand reserve</li> </ul> Locational Marginal Pricing (LMP) <ul> <li>Definition: A pricing mechanism used in electricity markets to determine the cost of delivering electricity at specific locations, taking into account the cost of generation and the constraints of the transmission network.</li> <li>The marginal price of electricity at a specific location (node) in the power grid, reflecting the cost of supplying the next increment of electricity demand at that location, considering generation costs and transmission constraints.</li> <li>Purpose: LMP helps to ensure that electricity prices reflect the true cost of supplying power, including the impact of congestion and losses in the transmission system.</li> <li>Sources: UKERC, ISO-NE, Enverus</li> </ul> Peak Hours <ul> <li>Definition: The hours in a day when people generally consume more electricity due to their daily routine such as getting ready for work in the morning or making dinner in the evening.</li> <li>Notes: Peak hours usually occur in the morning or late afternoon/evening  (depending on location).<ul> <li>In temperate climates - the peak is usually when household appliances are heavily used in the evening after work hours.</li> <li>In hot climates - the peak is usually late afternoon when the AC load is high - also workplaces are still open and consuming power.</li> <li>In cold climates - the peak may be in the morning when the space heating and industry are both starting up.</li> </ul> </li> <li>Sources: Wikipedia, British Gas</li> </ul> Peaking Power Plants <p>Definition: The power plants that only run (or mainly run ) when there is a high demand. Because they only supply power occasionally - their power is usually more expensive per kilowatt hour than the base load.</p> <p>Notes:     - These plants are different than the base load power plants - which are those that supply a dependable and consistent amount of electricity.     - Certain peaker plants may operate a few hours a day, or others only a few hours a year.     - Common peaker plants are  gas turbines or gas engines that burn natural gas - though some burn biogas or other petroleum derivations.         - Their efficiency is generally 20-42% for simple ones, and 30-42% for newer ones.         - The New York Power Authority (NYPA) is looking to replace gas peaker plants with battery storage. Ventura County in California was able to do this with Tesla Megapacks, and in Lessines, Belgium 40 Megapacks replaced a turbojet generator.</p> <p>Source: Wikipedia</p> <p>Also known as peakers or peaker power plants</p>"},{"location":"CORE_CONCEPTS_AND_DEFINITIONS/#economics","title":"Economics","text":"Marginal Cost <p>Definition: The cost of producing one additional unit of a good or service. It is a key concept in economics and is used to analyze the behavior of firms in competitive markets.Investopedia</p> (Average) Treatment effect <ul> <li>Definitions:<ul> <li>The \"average causal effect of a binary variable on an outcome variable of scientific or policy interest.\" MIT</li> <li>A \"measure used to estimate the causal effect of a treatment or intervention on an outcome.\" CausalWizard</li> </ul> </li> </ul>"},{"location":"CORE_CONCEPTS_AND_DEFINITIONS/#data-science-mathematics","title":"Data Science / Mathematics","text":"Greedy Algorithm <p>Definition: A problem-solving heuristic that makes the locally optimal choice at each stage with the hope of finding a global optimum. Geeks for Geeks</p> Ordinary Least Squares Regression (OLS) <p>Definition: A technique for estimating the coefficients of a linear regression equation by minimizing the sum of the squared differences between the observed and predicted values. XLSTAT</p>"},{"location":"PROJECT_ROADMAP/","title":"Project Roadmap","text":"<p>This page tracks the rough priorities for each package in the <code>open-source-marginal-emissions</code> monorepo as well as the overall platform. It summarises the plan for extending the MSc thesis codebase into a modular, reproducible platform that supports multiple data providers, scalable computation, and transparent data-processing pipelines.</p>"},{"location":"PROJECT_ROADMAP/#weather_data_retrieval","title":"<code>weather_data_retrieval</code>","text":"<p>Goal: Automated retrieval of weather datasets from APIs including ERA5 from the Copernicus Climate Data Store and Open-Meteo.</p>"},{"location":"PROJECT_ROADMAP/#mvp-deliverable","title":"MVP Deliverable","text":"<ul> <li>Reproducible retrieval of ERA5-world and ERA5-land data from the Copernicus CDS API for user-defined regions and date ranges.</li> <li>Allows for both interactive CLI and batch JSON config usage.</li> </ul>"},{"location":"PROJECT_ROADMAP/#future-development","title":"Future Development","text":"<ul> <li>Implement Open-Meteo data retrieval.</li> <li>Increase robustness of dataset validation for variable availability.</li> <li>Implement functionality that allows users to view the data variables available for their selected dataset prior to selection for download.</li> <li>Improve logging output and consistency between interactive and batch modes.</li> <li>Increase robustness of estimated file size calculations prior to download.</li> <li>Add functionality for further splitting data into larger or smaller chunks based on user preference.</li> <li>Specifically with the goal of having some files 'github compatible' (&lt;100MB).</li> <li>Ensure that the \u201cYou already have this dataset downloaded, are you sure you want to proceed with the new download?\u201d functionality is foolproof / optimised.</li> </ul>"},{"location":"PROJECT_ROADMAP/#grid_data_retrieval","title":"<code>grid_data_retrieval</code>","text":"<p>Goal: Automated retrieval of electricity grid datasets from APIs including Electricity Maps, International Energy Agency, and country-specific sources such as CarbonTracker India.</p>"},{"location":"PROJECT_ROADMAP/#mvp-deliverable_1","title":"MVP Deliverable","text":"<ul> <li>Reproducible retrieval of electricity grid data from carbontracker.in for user-defined date ranges.</li> <li>Allows for both interactive CLI and batch JSON config usage.</li> <li>Attempt to use existing library for CLI (different strategy from weather_data_retrieval)</li> </ul>"},{"location":"PROJECT_ROADMAP/#future-development_1","title":"Future Development","text":"<ul> <li>Implement Electricity Maps data retrieval.</li> <li>Implement IEA data retrieval.</li> <li>Implement country-specific data retrieval for additional countries beyond India.<ul> <li>Desired test regions: Argentina, Greece, South Africa, Costa Rica, Panama.</li> </ul> </li> <li>Increase robustness of dataset validation for variable availability.</li> <li>Implement functionality that allows users to view the data variables available for their selected dataset prior to selection for download.</li> <li>Improve logging output and consistency between interactive and batch modes.</li> <li>Increase robustness of estimated file size calculations prior to download.</li> <li>Add functionality for further splitting data into larger or smaller chunks based on user preference.</li> <li>Specifically with the goal of having some files 'github compatible' (&lt;100MB).</li> <li>Ensure that the \u201cYou already have this dataset downloaded, are you sure you want to proceed with the new download?\u201d functionality is foolproof / optimised.</li> </ul>"},{"location":"PROJECT_ROADMAP/#data_cleaning_and_joining","title":"<code>data_cleaning_and_joining</code>","text":"<p>Goal: Automated cleaning of raw weather and grid datasets including: * Profiling and filling gaps where needed. * Aligning datasets to common temporal frequencies (e.g., 30-minutely). * De-accumulating weather variables where necessary (e.g., ERA5 precipitation). * Aggregating or disaggregating grid data to common temporal frequencies. * Joining weather and grid datasets on common axes (time, region).</p>"},{"location":"PROJECT_ROADMAP/#mvp-deliverable_2","title":"MVP Deliverable","text":"<ul> <li>Process weather and grid data to export analysis-ready tables at 30-minutely frequency.<ul> <li>Includes gap filling, aligning of geospatial/temporal axes, de-accumulation of weather data, and aggregation/disaggregation of grid data.</li> </ul> </li> <li>Include national average of weather data as well as data at native resolution.</li> <li>(Trim data to national boundaries - India)</li> </ul>"},{"location":"PROJECT_ROADMAP/#future-development_2","title":"Future Development","text":"<ul> <li>Select and trim data to national boundaries</li> <li>Allow for configurable temporal frequencies (60, 120 first - maybe 15 as final)</li> <li>Allow for configurable geospatial resolutions (regrid to coarser (aggregate) or finer (disaggregate) grids)</li> <li>Allow for export options of one master file, split files by year, size aware chunking (and github compatible files &lt;100MB)</li> <li>Implement CLI and batch JSON config for data cleaning and joining.</li> <li>Allow for user-defined gap filling strategies when completeness is below a certain threshold.</li> </ul>"},{"location":"PROJECT_ROADMAP/#marginal_emissions_modelling","title":"<code>marginal_emissions_modelling</code>","text":"<p>Goal: Allow users to develop a model for marginal emissions factors using the weather and grid data available</p>"},{"location":"PROJECT_ROADMAP/#mvp-deliverable_3","title":"MVP Deliverable","text":"<ul> <li>Notebook style development with one for EDA and one for generating models</li> <li>Template for how to sift through data, transformations, models, and evaluation of accuracy</li> <li>Expected end results and format: datetime, MEF, AEF</li> </ul>"},{"location":"PROJECT_ROADMAP/#future-development_3","title":"Future Development","text":"<ul> <li>Show how to incorporate additional data beyond the weather and grid information:<ul> <li>For example, it may be interesting to do weightings for the weather data based on the region it originates from.</li> <li>This could be useful in terms of tying the weights to variables such as percentage of national electricity generation or consumption, sources of electricity generation, sources of electricity consumption (industry vs residential), population, living quality indices, or other.</li> </ul> </li> <li>This of course brings up related questions of how does this additional data tie into the existing data we have and relate to it?<ul> <li>For example \u2013 if there is more solar production in one region \u2013 should we weight the solar radiation variables more heavily? And if so \u2013 how do we ensure that we weight it in a way that it doesn\u2019t discount the others? Similar questions can be asked of precipitation and hydro power.</li> </ul> </li> <li>Tie model runs to weights and biases to allow for comprehensive model and results evaluation</li> <li>Programmatically run multiple models for a basic set of variables and predefined transformations.<ul> <li>User would choose<ul> <li>Which models to be included / run</li> <li>Which variables to use (predefined transformations)</li> <li>Hyperparameters would revert to their defaults</li> <li>The best result(s) would be returned to the user.</li> </ul> </li> </ul> </li> <li>Programmatically run all combinations of predefined variable and hyperparameter sets for a given model<ul> <li>User would choose:<ul> <li>1 model to be run</li> <li>Set of variables to use and test combinations of (predefined transformations)</li> <li>Set of hyperparameters to use and test combinations of</li> </ul> </li> <li>Would show the user all of the different results.</li> </ul> </li> <li>Incorporate ChatGPT or other tool to be able to look into your code and recommend what the next steps would be / what model they would recommend.</li> <li>Provide a few different potential transformations \u2013 or links to resources for where to learn about which ones would be appropriate under these circumstances.<ul> <li>Pursue data transformations (replacing originals)</li> </ul> </li> </ul>"},{"location":"PROJECT_ROADMAP/#residential_electricity_data_retrieval","title":"<code>residential_electricity_data_retrieval</code>","text":"<p>Goal: Automated retrieval of open-source residential electricity consumption datasets from APIs. Potential sources include Energy Dashboard UK and country-specific sources.</p>"},{"location":"PROJECT_ROADMAP/#mvp-deliverable_4","title":"MVP Deliverable","text":"<ul> <li>Reproducible retrieval of residential electricity consumption data from any open-source API.</li> </ul>"},{"location":"PROJECT_ROADMAP/#future-development_4","title":"Future Development","text":"<ul> <li>CLI interface for user interaction showing available datasets, variables, date ranges.</li> <li>Batch JSON config for automated retrieval.</li> <li>Data validation and completeness checks.</li> <li>Gap filling strategies for missing data.</li> </ul>"},{"location":"PROJECT_ROADMAP/#optimisation","title":"<code>optimisation</code>","text":"<p>Goal: Module for running optimisation processes that determine the most efficient scheduling or allocation of electricity demand, based on marginal emissions and operational constraints.</p>"},{"location":"PROJECT_ROADMAP/#mvp-deliverable_5","title":"MVP Deliverable","text":"<ul> <li>Module that performs optimisation for a predefined set of constraints and time periods (e.g., weekly or monthly).</li> <li>Accepts and validates all required inputs (constraints, data sources, solver selection).</li> <li>Produces a reproducible output containing the optimised schedule or decision variables, as well as summary statistics and diagnostics.</li> <li>Support one solver (greedy or MILP).</li> </ul>"},{"location":"PROJECT_ROADMAP/#future-development_5","title":"Future Development","text":"<ul> <li>Implement new solvers with predefined constraints<ul> <li>Greedy, MILP, continuous solvers, and potentially heuristic/metaheuristic algorithms.</li> <li>Automated logging of optimisation runs, constraints used, and computational statistics to allow for comparison of solver performance across constraints and datasets.</li> </ul> </li> <li>Allow for user-defined constraints and solvers<ul> <li>Enhanced modularity to allow plug-and-play functionality for new solvers or constraint sets without affecting the broader pipeline</li> <li>Must handle both continuous and mixed-integer constraint definitions.</li> <li>Implement clear error handling and validation if incompatible constraints or solvers are chosen.</li> </ul> </li> <li>Enables modular inclusion of input metrics and variables.</li> <li>Provides scripts to flexibly pre-compute necessary inputs based on user input (e.g., city-week shards, household floors, regional demand factors).</li> <li>Validates that required inputs exist before running optimisation.</li> <li>Needed because these may require significant processing to determine</li> <li>Allow user to select execution mode:</li> <li>Local (small dataset or short time horizon such as a week or month).</li> <li>HPC (large-scale or full-period optimisation).</li> <li>Provides estimates of required computational resources (RAM, runtime) before execution, based on dataset size and solver selection.</li> <li>Supports efficient data handling through Polars or other lazy computation backends (potential C++ integration if performance critical).</li> <li>Allows user to define optimisation periods (e.g., week, month) and perform proportional scaling for data that spans larger intervals (e.g., city/quarter).</li> <li>Web-based form or graphical interface for defining optimisation constraints, solver selection, and execution parameters (building upon the command-line interface).</li> <li>Implementation should include memory warnings and dynamic scaling for dataset size.</li> <li>Develop a comprehensive reference list of all possible constraint and variable types, with example definitions and sample input files.</li> <li>Potential future requirement: automatic retrieval of regional electricity usage or consumption profiles to feed regional-level optimisation scenarios.</li> </ul>"},{"location":"PROJECT_ROADMAP/#overall-platform","title":"Overall Platform","text":"<p>Goal: To provide a unified, user-friendly entry point and a robust technical foundation for the entire open-source-marginal-emissions platform. This involves creating intuitive user interfaces, seamless workflows, and shared infrastructure that enables modularity, reproducibility, and scalability.</p>"},{"location":"PROJECT_ROADMAP/#1-user-journey-orchestration-osme-orchestrator","title":"1. User Journey &amp; Orchestration (osme-orchestrator)","text":"<p>This is a new, high-level package that guides users through the platform's capabilities, acting as the main entry point.</p>"},{"location":"PROJECT_ROADMAP/#mvp-deliverable_6","title":"MVP Deliverable","text":"<ul> <li>A Command-Line Interface (CLI) wizard that interactively guides the user through the primary use cases:<ul> <li>\"I want to download data.\" -&gt; Guides user through weather_data_retrieval and grid_data_retrieval configuration.</li> <li>\"I have data and want to build a Marginal Emissions model.\" -&gt; Guides user through data_cleaning_and_joining and then into the marginal_emissions_modelling notebook templates.</li> <li>\"I have a model and data, and I want to run an optimisation.\" -&gt; Guides user through the optimisation module setup.</li> </ul> </li> <li>The wizard generates the necessary JSON configuration files for batch execution in other modules.</li> </ul>"},{"location":"PROJECT_ROADMAP/#future-development_6","title":"Future Development","text":"<ul> <li>Web-based UI: A simple Streamlit or Dash application that provides the same guided experience as the CLI wizard, with forms for data selection, model parameters, and optimisation constraints.</li> <li>\"Recipe\" System: Pre-defined, end-to-end JSON configurations for common scenarios (e.g., \"India 2023 MEF Model,\" \"UK Demand Shifting Optimisation\").</li> <li>Project Scaffolding: Automatically creates a well-structured project directory with data/raw, data/processed, models/, config/ folders.</li> </ul>"},{"location":"PROJECT_ROADMAP/#2-shared-infrastructure-core-utilities-osme-core","title":"2. Shared Infrastructure &amp; Core Utilities (osme-core)","text":"<p>This package contains the shared code that all other modules depend on.</p>"},{"location":"PROJECT_ROADMAP/#mvp-deliverable_7","title":"MVP Deliverable","text":"<ul> <li>Unified Configuration Management: A single, validated JSON schema for all module configurations. Handles credentials (via environment variables or a secure vault), data directories, and execution parameters.</li> <li>Standardized Logging: A common logging format and lifecycle (info, debug, warning, error) across all modules, with structured logging for easy parsing.</li> <li>Common Data Types &amp; Models: Pydantic models or Python dataclasses for core concepts like TemporalRange, GeographicalRegion, DataSource.</li> <li>Base Classes for Retrieval: Abstract base classes that define the interface for any data retrieval module, ensuring consistency.</li> </ul>"},{"location":"PROJECT_ROADMAP/#future-development_7","title":"Future Development","text":"<ul> <li>Plugin Architecture: A formal system for adding new data providers, solvers, or gap-filling methods without modifying the core code.</li> <li>Health &amp; Performance Monitoring: Utilities for tracking memory usage, runtime, and data validation metrics across modules.</li> <li>Serialization Utilities: Standardized methods for saving/loading models, optimisation results, and large datasets (e.g., using joblib or Apache Parquet).</li> </ul>"},{"location":"PROJECT_ROADMAP/#3-execution-compute-layer-osme-compute","title":"3. Execution &amp; Compute Layer (osme-compute)","text":"<p>This component abstracts the computational environment, enabling both local development and scalable cloud/HPC execution.</p>"},{"location":"PROJECT_ROADMAP/#mvp-deliverable_8","title":"MVP Deliverable","text":"<ul> <li>Local Execution Engine: The default mode, running all processes on the user's local machine. Includes the resource estimation warnings mentioned in the optimisation roadmap.</li> </ul>"},{"location":"PROJECT_ROADMAP/#future-development_8","title":"Future Development","text":"<ul> <li> <p>Workflow Orchestration: Integration with workflow engines like Prefect or Dagster to define the entire data pipeline (retrieve -&gt; clean -&gt; model -&gt; optimise) as a single, monitored, and re-runnable DAG (Directed Acyclic Graph).</p> </li> <li> <p>Cloud &amp; HPC Abstraction:</p> <ul> <li>Azure/AWS Batch Integration: Package and submit jobs to cloud batch services for at-scale runs.</li> <li>Slurm/HPC Support: Script generation and job submission for High-Performance Computing clusters.</li> <li>Data &amp; Result Caching: A smart caching layer to avoid re-downloading or re-processing data that has not changed.</li> </ul> </li> </ul>"},{"location":"osme-common-utilities-documentation/","title":"Overview","text":"<p>Currently under development!</p>"},{"location":"osme-common-utilities-documentation/codebase/","title":"Codebase Reference","text":"<p>This document provides an overview of the main components of the <code>data_cleaning_and_joining</code> package, detailing the primary modules and their functionalities.</p> <p>Currently under development!</p>"},{"location":"osme-common-utilities-documentation/quickstart/","title":"Quickstart","text":"<p>Currently under development!</p>"},{"location":"osme-data-cleaning-and-joining-documentation/","title":"Overview","text":"<p>Currently under development!</p>"},{"location":"osme-data-cleaning-and-joining-documentation/codebase/","title":"Codebase Reference","text":"<p>This document provides an overview of the main components of the <code>data_cleaning_and_joining</code> package, detailing the primary modules and their functionalities.</p> <p>Currently under development!</p>"},{"location":"osme-data-cleaning-and-joining-documentation/quickstart/","title":"Quickstart","text":"<p>Currently under development!</p>"},{"location":"osme-grid-data-retrieval-documentation/","title":"Grid Data Retrieval","text":"<p>Retrieve electricity grid data from public APIs for marginal emissions factor estimation.</p>"},{"location":"osme-grid-data-retrieval-documentation/#what-is-grid-data-retrieval","title":"What is Grid Data Retrieval?","text":"<p>The <code>grid_data_retrieval</code> module is part of the Open Source Marginal Emissions (OSME) framework. It provides programmatic access to electricity grid datasets including:</p> <ul> <li>Generation data - Power output by source (thermal, gas, hydro, nuclear, renewables)</li> <li>Demand data - Electricity demand and net demand</li> <li>Emissions data - Carbon intensity and total CO\u2082 emissions</li> </ul> <p>This module focuses exclusively on data retrieval. Data processing (gap-filling, resampling, timezone conversion) is handled by the <code>data_cleaning_and_joining</code> module.</p>"},{"location":"osme-grid-data-retrieval-documentation/#why-grid-data","title":"Why Grid Data?","text":"<p>Marginal emissions factors (MEFs) estimate the carbon intensity of the next unit of electricity generated. To build accurate MEF models, you need:</p> <ol> <li>Weather data (via <code>weather_data_retrieval</code>) - wind, solar, temperature</li> <li>Grid data (via <code>grid_data_retrieval</code>) - generation, demand, emissions \u2b05 You are here</li> <li>Clean, aligned datasets (via <code>data_cleaning_and_joining</code>)</li> <li>Statistical models (via <code>marginal_emissions_modelling</code>)</li> </ol> <p>Grid data provides the ground truth for training and validating MEF models.</p>"},{"location":"osme-grid-data-retrieval-documentation/#current-status","title":"Current Status","text":"<p>\ud83d\udea7 Under Development</p>"},{"location":"osme-grid-data-retrieval-documentation/#implemented","title":"Implemented","text":"<ul> <li>\u2705 CarbonTracker India API integration</li> <li>\u2705 Monthly batch downloading</li> <li>\u2705 File combining and management</li> <li>\u2705 CLI and JSON config support</li> <li>\u2705 Structured logging</li> </ul>"},{"location":"osme-grid-data-retrieval-documentation/#planned","title":"Planned","text":"<ul> <li>\ud83d\udea7 Electricity Maps API</li> <li>\ud83d\udea7 IEA Real-Time Tracker</li> <li>\ud83d\udea7 Additional country-specific sources</li> <li>\ud83d\udea7 Data completeness validation</li> <li>\ud83d\udea7 Gap detection and reporting</li> </ul>"},{"location":"osme-grid-data-retrieval-documentation/#quick-example","title":"Quick Example","text":""},{"location":"osme-grid-data-retrieval-documentation/#fetch-one-year-of-india-grid-data","title":"Fetch one year of India grid data","text":"<pre><code># Create config\ncat &gt; configs/grid/india_2020.json &lt;&lt; EOF\n{\n  \"start_date\": \"2020-01-01 00:00:00\",\n  \"end_date\": \"2020-12-31 23:55:00\"\n}\nEOF\n\n# Fetch\nosme-grid --config configs/grid/india_2020.json --verbose\n</code></pre>"},{"location":"osme-grid-data-retrieval-documentation/#output","title":"Output","text":"<pre><code>data/grid_data/raw/\n\u251c\u2500\u2500 monthly/                                    # Individual months\n\u2502   \u251c\u2500\u2500 carbontracker_grid-data_2020_01.parquet\n\u2502   \u251c\u2500\u2500 carbontracker_grid-data_2020_02.parquet\n\u2502   \u2514\u2500\u2500 ...\n\u2514\u2500\u2500 carbontracker_grid-data_2020-01_2020-12.parquet  # Combined\n</code></pre>"},{"location":"osme-grid-data-retrieval-documentation/#key-features","title":"Key Features","text":""},{"location":"osme-grid-data-retrieval-documentation/#automatic-monthly-batching","title":"\ud83d\udd04 Automatic Monthly Batching","text":"<p>The API fetches data in monthly chunks to avoid timeouts and allow incremental downloads. Each month is saved as a separate Parquet file.</p>"},{"location":"osme-grid-data-retrieval-documentation/#optional-file-combining","title":"\ud83d\udce6 Optional File Combining","text":"<p>Monthly files can be automatically combined into a single dataset sorted by timestamp. This is useful for analysis but can be disabled if you prefer to work with monthly files.</p>"},{"location":"osme-grid-data-retrieval-documentation/#flexible-configuration","title":"\u2699\ufe0f Flexible Configuration","text":"<p>Run interactively via CLI arguments or batch via JSON config files. All parameters have sensible defaults.</p>"},{"location":"osme-grid-data-retrieval-documentation/#analysis-ready-output","title":"\ud83d\udcca Analysis-Ready Output","text":"<p>Data is saved in Apache Parquet format - efficient, compressed, and compatible with pandas, polars, and DuckDB.</p>"},{"location":"osme-grid-data-retrieval-documentation/#smart-file-management","title":"\ud83d\udd0d Smart File Management","text":"<p>Skip re-downloading existing months (configurable via <code>overwrite_existing</code>). Customize output directories for different projects.</p>"},{"location":"osme-grid-data-retrieval-documentation/#data-sources","title":"Data Sources","text":""},{"location":"osme-grid-data-retrieval-documentation/#carbontracker-india-implemented","title":"CarbonTracker India (Implemented)","text":"<p>Source: carbontracker.in Region: India (national grid) Resolution: 5-minute intervals Coverage: 2018-11-21 to present  </p> <p>Variables: - Generation by source (thermal, gas, hydro, nuclear, renewable) - Total generation and demand - Carbon intensity (g CO\u2082/kWh, tons CO\u2082/MWh) - Total emissions (tons CO\u2082)</p> <p>Notes: - Data is in UTC timezone - Free, no API key required - Maintained by Center for Social and Economic Progress</p>"},{"location":"osme-grid-data-retrieval-documentation/#electricity-maps-planned","title":"Electricity Maps (Planned)","text":"<p>Source: electricitymaps.com Region: 160+ countries/regions Resolution: Hourly  </p>"},{"location":"osme-grid-data-retrieval-documentation/#iea-real-time-tracker-planned","title":"IEA Real-Time Tracker (Planned)","text":"<p>Source: iea.org Region: 60+ countries Resolution: Varies by country  </p>"},{"location":"osme-grid-data-retrieval-documentation/#integration-with-osme-workflow","title":"Integration with OSME Workflow","text":"<pre><code>graph LR\n    A[weather_data_retrieval] --&gt; C[data_cleaning_and_joining]\n    B[grid_data_retrieval] --&gt; C\n    C --&gt; D[marginal_emissions_modelling]\n\n    style B fill:#e1f5ff\n</code></pre> <p>Typical workflow:</p> <ol> <li>Fetch weather data - <code>osme-weather</code> retrieves ERA5 reanalysis</li> <li>Fetch grid data - <code>osme-grid</code> retrieves CarbonTracker data \u2b05 You are here</li> <li>Clean and align - <code>data_cleaning_and_joining</code> processes both datasets</li> <li>Model MEFs - <code>marginal_emissions_modelling</code> trains models</li> </ol>"},{"location":"osme-grid-data-retrieval-documentation/#documentation-structure","title":"Documentation Structure","text":"<ul> <li>Quickstart - Installation and first run</li> <li>Codebase Reference - Module architecture and API</li> <li>README - Package overview (detailed)</li> </ul>"},{"location":"osme-grid-data-retrieval-documentation/#getting-help","title":"Getting Help","text":"<ul> <li>Documentation: https://danielkaupa.github.io/open-source-marginal-emissions/</li> <li>Issues: GitHub Issues</li> <li>Email: daniel.kaupa@outlook.com</li> </ul>"},{"location":"osme-grid-data-retrieval-documentation/#next-steps","title":"Next Steps","text":"<ol> <li>Install and run your first grid data fetch</li> <li>Review the codebase to understand module structure</li> <li>Explore the main OSME documentation for the full workflow</li> </ol> <p>Part of the Open Source Marginal Emissions (OSME) project Licensed under AGPL-3.0-or-later | Commercial licensing available</p>"},{"location":"osme-grid-data-retrieval-documentation/codebase/","title":"Codebase Reference","text":"<p>This document provides an overview of the main components of the <code>grid_data_retrieval</code> package, detailing the primary modules and their functionalities.</p>"},{"location":"osme-grid-data-retrieval-documentation/codebase/#grid_data_retrieval.runner","title":"grid_data_retrieval.runner","text":""},{"location":"osme-grid-data-retrieval-documentation/codebase/#grid_data_retrieval.runner--grid-data-retrieval-runner","title":"Grid Data Retrieval Runner","text":"<p>Orchestrates grid data fetching from APIs.</p> <p>This module handles ONLY data retrieval. Subsequent processing (gap-filling, resampling, timezone conversion) should be done via the data_cleaning_and_joining module.</p>"},{"location":"osme-grid-data-retrieval-documentation/codebase/#grid_data_retrieval.runner.run_grid_retrieval","title":"run_grid_retrieval","text":"<pre><code>run_grid_retrieval(config, *, logger=None, verbose=True)\n</code></pre> <p>Execute grid data retrieval from API.</p> <p>This function ONLY fetches and combines data. Processing happens elsewhere.</p> <p>Parameters:</p> Name Type Description Default <code>config</code> <code>dict</code> <p>Configuration dictionary containing: - start_date : str (YYYY-MM-DD HH:MM:SS) - end_date : str (YYYY-MM-DD HH:MM:SS) - api_url : str (optional) - overwrite_existing : bool (optional, default: True) - combine_files : bool (optional, default: True)</p> required <code>logger</code> <code>Logger</code> <p>Pre-configured logger instance.</p> <code>None</code> <code>verbose</code> <code>bool</code> <p>Whether to echo logs to console.</p> <code>True</code> <p>Returns:</p> Type Description <code>int</code> <p>Exit code: 0=success, 1=error.</p> Source code in <code>packages/grid_data_retrieval/src/grid_data_retrieval/runner.py</code> <pre><code>def run_grid_retrieval(\n    config: dict,\n    *,\n    logger=None,\n    verbose: bool = True,\n) -&gt; int:\n    \"\"\"\n    Execute grid data retrieval from API.\n\n    This function ONLY fetches and combines data. Processing happens elsewhere.\n\n    Parameters\n    ----------\n    config : dict\n        Configuration dictionary containing:\n        - start_date : str (YYYY-MM-DD HH:MM:SS)\n        - end_date : str (YYYY-MM-DD HH:MM:SS)\n        - api_url : str (optional)\n        - overwrite_existing : bool (optional, default: True)\n        - combine_files : bool (optional, default: True)\n    logger : logging.Logger, optional\n        Pre-configured logger instance.\n    verbose : bool, optional\n        Whether to echo logs to console.\n\n    Returns\n    -------\n    int\n        Exit code: 0=success, 1=error.\n    \"\"\"\n    # Initialize logger if not provided\n    if logger is None:\n        package_log_dir = log_dir(create=True) / \"grid_data_retrieval\"\n        logger = setup_logger(str(package_log_dir), verbose=verbose)\n        log_msg(f\"Logging initialized at {package_log_dir}\", logger, echo_console=verbose, force=True)\n\n    log_msg(\"=\" * 60, logger, echo_console=verbose)\n    log_msg(f\"Starting Grid Data Retrieval at {datetime.now().isoformat()}\",\n            logger=logger, echo_console=verbose, force=True)\n    log_msg(\"=\" * 60, logger, echo_console=verbose)\n\n    try:\n        # Extract config\n        start_date = config[\"start_date\"]\n        end_date = config[\"end_date\"]\n        api_url = config.get(\"api_url\", DEFAULT_API_URL)\n        overwrite_existing = config.get(\"overwrite_existing\", False)\n        combine_files = config.get(\"combine_files\", True)\n\n        # Define output directories\n        # Users can override via config[\"output_dir\"], otherwise use defaults from constants above\n        if \"output_dir\" in config and config[\"output_dir\"] is not None:\n            base_output_dir = Path(config[\"output_dir\"])\n        else:\n            # Use constants defined at top of file\n            base_output_dir = data_dir(create=True) / OUTPUT_BASE_DIR\n\n        monthly_dir = base_output_dir / MONTHLY_SUBDIR\n        combined_dir = base_output_dir\n\n        # Step 1: Fetch monthly batches\n        log_msg(\"\\n\" + \"=\" * 60, logger, echo_console=verbose)\n        log_msg(\"Fetching Monthly Batches from API\", logger, echo_console=verbose, force=True)\n        log_msg(\"=\" * 60, logger, echo_console=verbose)\n\n        monthly_files = fetch_monthly_batches(\n            start_date=start_date,\n            end_date=end_date,\n            api_url=api_url,\n            output_dir=monthly_dir,\n            overwrite_existing=overwrite_existing,\n            logger=logger,\n            echo_console=verbose,\n        )\n\n        if not monthly_files:\n            log_msg(\"No monthly files to process. Exiting.\", logger, level=\"warning\", echo_console=verbose, force=True)\n            return 0\n\n        log_msg(f\"Fetched {len(monthly_files)} monthly file(s).\", logger, echo_console=verbose, force=True)\n\n        # Step 2: Optionally combine monthly files\n        if combine_files:\n            log_msg(\"\\n\" + \"=\" * 60, logger, echo_console=verbose)\n            log_msg(\"Combining Monthly Files\", logger, echo_console=verbose, force=True)\n            log_msg(\"=\" * 60, logger, echo_console=verbose)\n\n            combined_path = combine_monthly_files(\n                monthly_dir=monthly_dir,\n                output_dir=combined_dir,\n                logger=logger,\n                echo_console=verbose,\n            )\n\n            log_msg(f\"Combined file created: {combined_path}\", logger, echo_console=verbose, force=True)\n            final_output = combined_path\n        else:\n            final_output = monthly_dir\n\n        # Success\n        log_msg(\"\\n\" + \"=\" * 60, logger, echo_console=verbose)\n        log_msg(\"Retrieval completed successfully!\", logger, echo_console=verbose, force=True)\n        log_msg(f\"Raw data saved to: {final_output}\", logger, echo_console=verbose, force=True)\n        log_msg(\"=\" * 60, logger, echo_console=verbose)\n        log_msg(\"\\nNext steps:\", logger, echo_console=verbose, force=True)\n        log_msg(\"  - Use data_cleaning_and_joining module for processing\", logger, echo_console=verbose, force=True)\n        log_msg(\"  - Apply gap-filling, resampling, timezone conversion as needed\", logger, echo_console=verbose, force=True)\n\n        return 0\n\n    except Exception as e:\n        log_msg(f\"Retrieval failed with exception: {e}\", logger=logger, level=\"exception\", echo_console=verbose, force=True)\n        return 1\n</code></pre>"},{"location":"osme-grid-data-retrieval-documentation/codebase/#grid_data_retrieval.io.cli","title":"grid_data_retrieval.io.cli","text":""},{"location":"osme-grid-data-retrieval-documentation/codebase/#grid_data_retrieval.io.cli--command-line-interface","title":"Command-Line Interface","text":"<p>CLI for grid data retrieval (fetching only).</p> <p>Data processing should be done via the data_cleaning_and_joining module.</p>"},{"location":"osme-grid-data-retrieval-documentation/codebase/#grid_data_retrieval.io.cli.parse_args","title":"parse_args","text":"<pre><code>parse_args()\n</code></pre> <p>Parse command-line arguments.</p> <p>Returns:</p> Type Description <code>Namespace</code> <p>Parsed arguments.</p> Source code in <code>packages/grid_data_retrieval/src/grid_data_retrieval/io/cli.py</code> <pre><code>def parse_args() -&gt; argparse.Namespace:\n    \"\"\"\n    Parse command-line arguments.\n\n    Returns\n    -------\n    argparse.Namespace\n        Parsed arguments.\n    \"\"\"\n    parser = argparse.ArgumentParser(\n        description=\"Grid Data Retrieval - Fetch electricity grid data from APIs.\",\n        formatter_class=argparse.RawDescriptionHelpFormatter,\n        epilog=\"\"\"\nExamples:\n  # Using configuration file\n  osme-grid-fetch --config configs/grid/my_config.json\n\n  # Using command-line arguments\n  osme-grid-fetch --start-date \"2020-01-01 00:00:00\" --end-date \"2020-12-31 23:55:00\"\n\n  # Re-download existing files\n  osme-grid-fetch --config my_config.json --overwrite-existing\n\n  # Verbose mode\n  osme-grid-fetch --config configs/grid/my_config.json --verbose\n\nNote: This command only FETCHES data. For processing (resampling, timezone\nconversion, gap-filling), use the data_cleaning_and_joining module.\n        \"\"\"\n    )\n\n    # Config file or manual parameters\n    parser.add_argument(\n        \"--config\",\n        type=str,\n        default=None,\n        help=\"Path to JSON configuration file. If provided, other arguments are ignored.\",\n    )\n\n    # Manual parameters (used if --config not provided)\n    parser.add_argument(\n        \"--start-date\",\n        type=str,\n        default=DEFAULT_START_DATE,\n        help='Start date (format: \"YYYY-MM-DD HH:MM:SS\").',\n    )\n\n    parser.add_argument(\n        \"--end-date\",\n        type=str,\n        default=DEFAULT_END_DATE,\n        help='End date (format: \"YYYY-MM-DD HH:MM:SS\").',\n    )\n\n    parser.add_argument(\n        \"--api-url\",\n        type=str,\n        default=DEFAULT_API_URL,\n        help=\"API URL for grid data retrieval.\",\n    )\n\n    parser.add_argument(\n        \"--output-dir\",\n        type=str,\n        default=None,\n        help='Output directory for data files (default: data/grid_data/raw/).',\n    )\n\n    parser.add_argument(\n        \"--overwrite-existing\",\n        action=\"store_true\",\n        dest=\"overwrite_existing\",\n        help=\"Overwrite existing files if they already exist (default: skip existing).\",\n    )\n\n    parser.add_argument(\n        \"--no-combine\",\n        action=\"store_false\",\n        dest=\"combine_files\",\n        help=\"Don't combine monthly files into single dataset (default: combine files).\",\n    )\n\n    # Verbosity\n    parser.add_argument(\n        \"--verbose\",\n        action=\"store_true\",\n        default=False,\n        help=\"Enable verbose console output.\",\n    )\n\n    parser.add_argument(\n        \"--quiet\",\n        action=\"store_true\",\n        default=False,\n        help=\"Suppress console output (logs still written to file).\",\n    )\n\n    # Set defaults for boolean flags\n    parser.set_defaults(overwrite_existing=False, combine_files=True)\n\n    return parser.parse_args()\n</code></pre>"},{"location":"osme-grid-data-retrieval-documentation/codebase/#grid_data_retrieval.io.cli.main","title":"main","text":"<pre><code>main()\n</code></pre> <p>Main entry point for the grid data retrieval CLI.</p> <p>This function:   1. Parses CLI arguments or loads configuration file.   2. Initializes logging.   3. Executes the grid data fetching.</p> <p>Automatically invoked by the <code>osme-grid-fetch</code> CLI script.</p> Source code in <code>packages/grid_data_retrieval/src/grid_data_retrieval/io/cli.py</code> <pre><code>def main():\n    \"\"\"\n    Main entry point for the grid data retrieval CLI.\n\n    This function:\n      1. Parses CLI arguments or loads configuration file.\n      2. Initializes logging.\n      3. Executes the grid data fetching.\n\n    Automatically invoked by the `osme-grid-fetch` CLI script.\n    \"\"\"\n    args = parse_args()\n\n    # Determine verbosity\n    if args.quiet:\n        verbose = False\n    elif args.verbose:\n        verbose = True\n    else:\n        # Default: verbose if interactive, quiet if config\n        verbose = args.config is None\n\n    # Initialize logger\n    package_log_dir = log_dir(create=True) / \"grid_data_retrieval\"\n    logger = setup_logger(str(package_log_dir), verbose=verbose)\n\n    try:\n        # Load configuration\n        if args.config:\n            log_msg(f\"Loading configuration from: {args.config}\", logger, echo_console=verbose, force=True)\n            config = load_config(args.config)\n        else:\n            # Build config from CLI arguments\n            config = {\n                \"start_date\": args.start_date,\n                \"end_date\": args.end_date,\n                \"api_url\": args.api_url,\n                \"output_dir\": args.output_dir,\n                \"overwrite_existing\": args.overwrite_existing,  # Default False, --overwrite-existing sets to True\n                \"combine_files\": args.combine_files,  # Default True, --no-combine sets to False\n            }\n\n        # Run retrieval\n        exit_code = run_grid_retrieval(\n            config=config,\n            logger=logger,\n            verbose=verbose,\n        )\n\n        sys.exit(exit_code)\n\n    except Exception as e:\n        log_msg(f\"Critical error: {e}\", logger, level=\"exception\", echo_console=True, force=True)\n        sys.exit(1)\n</code></pre>"},{"location":"osme-grid-data-retrieval-documentation/codebase/#grid_data_retrieval.io.config_loader","title":"grid_data_retrieval.io.config_loader","text":""},{"location":"osme-grid-data-retrieval-documentation/codebase/#grid_data_retrieval.io.config_loader--configuration-file-loading","title":"Configuration File Loading","text":"<p>Load and validate JSON configuration files for grid data retrieval.</p>"},{"location":"osme-grid-data-retrieval-documentation/codebase/#grid_data_retrieval.io.config_loader.load_config","title":"load_config","text":"<pre><code>load_config(file_path)\n</code></pre> <p>Load configuration from a JSON file.</p> <p>Searches in: 1. Absolute path (if provided) 2. Relative to config_dir() 3. Relative to config_dir()/grid/</p> <p>Parameters:</p> Name Type Description Default <code>file_path</code> <code>str or Path</code> <p>Path to JSON config file.</p> required <p>Returns:</p> Type Description <code>dict</code> <p>Configuration dictionary.</p> <p>Raises:</p> Type Description <code>FileNotFoundError</code> <p>If the configuration file cannot be found.</p> Source code in <code>packages/grid_data_retrieval/src/grid_data_retrieval/io/config_loader.py</code> <pre><code>def load_config(file_path: str | Path) -&gt; dict:\n    \"\"\"\n    Load configuration from a JSON file.\n\n    Searches in:\n    1. Absolute path (if provided)\n    2. Relative to config_dir()\n    3. Relative to config_dir()/grid/\n\n    Parameters\n    ----------\n    file_path : str or Path\n        Path to JSON config file.\n\n    Returns\n    -------\n    dict\n        Configuration dictionary.\n\n    Raises\n    ------\n    FileNotFoundError\n        If the configuration file cannot be found.\n    \"\"\"\n    cfg_path = _resolve_config_path(file_path)\n    with open(cfg_path, \"r\", encoding=\"utf-8\") as f:\n        return json.load(f)\n</code></pre>"},{"location":"osme-grid-data-retrieval-documentation/codebase/#grid_data_retrieval.sources.carbontracker","title":"grid_data_retrieval.sources.carbontracker","text":""},{"location":"osme-grid-data-retrieval-documentation/codebase/#grid_data_retrieval.sources.carbontracker--carbontracker-merit-api-data-retrieval","title":"CarbonTracker Merit API Data Retrieval","text":"<p>Fetches grid electricity data from the CarbonTracker Merit API and saves monthly Parquet files.</p> <p>Functions:</p> Name Description <code>fetch_monthly_batches : Retrieve data for all months in date range</code> <code>combine_monthly_files : Merge monthly files into single dataset</code>"},{"location":"osme-grid-data-retrieval-documentation/codebase/#grid_data_retrieval.sources.carbontracker.fetch_monthly_batches","title":"fetch_monthly_batches","text":"<pre><code>fetch_monthly_batches(\n    start_date,\n    end_date,\n    api_url,\n    output_dir,\n    *,\n    overwrite_existing=True,\n    logger=None,\n    echo_console=True\n)\n</code></pre> <p>Fetch grid data from CarbonTracker API in monthly batches.</p> <p>Parameters:</p> Name Type Description Default <code>start_date</code> <code>str</code> <p>Start date in format \"YYYY-MM-DD HH:MM:SS\".</p> required <code>end_date</code> <code>str</code> <p>End date in format \"YYYY-MM-DD HH:MM:SS\".</p> required <code>api_url</code> <code>str</code> <p>Base URL for the Merit API.</p> required <code>output_dir</code> <code>Path or str</code> <p>Directory to save monthly Parquet files.</p> required <code>overwrite_existing</code> <code>bool</code> <p>Whether to overwrite months that already have files.</p> <code>True</code> <code>logger</code> <code>Logger</code> <p>Logger instance.</p> <code>None</code> <code>echo_console</code> <code>bool</code> <p>Whether to echo to console.</p> <code>True</code> <p>Returns:</p> Type Description <code>List[Path]</code> <p>List of paths to fetched/existing monthly files.</p> Source code in <code>packages/grid_data_retrieval/src/grid_data_retrieval/sources/carbontracker.py</code> <pre><code>def fetch_monthly_batches(\n    start_date: str,\n    end_date: str,\n    api_url: str,\n    output_dir: Path | str,\n    *,\n    overwrite_existing: bool = True,\n    logger=None,\n    echo_console: bool = True,\n) -&gt; List[Path]:\n    \"\"\"\n    Fetch grid data from CarbonTracker API in monthly batches.\n\n    Parameters\n    ----------\n    start_date : str\n        Start date in format \"YYYY-MM-DD HH:MM:SS\".\n    end_date : str\n        End date in format \"YYYY-MM-DD HH:MM:SS\".\n    api_url : str\n        Base URL for the Merit API.\n    output_dir : Path or str\n        Directory to save monthly Parquet files.\n    overwrite_existing : bool, optional\n        Whether to overwrite months that already have files.\n    logger : logging.Logger, optional\n        Logger instance.\n    echo_console : bool, optional\n        Whether to echo to console.\n\n    Returns\n    -------\n    List[Path]\n        List of paths to fetched/existing monthly files.\n    \"\"\"\n    output_dir = Path(output_dir)\n    output_dir.mkdir(parents=True, exist_ok=True)\n\n    start_dt = datetime.strptime(start_date, \"%Y-%m-%d %H:%M:%S\")\n    end_dt = datetime.strptime(end_date, \"%Y-%m-%d %H:%M:%S\")\n\n    log_msg(f\"Fetching monthly batches from {start_dt} \u2192 {end_dt}\", logger, echo_console=echo_console)\n    log_msg(f\"API URL: {api_url}\", logger, echo_console=echo_console)\n    log_msg(f\"Output directory: {output_dir}\", logger, echo_console=echo_console)\n\n    monthly_files = []\n    months = list(_month_ranges(start_dt, end_dt))\n\n    for month_start, month_end in tqdm(months, desc=\"Fetching monthly data\", disable=not echo_console):\n        file_path = _month_filename(output_dir, month_start)\n\n        # Skip if exists\n        if not overwrite_existing and file_path.exists():\n            log_msg(f\"Skipping existing: {file_path.name}\", logger, echo_console=echo_console)\n            monthly_files.append(file_path)\n            continue\n\n        # Prepare API request\n        ms_str = url_escape(month_start.strftime(\"%Y-%m-%d %H:%M:%S\"), safe=\":\")\n        me_str = url_escape(month_end.strftime(\"%Y-%m-%d %H:%M:%S\"), safe=\":\")\n\n        url = (\n            f\"{api_url}\"\n            f\"?start_time={ms_str}\"\n            f\"&amp;end_time={me_str}\"\n            f\"&amp;corrected_values=true\"\n        )\n\n        try:\n            response = requests.get(url, timeout=30)\n            response.raise_for_status()\n            raw_json = json.loads(response.json())\n\n            # Validate response\n            if \"timeseries_values\" not in raw_json:\n                log_msg(\n                    f\"API error for {month_start:%Y-%m}: {raw_json}\",\n                    logger,\n                    level=\"error\",\n                    echo_console=echo_console,\n                    force=True\n                )\n                continue\n\n            # Extract data\n            values = raw_json[\"timeseries_values\"]\n            timestamps = values[\"timestamps\"]\n\n            rows = []\n            for j in range(len(timestamps)):\n                row = {\"timestamp\": timestamps[j]}\n                for var in VARIABLES_TO_COLLECT:\n                    row[var] = values[var][j]\n                rows.append(row)\n\n            # Create DataFrame\n            df = pl.DataFrame(rows)\n            df = df.with_columns(\n                pl.col(\"timestamp\").str.strptime(pl.Datetime, format=\"%Y-%m-%d %H:%M:%S\")\n            )\n\n            # Save\n            df.write_parquet(file_path)\n            log_msg(f\"Saved: {file_path.name}\", logger, echo_console=echo_console)\n            monthly_files.append(file_path)\n\n        except requests.exceptions.RequestException as e:\n            log_msg(\n                f\"Request error for {month_start:%Y-%m}: {e}\",\n                logger,\n                level=\"error\",\n                echo_console=echo_console,\n                force=True\n            )\n        except Exception as e:\n            log_msg(\n                f\"Unexpected error for {month_start:%Y-%m}: {e}\",\n                logger,\n                level=\"exception\",\n                echo_console=echo_console,\n                force=True\n            )\n\n        # Rate limiting\n        time.sleep(API_DELAY_SECONDS)\n\n    return monthly_files\n</code></pre>"},{"location":"osme-grid-data-retrieval-documentation/codebase/#grid_data_retrieval.sources.carbontracker.combine_monthly_files","title":"combine_monthly_files","text":"<pre><code>combine_monthly_files(\n    monthly_dir,\n    output_dir,\n    *,\n    logger=None,\n    echo_console=True\n)\n</code></pre> <p>Combine all monthly Parquet files into a single dataset.</p> <p>Parameters:</p> Name Type Description Default <code>monthly_dir</code> <code>Path or str</code> <p>Directory containing monthly Parquet files.</p> required <code>output_dir</code> <code>Path or str</code> <p>Directory for combined output file.</p> required <code>logger</code> <code>Logger</code> <p>Logger instance.</p> <code>None</code> <code>echo_console</code> <code>bool</code> <p>Whether to echo to console.</p> <code>True</code> <p>Returns:</p> Type Description <code>Path</code> <p>Path to the combined output file.</p> Source code in <code>packages/grid_data_retrieval/src/grid_data_retrieval/sources/carbontracker.py</code> <pre><code>def combine_monthly_files(\n    monthly_dir: Path | str,\n    output_dir: Path | str,\n    *,\n    logger=None,\n    echo_console: bool = True,\n) -&gt; Path:\n    \"\"\"\n    Combine all monthly Parquet files into a single dataset.\n\n    Parameters\n    ----------\n    monthly_dir : Path or str\n        Directory containing monthly Parquet files.\n    output_dir : Path or str\n        Directory for combined output file.\n    logger : logging.Logger, optional\n        Logger instance.\n    echo_console : bool, optional\n        Whether to echo to console.\n\n    Returns\n    -------\n    Path\n        Path to the combined output file.\n    \"\"\"\n    monthly_dir = Path(monthly_dir)\n    output_dir = Path(output_dir)\n    output_dir.mkdir(parents=True, exist_ok=True)\n\n    # Find monthly files\n    files = sorted(monthly_dir.glob(\"carbontracker_grid-data_*.parquet\"))\n\n    if not files:\n        raise FileNotFoundError(f\"No monthly Parquet files found in {monthly_dir}\")\n\n    log_msg(f\"Found {len(files)} monthly file(s) to combine.\", logger, echo_console=echo_console)\n\n    # Load lazily\n    lazy_frames = [pl.scan_parquet(f) for f in files]\n    combined_lazy = pl.concat(lazy_frames, how=\"vertical_relaxed\")\n\n    # Get timestamp range for filename\n    min_max = combined_lazy.select([\n        pl.col(\"timestamp\").min().alias(\"min_ts\"),\n        pl.col(\"timestamp\").max().alias(\"max_ts\"),\n    ]).collect()\n\n    min_ts = min_max[\"min_ts\"][0]\n    max_ts = min_max[\"max_ts\"][0]\n\n    start_str = min_ts.strftime(\"%Y-%m\")\n    end_str = max_ts.strftime(\"%Y-%m\")\n\n    # Construct output path\n    output_path = output_dir / f\"carbontracker_grid-data_{start_str}_{end_str}.parquet\"\n\n    log_msg(f\"Date range: {min_ts} \u2192 {max_ts}\", logger, echo_console=echo_console)\n    log_msg(f\"Writing combined file: {output_path.name}\", logger, echo_console=echo_console)\n\n    # Write to Parquet\n    combined_lazy.sort(\"timestamp\").sink_parquet(output_path)\n\n    log_msg(f\"Combined file created successfully.\", logger, echo_console=echo_console, force=True)\n\n    return output_path\n</code></pre>"},{"location":"osme-grid-data-retrieval-documentation/codebase/#grid_data_retrieval.utils.logging","title":"grid_data_retrieval.utils.logging","text":""},{"location":"osme-grid-data-retrieval-documentation/codebase/#grid_data_retrieval.utils.logging--logging-infrastructure","title":"Logging Infrastructure","text":"<p>Provides centralized logging for the grid_data_retrieval package.</p> <p>Reuses patterns from osme_common and weather_data_retrieval for consistency.</p>"},{"location":"osme-grid-data-retrieval-documentation/codebase/#grid_data_retrieval.utils.logging.setup_logger","title":"setup_logger","text":"<pre><code>setup_logger(save_dir=None, verbose=True)\n</code></pre> <p>Initialize and return a configured logger.</p> <p>Logs are written to /logs/grid_data_retrieval (or $OSME_LOG_DIR/grid_data_retrieval). <p>Parameters:</p> Name Type Description Default <code>save_dir</code> <code>str or None</code> <p>Directory to save log files. If None, defaults to osme_common.paths.log_dir().</p> <code>None</code> <code>verbose</code> <code>bool</code> <p>Whether to echo logs to console (via console handler).</p> <code>True</code> <p>Returns:</p> Type Description <code>Logger</code> <p>Configured logger instance.</p> Source code in <code>packages/grid_data_retrieval/src/grid_data_retrieval/utils/logging.py</code> <pre><code>def setup_logger(\n    save_dir: str | None = None,\n    verbose: bool = True,\n) -&gt; logging.Logger:\n    \"\"\"\n    Initialize and return a configured logger.\n\n    Logs are written to &lt;repo_root&gt;/logs/grid_data_retrieval (or $OSME_LOG_DIR/grid_data_retrieval).\n\n    Parameters\n    ----------\n    save_dir : str or None, optional\n        Directory to save log files. If None, defaults to osme_common.paths.log_dir().\n    verbose : bool, optional\n        Whether to echo logs to console (via console handler).\n\n    Returns\n    -------\n    logging.Logger\n        Configured logger instance.\n    \"\"\"\n    # Resolve log directory\n    base_dir = Path(save_dir) if save_dir else log_dir(create=True)\n    base_dir.mkdir(parents=True, exist_ok=True)\n\n    timestamp = datetime.datetime.now().strftime(\"%Y%m%d_%H%M%S\")\n    log_path = base_dir / f\"grid_retrieval_{timestamp}.log\"\n\n    logger = logging.getLogger(\"grid_retrieval\")\n    logger.setLevel(logging.DEBUG)\n\n    # Clear old handlers safely\n    if logger.hasHandlers():\n        for h in list(logger.handlers):\n            logger.removeHandler(h)\n\n    # File handler \u2013 DEBUG (captures everything)\n    fh = logging.FileHandler(log_path)\n    fh.setLevel(logging.DEBUG)\n    fh.setFormatter(logging.Formatter(\"%(asctime)s | %(levelname)s | %(message)s\"))\n    logger.addHandler(fh)\n\n    logger.info(f\"Logging initialized at {log_path}\")\n    return logger\n</code></pre>"},{"location":"osme-grid-data-retrieval-documentation/codebase/#grid_data_retrieval.utils.logging.log_msg","title":"log_msg","text":"<pre><code>log_msg(\n    msg,\n    logger,\n    *,\n    level=\"info\",\n    echo_console=False,\n    force=False\n)\n</code></pre> <p>Unified logging utility.</p> <ul> <li>Always logs to file.</li> <li>Optionally echoes to console via tqdm.write (non-blocking).</li> </ul> <p>Parameters:</p> Name Type Description Default <code>msg</code> <code>str</code> <p>Message to log.</p> required <code>logger</code> <code>Logger</code> <p>Logger instance.</p> required <code>level</code> <code>str</code> <p>Log level: \"debug\", \"info\", \"warning\", \"error\", \"exception\".</p> <code>'info'</code> <code>echo_console</code> <code>bool</code> <p>Print to console when True.</p> <code>False</code> <code>force</code> <code>bool</code> <p>Print to console regardless of echo_console (for critical messages).</p> <code>False</code> <p>Returns:</p> Type Description <code>None</code> Source code in <code>packages/grid_data_retrieval/src/grid_data_retrieval/utils/logging.py</code> <pre><code>def log_msg(\n    msg: str,\n    logger,\n    *,\n    level: str = \"info\",\n    echo_console: bool = False,\n    force: bool = False,\n) -&gt; None:\n    \"\"\"\n    Unified logging utility.\n\n    - Always logs to file.\n    - Optionally echoes to console via tqdm.write (non-blocking).\n\n    Parameters\n    ----------\n    msg : str\n        Message to log.\n    logger : logging.Logger\n        Logger instance.\n    level : str, optional\n        Log level: \"debug\", \"info\", \"warning\", \"error\", \"exception\".\n    echo_console : bool, optional\n        Print to console when True.\n    force : bool, optional\n        Print to console regardless of echo_console (for critical messages).\n\n    Returns\n    -------\n    None\n    \"\"\"\n    if not logger:\n        raise ValueError(\"Logger instance must be provided to log_msg().\")\n\n    log_fn = getattr(logger, level, logger.info)\n    log_fn(msg)\n\n    if force or echo_console:\n        tqdm.write(s=msg)\n</code></pre>"},{"location":"osme-grid-data-retrieval-documentation/quickstart/","title":"Quickstart Guide","text":"<p>Get started with <code>grid_data_retrieval</code> in 5 minutes.</p>"},{"location":"osme-grid-data-retrieval-documentation/quickstart/#prerequisites","title":"Prerequisites","text":"<p>Before you begin, ensure you have:</p> <ul> <li>Python \u2265 3.11</li> <li>The OSME repository cloned</li> <li><code>osme_common</code> package installed (shared utilities)</li> </ul>"},{"location":"osme-grid-data-retrieval-documentation/quickstart/#installation","title":"Installation","text":""},{"location":"osme-grid-data-retrieval-documentation/quickstart/#1-install-the-module","title":"1. Install the Module","text":"<p>From the repository root:</p> <pre><code># Install in editable mode\npip install -e packages/grid_data_retrieval\n</code></pre> <p>This registers two CLI commands: - <code>osme-grid</code> (recommended) - <code>gdr</code> (short alias)</p>"},{"location":"osme-grid-data-retrieval-documentation/quickstart/#2-verify-installation","title":"2. Verify Installation","text":"<pre><code>osme-grid --help\n</code></pre> <p>You should see usage information and available options.</p>"},{"location":"osme-grid-data-retrieval-documentation/quickstart/#first-run-fetch-2-months-of-data","title":"First Run: Fetch 2 Months of Data","text":"<p>Let's fetch grid data for November-December 2018.</p>"},{"location":"osme-grid-data-retrieval-documentation/quickstart/#using-cli-arguments","title":"Using CLI Arguments","text":"<pre><code>osme-grid \\\n  --start-date \"2018-11-01 00:00:00\" \\\n  --end-date \"2018-12-31 23:55:00\" \\\n  --verbose\n</code></pre>"},{"location":"osme-grid-data-retrieval-documentation/quickstart/#using-a-configuration-file","title":"Using a Configuration File","text":"<p>Create <code>configs/grid/quickstart.json</code>:</p> <pre><code>{\n  \"start_date\": \"2018-11-01 00:00:00\",\n  \"end_date\": \"2018-12-31 23:55:00\"\n}\n</code></pre> <p>Run:</p> <pre><code>osme-grid --config configs/grid/quickstart.json --verbose\n</code></pre>"},{"location":"osme-grid-data-retrieval-documentation/quickstart/#expected-output","title":"Expected Output","text":"<pre><code>============================================================\nStarting Grid Data Retrieval at 2025-02-10T14:30:00\n============================================================\n\n============================================================\nFetching Monthly Batches from API\n============================================================\nFetching monthly batches from 2018-11-01 00:00:00 \u2192 2018-12-31 23:55:00\nAPI URL: https://32u36xakx6.execute-api.us-east-2.amazonaws.com/v4/get-merit-data\nOutput directory: /path/to/data/grid_data/raw/monthly\n\nFetching monthly data: 100%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588| 2/2 [00:15&lt;00:00,  7.5s/it]\nSaved: carbontracker_grid-data_2018_11.parquet\nSaved: carbontracker_grid-data_2018_12.parquet\nFetched 2 monthly file(s).\n\n============================================================\nCombining Monthly Files\n============================================================\nFound 2 monthly file(s) to combine.\nDate range: 2018-11-01 00:00:00 \u2192 2018-12-31 23:55:00\nWriting combined file: carbontracker_grid-data_2018-11_2018-12.parquet\nCombined file created successfully.\n\n============================================================\nRetrieval completed successfully!\nRaw data saved to: /path/to/data/grid_data/raw/carbontracker_grid-data_2018-11_2018-12.parquet\n============================================================\n\nNext steps:\n  - Use data_cleaning_and_joining module for processing\n  - Apply gap-filling, resampling, timezone conversion as needed\n</code></pre>"},{"location":"osme-grid-data-retrieval-documentation/quickstart/#check-your-output","title":"Check Your Output","text":""},{"location":"osme-grid-data-retrieval-documentation/quickstart/#file-structure","title":"File Structure","text":"<pre><code>data/grid_data/raw/\n\u251c\u2500\u2500 monthly/\n\u2502   \u251c\u2500\u2500 carbontracker_grid-data_2018_11.parquet\n\u2502   \u2514\u2500\u2500 carbontracker_grid-data_2018_12.parquet\n\u2514\u2500\u2500 carbontracker_grid-data_2018-11_2018-12.parquet  # Combined\n\nlogs/grid_data_retrieval/\n\u2514\u2500\u2500 grid_retrieval_20250210_143000.log\n</code></pre>"},{"location":"osme-grid-data-retrieval-documentation/quickstart/#inspect-data","title":"Inspect Data","text":"<p>Using Python:</p> <pre><code>import polars as pl\n\n# Load combined file\ndf = pl.read_parquet(\"data/grid_data/raw/carbontracker_grid-data_2018-11_2018-12.parquet\")\n\nprint(f\"Shape: {df.shape}\")\nprint(f\"Columns: {df.columns}\")\nprint(f\"\\nFirst 5 rows:\")\nprint(df.head())\n\n# Summary stats\nprint(f\"\\nSummary:\")\nprint(df.describe())\n</code></pre>"},{"location":"osme-grid-data-retrieval-documentation/quickstart/#expected-variables","title":"Expected Variables","text":"<p>Your dataset should include:</p> <ul> <li><code>timestamp</code> - UTC datetime (5-min intervals)</li> <li><code>thermal_generation</code> - MW</li> <li><code>gas_generation</code> - MW</li> <li><code>hydro_generation</code> - MW</li> <li><code>nuclear_generation</code> - MW</li> <li><code>renewable_generation</code> - MW</li> <li><code>total_generation</code> - MW</li> <li><code>demand_met</code> - MW</li> <li><code>net_demand</code> - MW</li> <li><code>g_co2_per_kwh</code> - g CO\u2082/kWh</li> <li><code>tons_co2_per_mwh</code> - tons CO\u2082/MWh</li> <li><code>tons_co2</code> - tons CO\u2082</li> </ul>"},{"location":"osme-grid-data-retrieval-documentation/quickstart/#common-use-cases","title":"Common Use Cases","text":""},{"location":"osme-grid-data-retrieval-documentation/quickstart/#fetch-full-year","title":"Fetch Full Year","text":"<pre><code>osme-grid \\\n  --start-date \"2020-01-01 00:00:00\" \\\n  --end-date \"2020-12-31 23:55:00\" \\\n  --verbose\n</code></pre>"},{"location":"osme-grid-data-retrieval-documentation/quickstart/#re-download-existing-data","title":"Re-Download Existing Data","text":"<p>By default, existing months are skipped. To re-download:</p> <pre><code>osme-grid \\\n  --config configs/grid/my_config.json \\\n  --overwrite-existing\n</code></pre>"},{"location":"osme-grid-data-retrieval-documentation/quickstart/#keep-monthly-files-separate","title":"Keep Monthly Files Separate","text":"<p>If you don't want a combined file:</p> <pre><code>osme-grid \\\n  --start-date \"...\" \\\n  --end-date \"...\" \\\n  --no-combine\n</code></pre>"},{"location":"osme-grid-data-retrieval-documentation/quickstart/#custom-output-directory","title":"Custom Output Directory","text":"<pre><code>osme-grid \\\n  --config configs/grid/my_config.json \\\n  --output-dir /path/to/custom/directory\n</code></pre>"},{"location":"osme-grid-data-retrieval-documentation/quickstart/#configuration-file-examples","title":"Configuration File Examples","text":""},{"location":"osme-grid-data-retrieval-documentation/quickstart/#minimal-config","title":"Minimal Config","text":"<pre><code>{\n  \"start_date\": \"2020-01-01 00:00:00\",\n  \"end_date\": \"2020-12-31 23:55:00\"\n}\n</code></pre>"},{"location":"osme-grid-data-retrieval-documentation/quickstart/#full-config","title":"Full Config","text":"<pre><code>{\n  \"start_date\": \"2020-01-01 00:00:00\",\n  \"end_date\": \"2020-12-31 23:55:00\",\n  \"api_url\": \"https://32u36xakx6.execute-api.us-east-2.amazonaws.com/v4/get-merit-data\",\n  \"output_dir\": null,\n  \"overwrite_existing\": false,\n  \"combine_files\": true\n}\n</code></pre>"},{"location":"osme-grid-data-retrieval-documentation/quickstart/#multi-year-batch","title":"Multi-Year Batch","text":"<p>For large downloads, create separate configs per year:</p> <p>configs/grid/india_2019.json: <pre><code>{\n  \"start_date\": \"2019-01-01 00:00:00\",\n  \"end_date\": \"2019-12-31 23:55:00\"\n}\n</code></pre></p> <p>configs/grid/india_2020.json: <pre><code>{\n  \"start_date\": \"2020-01-01 00:00:00\",\n  \"end_date\": \"2020-12-31 23:55:00\"\n}\n</code></pre></p> <p>Run sequentially or in parallel:</p> <pre><code># Sequential\nosme-grid --config configs/grid/india_2019.json\nosme-grid --config configs/grid/india_2020.json\n\n# Parallel (in separate terminals)\nosme-grid --config configs/grid/india_2019.json --output-dir data/grid_data/2019 &amp;\nosme-grid --config configs/grid/india_2020.json --output-dir data/grid_data/2020 &amp;\n</code></pre>"},{"location":"osme-grid-data-retrieval-documentation/quickstart/#next-steps","title":"Next Steps","text":""},{"location":"osme-grid-data-retrieval-documentation/quickstart/#1-process-your-data","title":"1. Process Your Data","text":"<p>Raw grid data is at 5-minute intervals in UTC. You'll likely want to:</p> <ul> <li>Resample to 30-minute intervals (to match weather data)</li> <li>Convert timezone to local time (e.g., Asia/Kolkata for India)</li> <li>Check for gaps and fill if necessary</li> </ul> <p>These operations are handled by the <code>data_cleaning_and_joining</code> module:</p> <pre><code># Resample (example - not yet implemented)\npython -m data_cleaning_and_joining.grid.resample \\\n  --input data/grid_data/raw/carbontracker_grid-data_2020-01_2020-12.parquet \\\n  --output data/grid_data/processed/grid_30min.parquet \\\n  --frequency \"30min\"\n\n# Convert timezone (example - not yet implemented)\npython -m data_cleaning_and_joining.grid.set_timezone \\\n  --input data/grid_data/processed/grid_30min.parquet \\\n  --output data/grid_data/processed/grid_30min_ist.parquet \\\n  --timezone \"Asia/Kolkata\"\n</code></pre>"},{"location":"osme-grid-data-retrieval-documentation/quickstart/#2-fetch-weather-data","title":"2. Fetch Weather Data","text":"<p>To train MEF models, you'll also need weather data:</p> <pre><code>osme-weather --config configs/weather/india_era5_2020.json\n</code></pre> <p>See the <code>weather_data_retrieval</code> documentation for details.</p>"},{"location":"osme-grid-data-retrieval-documentation/quickstart/#3-join-datasets","title":"3. Join Datasets","text":"<p>Once you have both grid and weather data processed to the same temporal resolution and timezone, join them:</p> <pre><code>import polars as pl\n\ngrid = pl.read_parquet(\"data/grid_data/processed/grid_30min_ist.parquet\")\nweather = pl.read_parquet(\"data/weather_data/processed/weather_30min_ist.parquet\")\n\n# Join on timestamp\njoined = grid.join(weather, on=\"timestamp\", how=\"inner\")\n\njoined.write_parquet(\"data/processed/grid_weather_joined.parquet\")\n</code></pre>"},{"location":"osme-grid-data-retrieval-documentation/quickstart/#4-build-mef-models","title":"4. Build MEF Models","text":"<p>Use <code>marginal_emissions_modelling</code> to train and evaluate models.</p>"},{"location":"osme-grid-data-retrieval-documentation/quickstart/#troubleshooting","title":"Troubleshooting","text":""},{"location":"osme-grid-data-retrieval-documentation/quickstart/#command-not-found","title":"Command not found","text":"<pre><code># Make sure package is installed\npip install -e packages/grid_data_retrieval\n\n# Verify entry points\npip show grid-data-retrieval | grep \"Entry points\" -A 5\n</code></pre>"},{"location":"osme-grid-data-retrieval-documentation/quickstart/#rate-limiting-errors","title":"Rate limiting errors","text":"<p>The API has a 5-second delay between requests. If you see rate limit errors, increase the delay in <code>sources/carbontracker.py</code>:</p> <pre><code>API_DELAY_SECONDS = 10  # Change from 5 to 10\n</code></pre>"},{"location":"osme-grid-data-retrieval-documentation/quickstart/#path-resolution-issues","title":"Path resolution issues","text":"<p>Check your data directory:</p> <pre><code>python -c \"from osme_common.paths import data_dir; print(data_dir())\"\n</code></pre> <p>If it's not what you expect, set the environment variable:</p> <pre><code>export OSME_DATA_DIR=\"/path/to/your/data\"\n</code></pre>"},{"location":"osme-grid-data-retrieval-documentation/quickstart/#network-errors","title":"Network errors","text":"<p>If downloads are interrupted:</p> <ol> <li>Re-run the same command - existing months will be skipped automatically</li> <li>Check your internet connection</li> <li>Verify the API is accessible: <code>curl https://carbontracker.in/</code></li> </ol>"},{"location":"osme-grid-data-retrieval-documentation/quickstart/#cli-options-reference","title":"CLI Options Reference","text":"<p>Quick reference for all CLI options:</p> Option Type Default Description <code>--config</code> path - JSON config file <code>--start-date</code> datetime 2018-11-21 00:00:00 Start date <code>--end-date</code> datetime 2019-01-31 23:55:00 End date <code>--api-url</code> URL CarbonTracker API endpoint <code>--output-dir</code> path data/grid_data/raw/ Output directory <code>--overwrite-existing</code> flag false Re-download existing <code>--no-combine</code> flag false Don't combine files <code>--verbose</code> flag false Console output <code>--quiet</code> flag false Suppress console"},{"location":"osme-grid-data-retrieval-documentation/quickstart/#python-api","title":"Python API","text":"<p>If you prefer to script your data retrieval:</p> <pre><code>from grid_data_retrieval.runner import run_grid_retrieval\n\nconfig = {\n    \"start_date\": \"2020-01-01 00:00:00\",\n    \"end_date\": \"2020-12-31 23:55:00\",\n    \"overwrite_existing\": False,\n    \"combine_files\": True,\n}\n\nexit_code = run_grid_retrieval(config, verbose=True)\n\nif exit_code == 0:\n    print(\"Success!\")\nelse:\n    print(\"Failed!\")\n</code></pre>"},{"location":"osme-grid-data-retrieval-documentation/quickstart/#whats-next","title":"What's Next?","text":"<p>\u2705 You've successfully retrieved grid data \u2705 You understand the output structure \u2705 You know how to customize the retrieval  </p> <p>Next: - Read the Codebase Reference to understand the module architecture - Check the main README for detailed API documentation - Explore the OSME documentation for the full MEF workflow</p> <p>Need help? Open an issue on GitHub or email daniel.kaupa@outlook.com</p>"},{"location":"osme-marginal-emissions-modelling-documentation/","title":"Overview","text":"<p>Currently under development!</p>"},{"location":"osme-marginal-emissions-modelling-documentation/codebase/","title":"Codebase Reference","text":"<p>This document provides an overview of the main components of the <code>marginal_emissions_modelling</code> package, detailing the primary modules and their functionalities.</p> <p>Currently under development!</p>"},{"location":"osme-marginal-emissions-modelling-documentation/quickstart/","title":"Quickstart","text":"<p>Currently under development!</p>"},{"location":"osme-weather-data-retrieval-documentation/","title":"Weather Data Retrieval","text":"<p>Welcome! The <code>weather_data_retrieval</code> package makes it easy to download weather and climate reanalysis data for your marginal emissions modeling projects.</p>"},{"location":"osme-weather-data-retrieval-documentation/#what-does-this-package-do","title":"What Does This Package Do?","text":"<p>This package helps you retrieve large-scale weather datasets from public sources with minimal hassle. Whether you need a few months of data for a pilot study or years of global coverage for production models, we've got you covered.</p> <p>Currently supported: - ERA5 (global reanalysis, 0.25\u00b0 resolution, hourly) - ERA5-Land (land-focused, 0.1\u00b0 resolution, hourly)</p> <p>Both are accessed via the Copernicus Climate Data Store (CDS) API.</p> <p>Expansion Coming Soon</p> <p>Open-Meteo and additional providers are on the roadmap! See the project roadmap for details.</p>"},{"location":"osme-weather-data-retrieval-documentation/#key-features","title":"Key Features","text":"<p>\u2728 Two ways to work: Interactive wizard for exploration, or JSON configs for reproducible pipelines</p> <p>\ud83d\udce6 Smart downloads: Automatically chunks data by month, handles retries, and skips files you already have</p> <p>\u26a1 Parallel downloads: Speed up large requests with concurrent downloads</p> <p>\ud83d\udcdd Production-ready logging: Every download is logged with timestamps, configurations, and any issues</p> <p>\ud83d\udd27 HPC-friendly: Includes batch scripts and settings optimized for high-performance computing environments</p>"},{"location":"osme-weather-data-retrieval-documentation/#quick-example","title":"Quick Example","text":""},{"location":"osme-weather-data-retrieval-documentation/#interactive-mode","title":"Interactive Mode","text":"<pre><code># Just run the command and follow the prompts\nosme-weather\n</code></pre>"},{"location":"osme-weather-data-retrieval-documentation/#batch-mode","title":"Batch Mode","text":"<pre><code># Use a configuration file for reproducible downloads\nosme-weather --config my_download.json\n</code></pre>"},{"location":"osme-weather-data-retrieval-documentation/#what-youll-need","title":"What You'll Need","text":"<ol> <li>Python 3.11+ (we recommend using conda or mamba)</li> <li>A CDS account (free registration at https://cds.climate.copernicus.eu)</li> <li>Your CDS API key (found in your CDS profile after registration)</li> <li>Disk space (varies by region and date range; the tool estimates this for you)</li> </ol>"},{"location":"osme-weather-data-retrieval-documentation/#installation","title":"Installation","text":"<p>The weather data retrieval package is part of the <code>open-source-marginal-emissions</code> monorepo. </p> <p>From the repository root:</p> <pre><code># Install in development mode\npip install -e packages/weather_data_retrieval\n\n# Or install the full project with all packages\npip install -e .\n</code></pre> <p>This makes the <code>osme-weather</code> and <code>wdr</code> commands available in your terminal.</p>"},{"location":"osme-weather-data-retrieval-documentation/#next-steps","title":"Next Steps","text":"<ul> <li>New to this package? Start with the Quickstart Guide for a step-by-step first download</li> <li>Ready to automate? Check out the User Guide for batch configurations</li> <li>Need specific config details? See the Configuration Reference</li> <li>Running into issues? Visit Troubleshooting for common problems and solutions</li> <li>Want to understand the code? Browse the API Reference</li> </ul>"},{"location":"osme-weather-data-retrieval-documentation/#how-this-fits-into-your-workflow","title":"How This Fits Into Your Workflow","text":"<p>The weather data retrieval package is the first step in the OSME pipeline:</p> <ol> <li>weather_data_retrieval \u2190 You are here \u2013 Download raw weather data</li> <li>grid_data_retrieval \u2013 Download electricity grid data  </li> <li>data_cleaning_and_joining \u2013 Align and integrate datasets  </li> <li>marginal_emissions_modelling \u2013 Build your MEF models</li> </ol> <p>The data you download here gets saved to <code>data/&lt;dataset_short_name&gt;/raw/</code> and is ready for the next steps in your analysis.</p>"},{"location":"osme-weather-data-retrieval-documentation/#getting-help","title":"Getting Help","text":"<ul> <li>Check the Troubleshooting page for common issues</li> <li>Review the examples in the User Guide</li> <li>Open an issue on GitHub</li> <li>Read the detailed API documentation for advanced usage</li> </ul> <p>Let's get started! Head to the Quickstart Guide \u2192</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/","title":"API Reference","text":"<p>This page documents the internal structure of the <code>weather_data_retrieval</code> package. This is useful if you want to understand how the code works, extend it, or integrate it into other tools.</p> <p>For End Users</p> <p>If you're just using the package to download data, you probably don't need this page. See the User Guide or Quickstart instead.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#package-structure","title":"Package Structure","text":"<p>The package is organized into several modules:</p> <pre><code>weather_data_retrieval/\n\u251c\u2500\u2500 main.py                 # Entry point for CLI\n\u251c\u2500\u2500 runner.py               # Core orchestration logic\n\u251c\u2500\u2500 io/                     # Input/output handling\n\u2502   \u251c\u2500\u2500 cli.py             # Command-line interface\n\u2502   \u251c\u2500\u2500 prompts.py         # Interactive wizard prompts\n\u2502   \u2514\u2500\u2500 config_loader.py   # JSON config loading\n\u251c\u2500\u2500 sources/               # Data provider implementations\n\u2502   \u251c\u2500\u2500 cds_era5.py       # CDS/ERA5 downloader\n\u2502   \u2514\u2500\u2500 open_meteo.py     # Open-Meteo (planned)\n\u2514\u2500\u2500 utils/                 # Shared utilities\n    \u251c\u2500\u2500 session_management.py  # Session state tracking\n    \u251c\u2500\u2500 data_validation.py     # Input validation\n    \u251c\u2500\u2500 file_management.py     # File naming and checking\n    \u2514\u2500\u2500 logging.py             # Logging configuration\n</code></pre>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#core-modules","title":"Core Modules","text":""},{"location":"osme-weather-data-retrieval-documentation/codebase/#entry-point-orchestration","title":"Entry Point &amp; Orchestration","text":""},{"location":"osme-weather-data-retrieval-documentation/codebase/#mainpy","title":"<code>main.py</code>","text":"<p>The main entry point for the CLI. This is what gets called when you run <code>osme-weather</code>.</p> <p>Key Function: <code>main()</code></p> <ul> <li>Parses command-line arguments</li> <li>Determines run mode (interactive vs. batch)</li> <li>Sets up logging</li> <li>Delegates to either the interactive wizard or batch runner</li> </ul> <p>Usage: <pre><code># Called automatically by CLI\n# osme-weather [--config FILE] [--verbose] [--quiet]\n</code></pre></p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.main","title":"weather_data_retrieval.main","text":"<p>Main entry point for the Weather Data Retrieval CLI.</p> <p>This script can be run either:   - Automatically via a configuration file (<code>--config path/to/config.json</code>), or   - Interactively through a guided prompt wizard.</p> <p>It handles session management, logging setup, and orchestration of the retrieval workflow defined in <code>weather_data_retrieval.runner</code>.</p> <p>Typically invoked through the CLI command: <code>osme-weather</code> or <code>wdr</code>.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.main.main","title":"main","text":"<pre><code>main()\n</code></pre> <p>Entry point for the Weather Data Retrieval CLI.</p> <p>This function:   1. Parses CLI arguments or launches the interactive prompt wizard.   2. Loads or builds a configuration file for weather dataset download.   3. Initializes logging via <code>osme_common.paths.data_dir()</code>.   4. Executes the main retrieval workflow using <code>weather_data_retrieval.runner.run</code>.</p> <p>Automatically invoked by the <code>osme-weather</code> CLI script.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#runnerpy","title":"<code>runner.py</code>","text":"<p>Core orchestration logic for the download workflow. This handles validation, estimation, and download coordination.</p> <p>Key Functions:</p> <p><code>run(config, run_mode, verbose, logger)</code></p> <p>Main workflow orchestrator that:</p> <ol> <li>Validates the configuration</li> <li>Maps config to session state</li> <li>Performs internet speed test</li> <li>Estimates download size and time</li> <li>Generates filename hash</li> <li>Orchestrates downloads</li> <li>Reports final statistics</li> </ol> <p>Parameters: - <code>config</code> (dict): Configuration dictionary - <code>run_mode</code> (str): <code>\"interactive\"</code> or <code>\"automatic\"</code> - <code>verbose</code> (bool): Whether to echo progress to console - <code>logger</code> (logging.Logger): Logger instance</p> <p>Returns: - <code>int</code>: Exit code (0=success, 1=fatal error, 2=some failures)</p> <p><code>run_batch_from_config(cfg_path, logger)</code></p> <p>Convenience wrapper for batch mode. Loads config and calls <code>run()</code>.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.runner","title":"weather_data_retrieval.runner","text":""},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.runner.run","title":"run","text":"<pre><code>run(\n    config,\n    run_mode=\"interactive\",\n    verbose=True,\n    logger=None,\n)\n</code></pre> <p>Unified orchestration entry point for both interactive and automatic runs. Handles validation, logging, estimation, and download orchestration.</p> <p>Returns: 0=success, 1=fatal error, 2=some downloads failed.</p> <p>Parameters:</p> Name Type Description Default <code>config</code> <code>dict</code> <p>Configuration dictionary with all required parameters.</p> required <code>run_mode</code> <code>str</code> <p>Run mode, either 'interactive' or 'automatic', by default \"interactive\".</p> <code>'interactive'</code> <code>logger</code> <code>Logger</code> <p>Pre-configured logger instance, by default None.</p> <code>None</code> <p>Returns:</p> Type Description <code>int</code> <p>Exit code: 0=success, 1=fatal error, 2=some downloads failed.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.runner.run_batch_from_config","title":"run_batch_from_config","text":"<pre><code>run_batch_from_config(cfg_path, logger=None)\n</code></pre> <p>Run automatic batch from a config file.</p> <p>Parameters:</p> Name Type Description Default <code>config</code> <code>dict</code> <p>Configuration dictionary with all required parameters.</p> required <code>logger</code> <code>Logger</code> <p>Pre-configured logger instance, by default None.</p> <code>None</code> <p>Returns:</p> Type Description <code>int</code> <p>Exit code: 0=success, 1=fatal error, 2=some downloads failed.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#inputoutput-modules","title":"Input/Output Modules","text":""},{"location":"osme-weather-data-retrieval-documentation/codebase/#ioclipy","title":"<code>io/cli.py</code>","text":"<p>Command-line interface and interactive wizard.</p> <p>Key Functions:</p> <p><code>parse_args()</code></p> <p>Parses command-line arguments using argparse.</p> <p>Returns: <code>argparse.Namespace</code> with fields: - <code>config</code>: Path to config file (if <code>--config</code> provided) - <code>verbose</code>: Boolean for verbose output (batch mode) - <code>quiet</code>: Boolean for quiet mode (interactive mode)</p> <p><code>run_prompt_wizard(session, logger)</code></p> <p>Drives the interactive prompt flow. Steps through each configuration parameter, validates inputs, and handles back/exit commands.</p> <p>Parameters: - <code>session</code> (SessionState): Session state to populate - <code>logger</code> (logging.Logger): Logger instance</p> <p>Returns: - <code>bool</code>: <code>True</code> if completed successfully, <code>False</code> if user exited early</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.io.cli","title":"weather_data_retrieval.io.cli","text":""},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.io.cli.parse_args","title":"parse_args","text":"<pre><code>parse_args()\n</code></pre> <p>Parse command-line arguments.</p> <p>Parameters:</p> Name Type Description Default <code>None</code> required <p>Returns:</p> Type Description <code>Namespace</code> <p>Parsed arguments.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.io.cli.run_prompt_wizard","title":"run_prompt_wizard","text":"<pre><code>run_prompt_wizard(session, logger=None)\n</code></pre> <p>Drives the interactive prompt flow (no config-source step). Returns True if all fields completed; False if user exits.</p> <p>Parameters:</p> Name Type Description Default <code>session</code> <code>SessionState</code> <p>The session state to populate.</p> required <code>logger</code> <code>Logger</code> <p>Logger for logging messages, by default None.</p> <code>None</code> <p>Returns:</p> Type Description <code>bool</code> <p>True if completed; False if exited early.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#iopromptspy","title":"<code>io/prompts.py</code>","text":"<p>Individual prompt functions for each configuration step.</p> <p>Key Functions:</p> <p>Each prompt function handles user input for a specific configuration parameter:</p> <ul> <li><code>prompt_data_provider()</code> - Choose CDS or Open-Meteo</li> <li><code>prompt_dataset_short_name()</code> - Choose ERA5-Land or ERA5</li> <li><code>prompt_cds_url()</code> - CDS API URL</li> <li><code>prompt_cds_api_key()</code> - CDS API key</li> <li><code>prompt_date_range()</code> - Start and end dates</li> <li><code>prompt_coordinates()</code> - Region bounds [N, W, S, E]</li> <li><code>prompt_variables()</code> - Variable selection</li> <li><code>prompt_skip_overwrite_files()</code> - Existing file handling</li> <li><code>prompt_parallelisation_settings()</code> - Parallel download settings</li> <li><code>prompt_retry_settings()</code> - Retry configuration</li> <li><code>prompt_continue_confirmation()</code> - Final review and confirmation</li> </ul> <p>All prompt functions follow the same pattern:</p> <p>Parameters: - <code>session</code> (SessionState): Current session state - <code>logger</code> (logging.Logger): Logger instance - <code>echo_console</code> (bool): Whether to echo to console</p> <p>Returns:  - The validated input value, or - <code>\"__EXIT__\"</code> if user wants to quit, or - <code>\"__BACK__\"</code> if user wants to go to previous prompt</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.io.prompts","title":"weather_data_retrieval.io.prompts","text":""},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.io.prompts.read_input","title":"read_input","text":"<pre><code>read_input(prompt, *, logger=None)\n</code></pre> <p>Centralized input handler with built-in 'exit' and 'back' controls.</p> Parameters: <p>prompt : str     The prompt to display to the user. logger : logging.Logger, optional     Logger to log the prompt message.</p> Returns: <p>str     The user input, or special command indicators.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.io.prompts.say","title":"say","text":"<pre><code>say(text, *, logger=None)\n</code></pre> <p>Centralized output handler to log and print messages.</p> Parameters: <p>text : str     The message to display. logger : logging.Logger, optional     Logger to log the message.</p> Returns: <p>None</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.io.prompts.prompt_data_provider","title":"prompt_data_provider","text":"<pre><code>prompt_data_provider(session, *, logger=None)\n</code></pre> <p>Prompt user for which data provider to use (CDS or Open-Meteo).</p> <p>Parameters:</p> Name Type Description Default <code>session</code> <code>SessionState</code> <p>Current session state to store selected data provider.</p> required <code>logger</code> <code>Logger</code> <p>Logger for logging messages, by default None.</p> <code>None</code> <p>Returns:</p> Type Description <code>str</code> <p>Normalized provider name (\"cds\" or \"open-meteo\"), or special control token \"BACK\" or \"EXIT\".</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.io.prompts.prompt_dataset_short_name","title":"prompt_dataset_short_name","text":"<pre><code>prompt_dataset_short_name(\n    session, provider, *, logger=None\n)\n</code></pre> <p>Prompt for dataset choice.</p> <p>Parameters:</p> Name Type Description Default <code>session</code> <code>SessionState</code> <p>Current session state to store selected dataset.</p> required <code>provider</code> <code>str</code> <p>Data provider name.</p> required <code>logger</code> <code>Logger</code> <p>Logger for logging messages, by default None.</p> <code>None</code> <p>Returns:</p> Type Description <code>    str: Normalized dataset name or 'exit' / 'back'.</code>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.io.prompts.prompt_cds_url","title":"prompt_cds_url","text":"<pre><code>prompt_cds_url(\n    session,\n    api_url_default=\"https://cds.climate.copernicus.eu/api\",\n    *,\n    logger=None\n)\n</code></pre> <p>Prompt for CDS API URL.</p> <p>Parameters:</p> Name Type Description Default <code>session</code> <code>SessionState</code> <p>Current session state to store API URL.</p> required <code>api_url_default</code> <code>str</code> <p>Default CDS API URL. https://cds.climate.copernicus.eu/api</p> <code>'https://cds.climate.copernicus.eu/api'</code> <p>Returns:</p> Type Description <code>    str: CDS API URL or 'exit' / 'back'.</code>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.io.prompts.prompt_cds_api_key","title":"prompt_cds_api_key","text":"<pre><code>prompt_cds_api_key(session, *, logger=None)\n</code></pre> <p>Prompt only for the CDS API key (hidden input).</p> <p>Parameters:</p> Name Type Description Default <code>session</code> <code>SessionState</code> <p>Current session state to store API key.</p> required <code>logger</code> <code>Logger</code> <p>Logger for logging messages, by default None.</p> <code>None</code> <p>Returns:</p> Type Description <code>str</code> <p>CDS API key or 'exit' / 'back'.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.io.prompts.prompt_save_directory","title":"prompt_save_directory","text":"<pre><code>prompt_save_directory(session, default_dir, *, logger=None)\n</code></pre> <p>Ask for save directory, create if necessary.</p> <p>Parameters:</p> Name Type Description Default <code>session</code> <code>SessionState</code> <p>Current session state to store save directory.</p> required <code>default_dir</code> <code>Path</code> <p>Default directory to suggest.</p> required <code>logger</code> <code>Logger</code> <p>Logger for logging messages, by default None.</p> <code>None</code> <p>Returns:</p> Type Description <code>Path | str</code> <p>Path to save directory, or control token \"BACK\" / \"EXIT\".</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.io.prompts.prompt_date_range","title":"prompt_date_range","text":"<pre><code>prompt_date_range(session, *, logger=None)\n</code></pre> <p>Ask user for start and end date, with validation. Accepts formats: YYYY-MM-DD or YYYY-MM - Start dates without day default to first day of month (YYYY-MM-01) - End dates without day default to last day of month (YYYY-MM-[last day])</p> <p>Parameters:</p> Name Type Description Default <code>session</code> <code>SessionState</code> <p>Current session state to store date range.</p> required <code>logger</code> <code>Logger</code> <p>Logger for logging messages, by default None.</p> <code>None</code> <p>Returns:</p> Type Description <code>tuple[str, str]</code> <p>(start_date_str, end_date_str) in ISO format (YYYY-MM-DD), or (\"EXIT\", \"EXIT\") / (\"BACK\", \"BACK\")</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.io.prompts.prompt_coordinates","title":"prompt_coordinates","text":"<pre><code>prompt_coordinates(session, *, logger=None)\n</code></pre> <p>Prompt user for geographic boundaries (N, S, W, E) with validation.</p> <p>Parameters:</p> Name Type Description Default <code>session</code> <code>SessionState</code> <p>Current session state to store geographic boundaries.</p> required <p>Returns:</p> Type Description <code>list[float]</code> <p>[north, west, south, east] boundaries or special tokens \"EXIT\" / \"BACK\".</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.io.prompts.prompt_variables","title":"prompt_variables","text":"<pre><code>prompt_variables(\n    session,\n    variable_restrictions_list,\n    *args,\n    restriction_allow=False,\n    logger=None\n)\n</code></pre> <p>Ask for variables to download, validate each against allowed/disallowed list, and only update session if the full set is valid.</p> <p>Parameters:</p> Name Type Description Default <code>session</code> <code>SessionState</code> <p>Current session state to store selected variables.</p> required <code>variable_restrictions_list</code> <code>list[str]</code> <p>List of variables that are either allowed or disallowed.</p> required <code>restriction_allow</code> <code>bool</code> <p>If True, variable_restrictions_list is an allowlist (i.e. in). If False, it's a denylist (i.e. not in)</p> <code>False</code> <code>logger</code> <code>Logger</code> <p>Logger for logging messages, by default None.</p> <code>None</code> <p>Returns:</p> Type Description <code>list[str] | str</code> <p>List of selected variable names, or control token \"BACK\" / \"EXIT\".</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.io.prompts.prompt_skip_overwrite_files","title":"prompt_skip_overwrite_files","text":"<pre><code>prompt_skip_overwrite_files(session, *, logger=None)\n</code></pre> <p>Prompt user to choose skip/overwrite/case-by-case for existing files.</p> <p>Parameters:</p> Name Type Description Default <code>session</code> <code>SessionState</code> <p>Session state to store user choice.</p> required <code>logger</code> <code>Logger</code> <p>Logger for logging messages, by default None.</p> <code>None</code> <p>Returns:</p> Type Description <code>str</code> <p>One of \"overwrite_all\", \"skip_all\", \"case_by_case\"</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.io.prompts.prompt_parallelisation_settings","title":"prompt_parallelisation_settings","text":"<pre><code>prompt_parallelisation_settings(session, *, logger=None)\n</code></pre> <p>Ask user about parallel downloads and concurrency cap.</p> <p>Parameters:</p> Name Type Description Default <code>session</code> <code>SessionState</code> <p>Current session state to store parallelisation settings.</p> required <code>logger</code> <code>Logger</code> <p>Logger for logging messages, by default None.</p> <code>None</code> <p>Returns:</p> Type Description <code>dict | str</code> <p>Dictionary with parallelisation settings, or control token \"BACK\" / \"EXIT\".</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.io.prompts.prompt_retry_settings","title":"prompt_retry_settings","text":"<pre><code>prompt_retry_settings(\n    session,\n    default_retries=6,\n    default_delay=15,\n    *,\n    logger=None\n)\n</code></pre> <p>Ask user for retry limits.</p> <p>Parameters:</p> Name Type Description Default <code>session</code> <code>SessionState</code> <p>Current session state to store retry settings.</p> required <code>default_retries</code> <code>int</code> <p>Default number of retry attempts (default = 6).</p> <code>6</code> <code>default_delay</code> <code>int</code> <p>Default delay (in seconds) between retries (default = 15).</p> <code>15</code> <code>logger</code> <code>Logger</code> <p>Logger for logging messages, by default None.</p> <code>None</code> <p>Returns:</p> Type Description <code>dict | str</code> <p>Dictionary with 'max_retries' and 'retry_delay_sec', or control token \"BACK\" / \"EXIT\".</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.io.prompts.prompt_continue_confirmation","title":"prompt_continue_confirmation","text":"<pre><code>prompt_continue_confirmation(session, *, logger=None)\n</code></pre> <p>Display a formatted download summary and confirm before starting downloads.</p> <p>Parameters:</p> Name Type Description Default <code>session</code> <code>SessionState</code> <p>session state to summarise.</p> required <code>logger</code> <code>Logger</code> <p>Logger for logging messages, by default None.</p> <code>None</code> <p>Returns:</p> Type Description <code>bool | str</code> <p>True if user confirms, False if user declines, or control token \"BACK\" / \"EXIT\".</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#ioconfig_loaderpy","title":"<code>io/config_loader.py</code>","text":"<p>JSON configuration file loading and validation.</p> <p>Key Functions:</p> <p><code>load_and_validate_config(path, logger, run_mode)</code></p> <p>Loads a JSON config file and validates it.</p> <p>Parameters: - <code>path</code> (str): Path to JSON config file - <code>logger</code> (logging.Logger, optional): Logger for validation messages - <code>run_mode</code> (str): <code>\"interactive\"</code> or <code>\"automatic\"</code></p> <p>Returns: - <code>dict</code>: Validated configuration</p> <p>Raises: - <code>FileNotFoundError</code>: If config file doesn't exist - <code>ValueError</code>: If config is invalid</p> <p><code>load_config(file_path)</code></p> <p>Simple config loader without validation (for internal use).</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.io.config_loader","title":"weather_data_retrieval.io.config_loader","text":""},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.io.config_loader.load_and_validate_config","title":"load_and_validate_config","text":"<pre><code>load_and_validate_config(\n    path, *, logger=None, run_mode=\"automatic\"\n)\n</code></pre> <p>Load JSON config and validate it using the centralized validator. This lets the validator log coercions/warnings (e.g., case_by_case \u2192 skip_all).</p> <p>Parameters:</p> Name Type Description Default <code>path</code> <code>str</code> <p>Path to JSON config file.</p> required <code>logger</code> <code>Logger</code> <p>Logger instance for validation messages, by default None.</p> <code>None</code> <code>run_mode</code> <code>str</code> <p>Run mode, either 'interactive' or 'automatic', by default \"automatic\".</p> <code>'automatic'</code> <p>Returns:</p> Type Description <code>dict</code> <p>Validated configuration dictionary.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.io.config_loader.load_config","title":"load_config","text":"<pre><code>load_config(file_path)\n</code></pre> <p>Load configuration from a JSON requirements file (without validation).</p> <p>Parameters:</p> Name Type Description Default <code>file_path</code> <code>str</code> <p>Path to JSON config file.</p> required <p>Returns:</p> Type Description <code>dict</code> <p>Configuration dictionary.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#data-provider-modules","title":"Data Provider Modules","text":""},{"location":"osme-weather-data-retrieval-documentation/codebase/#sourcescds_era5py","title":"<code>sources/cds_era5.py</code>","text":"<p>CDS/ERA5 data provider implementation.</p> <p>Key Functions:</p> <p><code>orchestrate_cds_downloads(session, filename_base, save_dir, ...)</code></p> <p>Manages the entire CDS download workflow:</p> <ol> <li>Generates list of months to download</li> <li>Checks for existing files (skip logic)</li> <li>Coordinates parallel or sequential downloads</li> <li>Handles retries and failures</li> <li>Validates downloaded files</li> <li>Updates success/failure lists</li> </ol> <p>Parameters: - <code>session</code> (SessionState): Current session with all parameters - <code>filename_base</code> (str): Base filename for output files - <code>save_dir</code> (Path): Directory to save files - <code>successful_downloads</code> (list): List to append successful months - <code>failed_downloads</code> (list): List to append failed months - <code>skipped_downloads</code> (list): List to append skipped months - <code>logger</code> (logging.Logger): Logger instance - <code>echo_console</code> (bool): Whether to echo progress - <code>allow_prompts</code> (bool): Whether prompts are allowed (interactive mode)</p> <p><code>download_monthly_era5_file(...)</code></p> <p>Downloads a single month of ERA5 data.</p> <p>Parameters: - <code>client</code> (cdsapi.Client): Authenticated CDS client - <code>dataset_full_name</code> (str): Full CDS dataset name - <code>year</code> (int): Year to download - <code>month</code> (int): Month to download - <code>variables</code> (list): Variables to request - <code>region_bounds</code> (list): Geographic bounds [N, W, S, E] - <code>output_file</code> (Path): Where to save the file - Various retry and logging parameters</p> <p>Returns: - <code>Path</code>: Path to downloaded file if successful, else <code>None</code></p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.sources.cds_era5","title":"weather_data_retrieval.sources.cds_era5","text":""},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.sources.cds_era5.prepare_cds_download","title":"prepare_cds_download","text":"<pre><code>prepare_cds_download(\n    session,\n    filename_base,\n    year,\n    month,\n    save_dir,\n    *,\n    logger,\n    echo_console,\n    allow_prompts,\n    dataset_config_mapping=CDS_DATASETS\n)\n</code></pre> <p>Check if a monthly ERA5 file already exists and decide whether to download.</p> <p>Parameters:</p> Name Type Description Default <code>session</code> <code>SessionState</code> <p>Session containing user configuration.</p> required <code>filename_base</code> <code>str</code> <p>Base name for the file.</p> required <code>year</code> <code>int</code> <p>Year of the data to download.</p> required <code>month</code> <code>int</code> <p>Month of the data to download.</p> required <code>save_dir</code> <code>Path</code> <p>Directory to save downloaded files.</p> required <code>logger</code> <code>Logger</code> <p>Logger for logging messages.</p> required <code>echo_console</code> <code>bool</code> <p>Whether to echo prompts to console.</p> required <code>allow_prompts</code> <code>bool</code> <p>Whether to allow interactive prompts.</p> required <code>dataset_config_mapping</code> <code>dict</code> <p>Mapping of dataset short names to their configurations.</p> <code>CDS_DATASETS</code> <p>Returns:</p> Name Type Description <code>tuple</code> <code>(download: bool, save_path: str)</code> <p>download: Whether to perform the download. save_path: Full path for the target file.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.sources.cds_era5.execute_cds_download","title":"execute_cds_download","text":"<pre><code>execute_cds_download(\n    session,\n    save_path,\n    year,\n    month,\n    *,\n    logger,\n    echo_console,\n    dataset_config_mapping=CDS_DATASETS\n)\n</code></pre> <p>Execute a single ERA5 monthly download with retry logic.</p> <p>Parameters:</p> Name Type Description Default <code>session</code> <code>SessionState</code> <p>Session state containing the authenticated CDS API client.</p> required <code>save_path</code> <code>str</code> <p>Full path to save the downloaded file.</p> required <code>year</code> <code>int</code> <p>Year of the data to download.</p> required <code>month</code> <code>int</code> <p>Month of the data to download.</p> required <code>logger</code> <code>Logger</code> <p>Logger for logging messages.</p> required <code>echo_console</code> <code>bool</code> <p>Whether to echo prompts to console.</p> required <code>dataset_config_mapping</code> <code>dict</code> <p>Mapping of dataset short names to their configurations.</p> <code>CDS_DATASETS</code> <p>Returns:</p> Type Description <code>(year, month, status): tuple</code> <p>status = \"success\" | \"failed\"</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.sources.cds_era5.download_cds_month","title":"download_cds_month","text":"<pre><code>download_cds_month(\n    session,\n    filename_base,\n    year,\n    month,\n    save_dir,\n    *,\n    logger,\n    echo_console,\n    allow_prompts,\n    successful_downloads,\n    failed_downloads,\n    skipped_downloads\n)\n</code></pre> <p>Orchestrate ERA5 monthly download: handle file checks, then execute download.</p> <p>Parameters:</p> Name Type Description Default <code>Combines</code> required <p>Returns:</p> Type Description <code>(year, month, status): tuple</code> <p>status = \"success\" | \"failed\" | \"skipped\"</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.sources.cds_era5.plan_cds_months","title":"plan_cds_months","text":"<pre><code>plan_cds_months(\n    session,\n    filename_base,\n    save_dir,\n    *,\n    logger,\n    echo_console,\n    allow_prompts\n)\n</code></pre> <p>Build the list of months to download and which are being skipped due to existing files.</p> <p>Parameters:</p> Name Type Description Default <code>session</code> <code>SessionState</code> <p>Session containing user configuration.</p> required <code>filename_base</code> <code>str</code> <p>Base filename (without date or extension).</p> required <code>save_dir</code> <code>Path</code> <p>Directory to save downloaded files.</p> required <code>logger</code> <code>Logger</code> <p>Logger for logging messages.</p> required <code>echo_console</code> <code>bool</code> <p>Whether to echo prompts to console.</p> required <code>allow_prompts</code> <code>bool</code> <p>Whether to allow interactive prompts.</p> required <p>Returns:</p> Type Description <code>(months_to_download, months_skipped)</code> <ul> <li>months_to_download: list[(year, month)]</li> <li>months_skipped: list[(year, month, path)]</li> </ul>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.sources.cds_era5.orchestrate_cds_downloads","title":"orchestrate_cds_downloads","text":"<pre><code>orchestrate_cds_downloads(\n    session,\n    filename_base,\n    save_dir,\n    successful_downloads,\n    failed_downloads,\n    skipped_downloads,\n    *,\n    logger,\n    echo_console,\n    allow_prompts,\n    dataset_config_mapping=CDS_DATASETS\n)\n</code></pre> <p>Handle and orchestrate ERA5 monthly downloads, supporting parallel or sequential execution.</p> <p>Parameters:</p> Name Type Description Default <code>session</code> <code>SessionState</code> <p>Session containing user configuration and authenticated client.</p> required <code>filename_base</code> <code>str</code> <p>Base filename (without date or extension).</p> required <code>save_dir</code> <code>Path</code> <p>Directory to save downloaded files.</p> required <code>successful_downloads</code> <code>list</code> <p>Mutable list to collect (year, month) tuples for successful downloads.</p> required <code>failed_downloads</code> <code>list</code> <p>Mutable list to collect (year, month) tuples for failed downloads.</p> required <code>skipped_downloads</code> <code>list</code> <p>Mutable list to collect (year, month) tuples for skipped downloads.</p> required <code>logger</code> <code>Logger</code> <p>Logger for logging messages.</p> required <code>echo_console</code> <code>bool</code> <p>Whether to echo prompts to console.</p> required <code>allow_prompts</code> <code>bool</code> <p>Whether to allow interactive prompts.</p> required <code>dataset_config_mapping</code> <code>dict</code> <p>Mapping of dataset configurations, by default CDS_DATASETS.</p> <code>CDS_DATASETS</code> <p>Returns:</p> Type Description <code>None</code>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#sourcesopen_meteopy","title":"<code>sources/open_meteo.py</code>","text":"<p>Open-Meteo data provider (planned, not yet implemented).</p> <p>Coming Soon</p> <p>This module is a placeholder for future Open-Meteo integration.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.sources.open_meteo","title":"weather_data_retrieval.sources.open_meteo","text":""},{"location":"osme-weather-data-retrieval-documentation/codebase/#utility-modules","title":"Utility Modules","text":""},{"location":"osme-weather-data-retrieval-documentation/codebase/#utilssession_managementpy","title":"<code>utils/session_management.py</code>","text":"<p>Session state tracking and management.</p> <p>Key Classes:</p> <p><code>SessionState</code></p> <p>A simple key-value store for tracking configuration state during interactive sessions.</p> <p>Methods: - <code>get(key, default=None)</code> - Retrieve a value - <code>set(key, value)</code> - Store a value - <code>unset(key)</code> - Remove a value - <code>first_unfilled_key()</code> - Get the next required key that hasn't been set - <code>to_dict()</code> - Convert session to a dictionary (for saving)</p> <p>Usage: <pre><code>session = SessionState()\nsession.set(\"data_provider\", \"cds\")\nsession.set(\"dataset_short_name\", \"era5-land\")\n\nprovider = session.get(\"data_provider\")  # \"cds\"\nconfig = session.to_dict()  # {\"data_provider\": \"cds\", ...}\n</code></pre></p> <p>Key Functions:</p> <p><code>internet_speedtest(test_urls, max_seconds, logger, echo_console)</code></p> <p>Performs a quick internet speed test to estimate download times.</p> <p>Parameters: - <code>test_urls</code> (list, optional): URLs to test (uses defaults if None) - <code>max_seconds</code> (int): Maximum time to spend testing - <code>logger</code> (logging.Logger): Logger instance - <code>echo_console</code> (bool): Whether to echo results</p> <p>Returns: - <code>float</code>: Estimated speed in Mbps</p> <p><code>map_config_to_session(config, session, logger, echo_console)</code></p> <p>Maps a configuration dictionary to a SessionState, validating as it goes.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.session_management","title":"weather_data_retrieval.utils.session_management","text":""},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.session_management.SessionState","title":"SessionState","text":""},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.session_management.SessionState.first_unfilled_key","title":"first_unfilled_key","text":"<pre><code>first_unfilled_key()\n</code></pre> <p>Return the first key in the ordered fields that is not filled. This enables a simple wizard-like progression and supports backtracking by clearing fields with <code>unset(key)</code>.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.session_management.SessionState.summary","title":"summary","text":"<pre><code>summary()\n</code></pre> <p>Return a nice printable summary of all fields in a tabular format.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.session_management.SessionState.to_dict","title":"to_dict","text":"<pre><code>to_dict(only_filled=False)\n</code></pre> <p>Flatten the session into a plain dict suitable for runner.run(...). If only_filled=True, include only keys that have been filled.</p> <p>Parameters:</p> Name Type Description Default <code>only_filled</code> <code>bool</code> <p>Whether to include only filled keys, by default False.</p> <code>False</code> <p>Returns:</p> Type Description <code>dict</code> <p>Flattened session dictionary.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.session_management.get_cds_dataset_config","title":"get_cds_dataset_config","text":"<pre><code>get_cds_dataset_config(session, dataset_config_mapping)\n</code></pre> <p>Return dataset configuration dictionary based on session short name.</p> <p>Parameters:</p> Name Type Description Default <code>session</code> <code>SessionState</code> <p>The current session state containing user selections.</p> required <code>dataset_config_mapping</code> <code>dict</code> <p>The mapping of dataset short names to their configurations.</p> required <p>Returns:</p> Type Description <code>dict</code> <p>The configuration dictionary for the selected dataset.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.session_management.map_config_to_session","title":"map_config_to_session","text":"<pre><code>map_config_to_session(\n    cfg, session, *, logger=None, echo_console=False\n)\n</code></pre> <p>Validate and map a loaded JSON config into SessionState.</p> <p>Parameters:</p> Name Type Description Default <code>cfg</code> <code>dict</code> <p>Loaded configuration dictionary.</p> required <code>session</code> <code>SessionState</code> <p>The session state to populate.</p> required Returns: <p>tuple : (bool, list[str])     (ok, messages): ok=False if any hard error prevents continuing.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.session_management.ensure_cds_connection","title":"ensure_cds_connection","text":"<pre><code>ensure_cds_connection(\n    client,\n    creds,\n    max_reauth_attempts=6,\n    wait_between_attempts=15,\n)\n</code></pre> <p>Ensure a valid CDS API client. Re-authenticate automatically if the connection drops.</p> <p>Parameters:</p> Name Type Description Default <code>client</code> <code>Client</code> <p>Current CDS API client.</p> required <code>creds</code> <code>dict</code> <p>{'url': str, 'key': str} stored from initial login.</p> required <code>max_reauth_attempts</code> <code>int</code> <p>Maximum reconnection attempts before aborting.</p> <code>6</code> <code>wait_between_attempts</code> <code>int</code> <p>Wait time (seconds) between re-auth attempts.</p> <code>15</code> <p>Returns:</p> Type Description <code>Client | None</code> <p>Valid client or None if re-authentication ultimately fails.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.session_management.internet_speedtest","title":"internet_speedtest","text":"<pre><code>internet_speedtest(\n    test_urls=None,\n    max_seconds=15,\n    logger=None,\n    echo_console=True,\n)\n</code></pre> <p>Download ~100MB test file from a fast CDN to estimate speed (MB/s).</p> <p>Parameters:</p> Name Type Description Default <code>test_urls</code> <code>list[str]</code> <p>List of URLs of the test files.</p> <code>None</code> <code>max_seconds</code> <code>int</code> <p>Maximum time to wait for a response, by default 15 seconds.</p> <code>15</code> <p>Returns:</p> Type Description <code>    float: Estimated download speed in Mbps.</code>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#utilsdata_validationpy","title":"<code>utils/data_validation.py</code>","text":"<p>Input validation functions.</p> <p>Key Functions:</p> <p><code>validate_config(config, logger, run_mode)</code></p> <p>Comprehensive configuration validation. Checks:</p> <ul> <li>All required fields are present</li> <li>Data types are correct</li> <li>Values are in valid ranges</li> <li>Enumerations match allowed values</li> <li>Dates are properly formatted and logical</li> <li>Region bounds are valid</li> </ul> <p>Side Effects: - Clamps out-of-range values with warnings - Converts incompatible settings (e.g., <code>prompt</code> \u2192 <code>skip_all</code> in batch mode)</p> <p><code>validate_cds_api_key(api_url, api_key, logger, echo_console)</code></p> <p>Tests CDS API credentials by attempting to create a client connection.</p> <p>Returns: - <code>cdsapi.Client</code> if successful, else <code>None</code></p> <p><code>invalid_era5_world_variables(variables)</code></p> <p>Checks for invalid variable names in ERA5 (world) dataset.</p> <p>Returns: - <code>list</code>: Invalid variable names (empty if all valid)</p> <p><code>invalid_era5_land_variables(variables)</code></p> <p>Checks for invalid variable names in ERA5-Land dataset.</p> <p>Returns: - <code>list</code>: Invalid variable names (empty if all valid)</p> <p>Formatting Helpers:</p> <ul> <li><code>format_coordinates_nwse(boundaries)</code> - Convert bounds to string like <code>\"N40W10S35E5\"</code></li> <li><code>format_duration(seconds)</code> - Convert seconds to human-readable duration</li> <li><code>validate_date_format(date_string)</code> - Check if date string is valid YYYY-MM-DD</li> </ul>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.data_validation","title":"weather_data_retrieval.utils.data_validation","text":""},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.data_validation.normalize_input","title":"normalize_input","text":"<pre><code>normalize_input(value, category)\n</code></pre> <p>Normalize user input to canonical internal value as defined in NORMALIZATION_MAP.</p> <p>Parameters:</p> Name Type Description Default <code>value</code> <code>str</code> <p>The user input value to normalize.</p> required <code>category</code> <code>str</code> <p>The category of normalization (e.g., 'data_provider', 'dataset_short_name')</p> required <p>Returns:</p> Type Description <code>str</code> <p>The normalized value.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.data_validation.format_duration","title":"format_duration","text":"<pre><code>format_duration(seconds)\n</code></pre> <p>Convert seconds to a nice Hh Mm Ss string (with decimal seconds).</p> <p>Parameters:</p> Name Type Description Default <code>seconds</code> <code>float</code> <p>Duration in seconds.</p> required <p>Returns:</p> Type Description <code>    str: Formatted duration string.</code>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.data_validation.format_coordinates_nwse","title":"format_coordinates_nwse","text":"<pre><code>format_coordinates_nwse(boundaries)\n</code></pre> <p>Extracts and formats coordinates as integers in N-W-S-E order Used for compact representation in filenames.</p> <p>Parameters:</p> Name Type Description Default <code>boundaries</code> <code>list</code> <p>List of boundaries in the order [north, west, south, east]</p> required <p>Returns:</p> Type Description <code>    str: Formatted string in the format 'N{north}W{west}S{south}E{east}'</code>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.data_validation.month_days","title":"month_days","text":"<pre><code>month_days(year, month)\n</code></pre> <p>Get list of days in a month formatted as two-digit strings.</p> <p>Parameters:</p> Name Type Description Default <code>year</code> <code>int</code> <p>Year of interest.</p> required <code>month</code> <code>int</code> <p>Month of interest.</p> required <p>Returns:</p> Type Description <code>List[str]</code> <p>List of days in the month as two-digit strings.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.data_validation.validate_data_provider","title":"validate_data_provider","text":"<pre><code>validate_data_provider(provider)\n</code></pre> <p>Ensure dataprovider is recognized and implemented.</p> <p>Parameters:</p> Name Type Description Default <code>provider</code> <code>str</code> <p>Name of the data provider.</p> required <p>Returns:</p> Type Description <code>    bool: True if valid, False otherwise.</code>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.data_validation.validate_dataset_short_name","title":"validate_dataset_short_name","text":"<pre><code>validate_dataset_short_name(\n    dataset_short_name,\n    provider,\n    *,\n    logger=None,\n    echo_console=False\n)\n</code></pre> <p>Check dataset compatibility with provider.</p> <p>Parameters:</p> Name Type Description Default <code>dataset_short_name</code> <code>str</code> <p>Dataset short name.</p> required <code>provider</code> <code>str</code> <p>Name of the data provider.</p> required <p>Returns:</p> Type Description <code>bool</code> <p>True if valid, False otherwise.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.data_validation.validate_cds_api_key","title":"validate_cds_api_key","text":"<pre><code>validate_cds_api_key(\n    url, key, *, logger=None, echo_console=False\n)\n</code></pre> <p>Validate CDS API credentials by attempting to initialize a cdsapi.Client.</p> <p>Parameters:</p> Name Type Description Default <code>url</code> <code>str</code> <p>CDS API URL.</p> required <code>key</code> <code>str</code> <p>CDS API key.</p> required <code>logger</code> <code>Logger</code> <p>Logger for logging messages, by default None.</p> <code>None</code> <code>echo_console</code> <code>bool</code> <p>Whether to echo messages to console, by default False.</p> <code>False</code> <p>Returns:</p> Type Description <code>Client | None</code> <p>Authenticated client if successful, otherwise None.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.data_validation.validate_directory","title":"validate_directory","text":"<pre><code>validate_directory(path)\n</code></pre> <p>Check if path exists or can be created.</p> <p>Parameters:</p> Name Type Description Default <code>path</code> <code>str</code> <p>Directory path to validate.</p> required <p>Returns:</p> Type Description <code>bool</code> <p>True if path exists or was created successfully, False otherwise.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.data_validation.validate_date","title":"validate_date","text":"<pre><code>validate_date(\n    value,\n    allow_month_only=False,\n    *,\n    logger=None,\n    echo_console=False\n)\n</code></pre> <p>Validate date format as YYYY-MM-DD or optionally YYYY-MM.</p> <p>Parameters:</p> Name Type Description Default <code>value</code> <code>str</code> <p>Date string to validate.</p> required <code>allow_month_only</code> <code>bool</code> <p>If True, also accept YYYY-MM format, by default False.</p> <code>False</code> <p>Returns:</p> Type Description <code>bool</code> <p>True if valid, False otherwise.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.data_validation.parse_date_with_defaults","title":"parse_date_with_defaults","text":"<pre><code>parse_date_with_defaults(\n    date_str, default_to_month_end=False\n)\n</code></pre> <p>Parse date string and apply defaults for incomplete dates.</p> <p>Parameters:</p> Name Type Description Default <code>date_str</code> <code>str</code> <p>Date string in format YYYY-MM-DD or YYYY-MM.</p> required <code>default_to_month_end</code> <code>bool</code> <p>If True and date is YYYY-MM format, default to last day of month. If False and date is YYYY-MM format, default to first day of month. By default False.</p> <code>False</code> <p>Returns:</p> Type Description <code>tuple[datetime, str]</code> <p>Tuple of (parsed datetime object, ISO format string YYYY-MM-DD)</p> <p>Raises:</p> Type Description <code>ValueError</code> <p>If date string is invalid.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.data_validation.clamp_era5_available_end_date","title":"clamp_era5_available_end_date","text":"<pre><code>clamp_era5_available_end_date(\n    end, *, logger=None, echo_console=False\n)\n</code></pre> <p>Clamp end date to ERA5 data availability boundary (8 days ago).</p> <p>Parameters:</p> Name Type Description Default <code>end</code> <code>datetime</code> <p>Desired end date.</p> required <p>Returns:</p> Name Type Description <code>    datetime: Clamped end date.</code> <code>NOTES</code> <code>ERA5 data is available up to 8 days prior to the current date.</code> <code>8-day lag is used to ensure data availability.</code>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.data_validation.validate_coordinates","title":"validate_coordinates","text":"<pre><code>validate_coordinates(north, west, south, east)\n</code></pre> <p>Ensure coordinates are within realistic bounds.</p> <p>Parameters:</p> Name Type Description Default <code>north</code> <code>int | float</code> <p>Northern latitude boundary.</p> required <code>west</code> <code>int | float</code> <p>Western longitude boundary.</p> required <code>south</code> <code>int | float</code> <p>Southern latitude boundary.</p> required <code>east</code> <code>int | float</code> <p>Eastern longitude boundary.</p> required <p>Returns:</p> Type Description <code>bool</code> <p>True if coordinates are valid, False otherwise.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.data_validation.validate_variables","title":"validate_variables","text":"<pre><code>validate_variables(\n    variable_list,\n    variable_restrictions,\n    restriction_allow=False,\n)\n</code></pre> <p>Ensure user-specified variables are available for this dataset.</p> <p>Parameters:</p> Name Type Description Default <code>variable_list</code> <code>list[str]</code> <p>List of variable names to validate.</p> required <code>variable_restrictions</code> <code>list[str]</code> <p>List of variables that are either allowed or disallowed.</p> required <code>restriction_allow</code> <code>bool</code> <p>If True, variable_restrictions is an allowlist (i.e. in). If False, it's a denylist (i.e. not in)</p> <code>False</code> <p>Returns:</p> Type Description <code>bool</code> <p>True if all variables are valid, False otherwise.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.data_validation.validate_existing_file_action","title":"validate_existing_file_action","text":"<pre><code>validate_existing_file_action(\n    session, *, allow_prompts, logger, echo_console=False\n)\n</code></pre> <p>Normalize existing_file_action for the current run-mode. - If 'case_by_case' is set but prompts are not allowed (automatic mode),   coerce to 'skip_all' and warn.</p> <p>Parameters:</p> Name Type Description Default <code>session</code> <code>Any</code> <p>Current session state.</p> required <code>allow_prompts</code> <code>bool</code> <p>Whether prompts are allowed (i.e., interactive mode).</p> required <code>logger</code> <code>Logger</code> <p>Logger for logging messages.</p> required <code>echo_console</code> <code>bool</code> <p>Whether to echo messages to console.</p> <code>False</code> <p>Returns:</p> Type Description <code>str</code> <p>Normalized existing_file_action policy.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.data_validation.validate_config","title":"validate_config","text":"<pre><code>validate_config(\n    config,\n    *,\n    logger=None,\n    run_mode=\"automatic\",\n    echo_console=False,\n    live_auth_check=False\n)\n</code></pre> <p>Entry point. Validates common shape then dispatches to provider-specific validator.</p> <p>Parameters:</p> Name Type Description Default <code>config</code> <code>dict</code> <p>Configuration dictionary.</p> required <code>logger</code> <code>Logger</code> <p>Logger for logging messages, by default None.</p> <code>None</code> <code>run_mode</code> <code>str</code> <p>Run mode, either 'interactive' or 'automatic', by default \"automatic\".</p> <code>'automatic'</code> <code>echo_console</code> <code>bool</code> <p>Whether to echo messages to console, by default False.</p> <code>False</code> <code>live_auth_check</code> <code>bool</code> <p>Whether to perform live authentication checks (e.g., CDS API), by default False.</p> <code>False</code> <p>Returns:</p> Type Description <code>None</code>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#utilsfile_managementpy","title":"<code>utils/file_management.py</code>","text":"<p>File naming, checking, and estimation functions.</p> <p>Key Functions:</p> <p><code>generate_filename_hash(dataset_short_name, variables, boundaries)</code></p> <p>Creates a unique 12-character hash from download parameters. This ensures files with different parameters don't collide.</p> <p>Returns: - <code>str</code>: 12-character hash (e.g., <code>\"abc123def456\"</code>)</p> <p><code>find_existing_month_file(save_dir, filename_base, year, month)</code></p> <p>Searches for an existing file for a given month, handling different date separators and extensions.</p> <p>Returns: - <code>Path</code> if file exists, else <code>None</code></p> <p><code>estimate_era5_monthly_file_size(variables, area, grid_resolution, ...)</code></p> <p>Estimates file size for a monthly ERA5 download based on empirical data.</p> <p>Parameters: - <code>variables</code> (list): Variables to download - <code>area</code> (list): Region bounds - <code>grid_resolution</code> (float): Grid spacing in degrees - <code>timestep_hours</code> (float): Temporal resolution - <code>bytes_per_value</code> (float): Storage size per value</p> <p>Returns: - <code>float</code>: Estimated size in MB</p> <p><code>estimate_cds_download(variables, area, start_date, end_date, observed_speed_mbps, ...)</code></p> <p>Comprehensive download estimation including size, time, and parallelization effects.</p> <p>Returns: - <code>dict</code>:    <pre><code>{\n  \"months\": 12,              # Number of monthly files\n  \"file_size_MB\": 42.3,      # Average file size\n  \"total_size_MB\": 507.6,    # Total download size\n  \"time_per_file_sec\": 180,  # Time per file\n  \"total_time_sec\": 2160     # Total estimated time\n}\n</code></pre></p> <p>File Format Helpers:</p> <ul> <li><code>is_zip_file(path)</code> - Check if file is a ZIP archive</li> <li><code>is_grib_file(path)</code> - Check if file is a GRIB file</li> <li><code>unpack_zip_to_grib(zip_path, final_grib_path)</code> - Extract GRIB from ZIP</li> </ul>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.file_management","title":"weather_data_retrieval.utils.file_management","text":""},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.file_management.generate_filename_hash","title":"generate_filename_hash","text":"<pre><code>generate_filename_hash(\n    dataset_short_name, variables, boundaries\n)\n</code></pre> <p>Generate a unique hash for the download parameters that will be used to create the filename.</p> <p>Parameters:</p> Name Type Description Default <code>dataset_short_name</code> <code>str</code> <p>The dataset short name (era5-world etc).</p> required <code>variables</code> <code>list[str]</code> <p>List of variable names.</p> required <code>boundaries</code> <code>list[float]</code> <p>List of boundaries [north, west, south, east].</p> required <p>Returns:</p> Type Description <code>    str: A unique hash string representing the download parameters.</code>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.file_management.find_existing_month_file","title":"find_existing_month_file","text":"<pre><code>find_existing_month_file(\n    save_dir, filename_base, year, month\n)\n</code></pre> <p>Tolerant matcher that finds an existing file for the given month. Accepts both <code>_YYYY-MM.ext</code> and <code>_YYYY_MM.ext</code> patterns and any extension.</p> <p>Parameters:</p> Name Type Description Default <code>save_dir</code> <code>Path</code> <p>Directory where files are saved.</p> required <code>filename_base</code> <code>str</code> <p>Base filename (without date or extension).</p> required <code>year</code> <code>int</code> <p>Year of the file.</p> required <code>month</code> <code>int</code> <p>Month of the file.</p> required <p>Returns:</p> Type Description <code>Optional[Path]</code> <p>Path to the existing file if found, else None.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.file_management.estimate_era5_monthly_file_size","title":"estimate_era5_monthly_file_size","text":"<pre><code>estimate_era5_monthly_file_size(\n    variables,\n    area,\n    grid_resolution=0.25,\n    timestep_hours=1.0,\n    bytes_per_value=4.0,\n)\n</code></pre> <p>Estimate ERA5 GRIB file size (MB) for a monthly dataset.</p> <p>Parameters:</p> Name Type Description Default <code>variables</code> <code>list[str]</code> <p>Variables requested (e.g. ['2m_temperature', 'total_precipitation']).</p> required <code>area</code> <code>list[float]</code> <p>[north, west, south, east] geographic bounds in degrees.</p> required <code>grid_resolution</code> <code>float</code> <p>Grid spacing in degrees (default 0.25\u00b0 for ERA5).</p> <code>0.25</code> <code>timestep_hours</code> <code>float</code> <p>Temporal resolution in hours (1 = hourly, 3 = 3-hourly, 6 = 6-hourly, etc.).</p> <code>1.0</code> <code>bytes_per_value</code> <code>float</code> <p>Bytes per gridpoint per variable (float32 = 4 bytes).</p> <code>4.0</code> <p>Returns:</p> Type Description <code>float</code> <p>Estimated monthly file size in MB.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.file_management.estimate_cds_download","title":"estimate_cds_download","text":"<pre><code>estimate_cds_download(\n    variables,\n    area,\n    start_date,\n    end_date,\n    observed_speed_mbps,\n    grid_resolution=0.25,\n    timestep_hours=1.0,\n    bytes_per_value=4.0,\n    overhead_per_request_s=180.0,\n    overhead_per_var_s=12.0,\n)\n</code></pre> <p>Estimate per-file and total download size/time for CDS (ERA5) retrievals, using an empirically grounded file size model.</p> <p>Parameters:</p> Name Type Description Default <code>variables</code> <code>list[str]</code> <p>Variables selected (e.g. ['2m_temperature', 'total_precipitation']).</p> required <code>area</code> <code>list[float]</code> <p>[north, west, south, east] bounds in degrees.</p> required <code>start_date</code> <code>str</code> <p>Date range (YYYY-MM-DD).</p> required <code>end_date</code> <code>str</code> <p>Date range (YYYY-MM-DD).</p> required <code>observed_speed_mbps</code> <code>float</code> <p>Measured internet speed in megabits per second (Mbps).</p> required <code>grid_resolution</code> <code>float</code> <p>Grid resolution in degrees (default 0.25\u00b0).</p> <code>0.25</code> <code>timestep_hours</code> <code>float</code> <p>Temporal resolution in hours (default 1-hourly).</p> <code>1.0</code> <code>bytes_per_value</code> <code>float</code> <p>Bytes per stored value (float32 = 4).</p> <code>4.0</code> <code>overhead_per_request_s</code> <code>float</code> <p>Fixed CDS request overhead time (queue/prep).</p> <code>180.0</code> <code>overhead_per_var_s</code> <code>float</code> <p>Per-variable overhead for CDS throttling/prep.</p> <code>12.0</code> <p>Returns:</p> Type Description <code>dict</code> <p>{   \"months\": int,   \"file_size_MB\": float,   \"total_size_MB\": float,   \"time_per_file_sec\": float,   \"total_time_sec\": float }</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.file_management.expected_save_stem","title":"expected_save_stem","text":"<pre><code>expected_save_stem(save_dir, filename_base, year, month)\n</code></pre> <p>Construct canonical save stem (without extension) for monthly data.</p> <p>Parameters:</p> Name Type Description Default <code>save_dir</code> <code>str | Path | None</code> <p>Base directory for saving. If None, defaults to osme_common.paths.data_dir().</p> required <code>filename_base</code> <code>str</code> <p>Base name without date or extension.</p> required <code>year</code> <code>int</code> <p>Year and month of the file.</p> required <code>month</code> <code>int</code> <p>Year and month of the file.</p> required <p>Returns:</p> Type Description <code>Path</code> <p>Resolved path under the proper data directory.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.file_management.expected_save_path","title":"expected_save_path","text":"<pre><code>expected_save_path(\n    save_dir, filename_base, year, month, data_format=\"grib\"\n)\n</code></pre> <p>Construct canonical save path for monthly data.</p> <p>Parameters:</p> Name Type Description Default <code>save_dir</code> <code>str | Path | None</code> <p>Base directory for saving. If None, defaults to osme_common.paths.data_dir().</p> required <code>filename_base</code> <code>str</code> <p>Base name without date or extension.</p> required <code>year</code> <code>int</code> <p>Year and month of the file.</p> required <code>month</code> <code>int</code> <p>Year and month of the file.</p> required <code>data_format</code> <code>str</code> <p>File extension, e.g., 'grib' or 'nc'.</p> <code>'grib'</code> <p>Returns:</p> Type Description <code>Path</code> <p>Resolved path under the proper data directory.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.file_management.is_zip_file","title":"is_zip_file","text":"<pre><code>is_zip_file(path)\n</code></pre> <p>Check if a file is a ZIP archive by reading its magic number.</p> <p>Parameters:</p> Name Type Description Default <code>path</code> <code>Path</code> <p>Path to the file to check.</p> required <p>Returns:</p> Type Description <code>bool</code> <p>True if the file is a ZIP archive, False otherwise.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.file_management.is_grib_file","title":"is_grib_file","text":"<pre><code>is_grib_file(path)\n</code></pre> <p>Check if a file is a GRIB file by reading its magic number. GRIB files begin with ASCII bytes 'GRIB'.</p> <p>Parameters:</p> Name Type Description Default <code>path</code> <code>Path</code> <p>Path to the file to check.</p> required <p>Returns:</p> Type Description <code>bool</code> <p>True if the file is a GRIB file, False otherwise.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.file_management.unpack_zip_to_grib","title":"unpack_zip_to_grib","text":"<pre><code>unpack_zip_to_grib(zip_path, final_grib_path)\n</code></pre> <p>Extract a ZIP and move the contained GRIB-like file to final_grib_path. If multiple candidates exist, prefer .grib/.grb/.grib2; otherwise take the largest file.</p> <p>Parameters:</p> Name Type Description Default <code>zip_path</code> <code>Path</code> <p>Path to the ZIP file.</p> required <code>final_grib_path</code> <code>Path</code> <p>Desired final path for the extracted GRIB file.</p> required <p>Returns:</p> Type Description <code>Path</code> <p>Path to the final GRIB file.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#utilsloggingpy","title":"<code>utils/logging.py</code>","text":"<p>Logging configuration and utilities.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.logging","title":"weather_data_retrieval.utils.logging","text":""},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.logging.build_download_summary","title":"build_download_summary","text":"<pre><code>build_download_summary(\n    session, estimates, speed_mbps, save_dir=None\n)\n</code></pre> <p>Construct a formatted summary string of the current download configuration.</p> <p>Parameters:</p> Name Type Description Default <code>session</code> <code>SessionState</code> <p>Current session state containing all parameters.</p> required <code>estimates</code> <code>dict</code> <p>Dictionary containing download size and time estimates.</p> required <code>speed_mbps</code> <code>float</code> <p>Measured or estimated internet speed in Mbps.</p> required <p>Returns:</p> Type Description <code>str</code> <p>Nicely formatted summary string for display or logging.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.logging.setup_logger","title":"setup_logger","text":"<pre><code>setup_logger(\n    save_dir=None, run_mode=\"interactive\", verbose=False\n)\n</code></pre> <p>Initialize and return a configured logger.</p> <p>Logs are written to /logs (or $OSME_LOG_DIR) by default, with optional console output in interactive or verbose modes. <p>Parameters:</p> Name Type Description Default <code>save_dir</code> <code>str or None</code> <p>Directory to save log files. If None, defaults to osme_common.paths.log_dir().</p> <code>None</code> <code>run_mode</code> <code>str</code> <p>Either 'interactive' or 'automatic', by default 'interactive'.</p> <code>'interactive'</code> <code>verbose</code> <code>bool</code> <p>Whether to echo logs to console in automatic mode, by default False.</p> <code>False</code> <p>Returns:</p> Type Description <code>Logger</code> <p>Configured logger instance.</p> <p>Key Functions:</p> <p><code>setup_logger(save_dir, run_mode, verbose)</code></p> <p>Initializes a configured logger for the package.</p> <p>Parameters: - <code>save_dir</code> (str, optional): Directory for log files (defaults to <code>logs/weather_data_retrieval/</code>) - <code>run_mode</code> (str): <code>\"interactive\"</code> or <code>\"automatic\"</code> - <code>verbose</code> (bool): Whether to show console output</p> <p>Returns: - <code>logging.Logger</code>: Configured logger instance</p> <p>Configuration: - File handler: DEBUG level (everything) - Console handler: INFO level (only in interactive or verbose mode) - Format: <code>\"%(asctime)s | %(levelname)s | %(message)s\"</code></p> <p><code>log_msg(msg, logger, level, echo_console, force)</code></p> <p>Unified logging utility that writes to file and optionally to console.</p> <p>Parameters: - <code>msg</code> (str): Message to log - <code>logger</code> (logging.Logger): Logger instance - <code>level</code> (str): <code>\"debug\"</code>, <code>\"info\"</code>, <code>\"warning\"</code>, <code>\"error\"</code>, <code>\"exception\"</code> - <code>echo_console</code> (bool): Print to console - <code>force</code> (bool): Print even if <code>echo_console=False</code> (for critical messages)</p> <p><code>build_download_summary(session, estimates, speed_mbps, save_dir)</code></p> <p>Constructs a formatted summary of the download configuration.</p> <p>Returns: - <code>str</code>: Multi-line summary string</p> <p><code>create_final_log_file(session, filename_base, original_logger, ...)</code></p> <p>Creates a final log file with the same naming convention as data files.</p> <p>Parameters: - <code>session</code> (SessionState): Current session - <code>filename_base</code> (str): Base filename - <code>original_logger</code> (logging.Logger): Current logger - <code>delete_original</code> (bool): Remove temporary log - <code>reattach_to_final</code> (bool): Continue logging to final file</p> <p>Returns: - <code>str</code>: Path to final log file</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.logging.log_msg","title":"log_msg","text":"<pre><code>log_msg(\n    msg,\n    logger,\n    *,\n    level=\"info\",\n    echo_console=False,\n    force=False\n)\n</code></pre> <p>Unified logging utility. - Always logs to file. - Optionally echoes to console via tqdm.write.</p> <p>Parameters:</p> Name Type Description Default <code>echo_console</code> <code>bool</code> <p>Print to console when True (used for verbose mode).</p> <code>False</code> <code>force</code> <code>bool</code> <p>Print to console regardless of echo_console (used for summaries/errors).</p> <code>False</code>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#weather_data_retrieval.utils.logging.create_final_log_file","title":"create_final_log_file","text":"<pre><code>create_final_log_file(\n    session,\n    filename_base,\n    original_logger,\n    *,\n    delete_original=True,\n    reattach_to_final=True\n)\n</code></pre> <p>Create a final log file with the same naming pattern as data files. Copies content from the original log file.</p> <p>Parameters:</p> Name Type Description Default <code>session</code> <code>Any(SessionState)</code> <p>Current session state.</p> required <code>filename_base</code> <code>str</code> <p>Base filename pattern (same as data files).</p> required <code>original_logger</code> <code>Logger</code> <p>The original logger instance.</p> required <code>delete_original</code> <code>bool</code> <p>Whether to delete the original log file after creating the final one, by default True.</p> <code>True</code> <code>reattach_to_final</code> <code>bool</code> <p>Whether to reattach the logger to the final log file, by default True.</p> <code>True</code> <p>Returns:</p> Type Description <code>str</code> <p>Path to the final log file.</p>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#usage-examples","title":"Usage Examples","text":""},{"location":"osme-weather-data-retrieval-documentation/codebase/#creating-a-custom-download-script","title":"Creating a Custom Download Script","text":"<pre><code>from weather_data_retrieval.runner import run\n\n# Define your configuration\nconfig = {\n    \"data_provider\": \"cds\",\n    \"dataset_short_name\": \"era5-land\",\n    \"api_url\": \"https://cds.climate.copernicus.eu/api\",\n    \"api_key\": \"YOUR_KEY\",\n    \"start_date\": \"2023-01-01\",\n    \"end_date\": \"2023-03-31\",\n    \"region_bounds\": [40, -10, 35, 5],\n    \"variables\": [\"2m_temperature\"],\n    \"existing_file_action\": \"skip_all\",\n    \"retry_settings\": {\"max_retries\": 3, \"retry_delay_sec\": 15},\n    \"parallel_settings\": {\"enabled\": True, \"max_concurrent\": 2}\n}\n\n# Run the download\nexit_code = run(config, run_mode=\"automatic\", verbose=True)\n\nif exit_code == 0:\n    print(\"Download completed successfully!\")\nelif exit_code == 2:\n    print(\"Download completed with some failures. Check logs.\")\nelse:\n    print(\"Download failed. Check logs.\")\n</code></pre>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#validating-a-config-before-running","title":"Validating a Config Before Running","text":"<pre><code>from weather_data_retrieval.utils.data_validation import validate_config\nfrom weather_data_retrieval.utils.logging import setup_logger\n\nlogger = setup_logger(run_mode=\"automatic\", verbose=True)\n\nconfig = { ... }  # Your config\n\ntry:\n    validate_config(config, logger=logger, run_mode=\"automatic\")\n    print(\"\u2713 Configuration is valid!\")\nexcept ValueError as e:\n    print(f\"\u2717 Configuration error: {e}\")\n</code></pre>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#estimating-download-before-running","title":"Estimating Download Before Running","text":"<pre><code>from weather_data_retrieval.utils.file_management import estimate_cds_download\nfrom weather_data_retrieval.utils.session_management import internet_speedtest\n\n# Test internet speed\nspeed_mbps = internet_speedtest(max_seconds=10, logger=None, echo_console=True)\n\n# Estimate download\nestimates = estimate_cds_download(\n    variables=[\"2m_temperature\", \"total_precipitation\"],\n    area=[40, -10, 35, 5],\n    start_date=\"2023-01-01\",\n    end_date=\"2023-12-31\",\n    observed_speed_mbps=speed_mbps,\n    grid_resolution=0.1\n)\n\nprint(f\"Estimated files: {estimates['months']}\")\nprint(f\"Total size: {estimates['total_size_MB']:.1f} MB\")\nprint(f\"Estimated time: {estimates['total_time_sec'] / 60:.1f} minutes\")\n</code></pre>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#extending-the-package","title":"Extending the Package","text":""},{"location":"osme-weather-data-retrieval-documentation/codebase/#adding-a-new-data-provider","title":"Adding a New Data Provider","text":"<p>To add a new provider (e.g., Open-Meteo):</p> <ol> <li> <p>Create provider module: <code>sources/my_provider.py</code></p> </li> <li> <p>Implement download function:    <pre><code>def orchestrate_my_provider_downloads(\n    session, filename_base, save_dir,\n    successful_downloads, failed_downloads, skipped_downloads,\n    logger, echo_console, allow_prompts\n):\n    # Your implementation\n    pass\n</code></pre></p> </li> <li> <p>Add to session mapping: Update <code>session_management.py</code> to handle new provider</p> </li> <li> <p>Add validation: Update <code>data_validation.py</code> to validate provider-specific params</p> </li> <li> <p>Update prompts: Add provider selection in <code>io/prompts.py</code></p> </li> </ol>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#adding-new-variables","title":"Adding New Variables","text":"<p>Variables are validated against hard-coded lists in <code>data_validation.py</code>:</p> <pre><code># In data_validation.py\n\nERA5_LAND_VARIABLES = [\n    \"2m_temperature\",\n    \"total_precipitation\",\n    # ... add new variable here\n]\n</code></pre>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#adding-new-configuration-parameters","title":"Adding New Configuration Parameters","text":"<ol> <li> <p>Define in SessionState: Add to the required/optional keys list</p> </li> <li> <p>Add validation: Update <code>validate_config()</code> in <code>data_validation.py</code></p> </li> <li> <p>Add prompt (if interactive): Create <code>prompt_new_parameter()</code> in <code>io/prompts.py</code></p> </li> <li> <p>Use in runner: Access via <code>session.get(\"new_parameter\")</code> in your code</p> </li> </ol>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#testing","title":"Testing","text":""},{"location":"osme-weather-data-retrieval-documentation/codebase/#running-unit-tests","title":"Running Unit Tests","text":"<pre><code># From repo root\npytest packages/weather_data_retrieval/tests/\n</code></pre>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#testing-individual-modules","title":"Testing Individual Modules","text":"<pre><code># Test validation\nfrom weather_data_retrieval.utils.data_validation import validate_config\n\nconfig = {...}\nvalidate_config(config, logger=None, run_mode=\"automatic\")\n</code></pre>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#mock-testing-downloads","title":"Mock Testing Downloads","text":"<p>For testing without hitting the CDS API, you can mock the download functions:</p> <pre><code>from unittest.mock import patch, MagicMock\n\nwith patch('weather_data_retrieval.sources.cds_era5.download_monthly_era5_file') as mock_download:\n    mock_download.return_value = Path(\"/fake/file.grib\")\n    # Run your test\n</code></pre>"},{"location":"osme-weather-data-retrieval-documentation/codebase/#further-reading","title":"Further Reading","text":"<ul> <li>User Guide for usage patterns</li> <li>Configuration Reference for all parameters</li> <li>Troubleshooting for common issues</li> <li>GitHub Repository for source code</li> </ul>"},{"location":"osme-weather-data-retrieval-documentation/configuration/","title":"Configuration Reference","text":"<p>This page documents every configuration parameter for the weather data retrieval package. Use this as a reference when creating JSON config files for batch mode.</p>"},{"location":"osme-weather-data-retrieval-documentation/configuration/#complete-configuration-example","title":"Complete Configuration Example","text":"<pre><code>{\n  \"data_provider\": \"cds\",\n  \"dataset_short_name\": \"era5-land\",\n  \"api_url\": \"https://cds.climate.copernicus.eu/api\",\n  \"api_key\": \"12345:abcdef123456789\",\n  \"start_date\": \"2023-01-01\",\n  \"end_date\": \"2023-12-31\",\n  \"region_bounds\": [40.0, -10.0, 35.0, 5.0],\n  \"variables\": [\n    \"2m_temperature\",\n    \"total_precipitation\"\n  ],\n  \"existing_file_action\": \"skip_all\",\n  \"retry_settings\": {\n    \"max_retries\": 6,\n    \"retry_delay_sec\": 15\n  },\n  \"parallel_settings\": {\n    \"enabled\": true,\n    \"max_concurrent\": 2\n  }\n}\n</code></pre>"},{"location":"osme-weather-data-retrieval-documentation/configuration/#required-parameters","title":"Required Parameters","text":"<p>These parameters must be present in every configuration file.</p>"},{"location":"osme-weather-data-retrieval-documentation/configuration/#data_provider","title":"<code>data_provider</code>","text":"<p>Type: <code>string</code> Required: Yes Options: <code>\"cds\"</code> (Open-Meteo coming soon)</p> <p>The data provider to use for downloading weather data.</p> <pre><code>\"data_provider\": \"cds\"\n</code></pre> <p>Validation: - Must be exactly <code>\"cds\"</code> (case-insensitive, but <code>\"cds\"</code> is standard) - Other providers will be added in future releases</p>"},{"location":"osme-weather-data-retrieval-documentation/configuration/#dataset_short_name","title":"<code>dataset_short_name</code>","text":"<p>Type: <code>string</code> Required: Yes Options: <code>\"era5-land\"</code>, <code>\"era5-world\"</code> (when provider is <code>\"cds\"</code>)</p> <p>The specific dataset to download.</p> <pre><code>\"dataset_short_name\": \"era5-land\"\n</code></pre> <p>Options:</p> Value Description Resolution Coverage <code>era5-land</code> ERA5-Land reanalysis 0.1\u00b0 (~11 km) Land only <code>era5-world</code> ERA5 global reanalysis 0.25\u00b0 (~27 km) Global (land + ocean) <p>Validation: - Must match one of the available datasets for the chosen provider - Case-sensitive</p>"},{"location":"osme-weather-data-retrieval-documentation/configuration/#api_url","title":"<code>api_url</code>","text":"<p>Type: <code>string</code> Required: Yes (for CDS provider) Default: <code>\"https://cds.climate.copernicus.eu/api\"</code></p> <p>The base URL for the CDS API.</p> <pre><code>\"api_url\": \"https://cds.climate.copernicus.eu/api\"\n</code></pre> <p>Validation: - Must be a valid URL starting with <code>http://</code> or <code>https://</code> - For CDS, this should almost always be the default value - Only change if CDS announces a new API endpoint</p>"},{"location":"osme-weather-data-retrieval-documentation/configuration/#api_key","title":"<code>api_key</code>","text":"<p>Type: <code>string</code> Required: Yes (for CDS provider) Format: <code>\"UID:KEY\"</code> (for CDS)</p> <p>Your authentication credentials for the data provider.</p> <pre><code>\"api_key\": \"12345:abcdef123456-7890-ghij-1234-klmnopqr5678\"\n</code></pre> <p>For CDS: - Format: <code>\"UID:KEY\"</code> (colon-separated) - Found on your CDS profile page after registration - Example: <code>\"123456:abcd1234-5678-90ef-ghij-1234567890ab\"</code></p> <p>Security: - \u26a0\ufe0f Never commit API keys to version control - Use placeholders like <code>\"YOUR_API_KEY_HERE\"</code> in committed configs - Add real keys only in local/private copies - Consider using environment variables (future feature)</p> <p>Validation: - Tested against the API before downloads begin - Invalid keys cause immediate failure with clear error message</p>"},{"location":"osme-weather-data-retrieval-documentation/configuration/#start_date","title":"<code>start_date</code>","text":"<p>Type: <code>string</code> Required: Yes Format: <code>\"YYYY-MM-DD\"</code></p> <p>The beginning of the date range to download (inclusive).</p> <pre><code>\"start_date\": \"2023-01-01\"\n</code></pre> <p>Notes: - Downloads are chunked by month, so this is rounded to the start of the month - <code>\"2023-01-15\"</code> effectively becomes <code>\"2023-01-01\"</code> - Must be on or before <code>end_date</code></p> <p>Validation: - Must be a valid date in <code>YYYY-MM-DD</code> format - Cannot be in the future - For ERA5 datasets, must be on or after <code>1940-01-01</code> - For ERA5-Land, must be on or after <code>1950-01-01</code></p>"},{"location":"osme-weather-data-retrieval-documentation/configuration/#end_date","title":"<code>end_date</code>","text":"<p>Type: <code>string</code> Required: Yes Format: <code>\"YYYY-MM-DD\"</code></p> <p>The end of the date range to download (inclusive).</p> <pre><code>\"end_date\": \"2023-12-31\"\n</code></pre> <p>Notes: - Downloads are chunked by month, so this is rounded to the end of the month - <code>\"2023-06-15\"</code> means the entire June 2023 will be downloaded - Must be on or after <code>start_date</code></p> <p>Validation: - Must be a valid date in <code>YYYY-MM-DD</code> format - Must be on or after <code>start_date</code> - Can be up to ~5 days before current date (CDS processing delay)</p> <p>Example Date Ranges:</p> <pre><code>// Single month\n\"start_date\": \"2023-01-01\",\n\"end_date\": \"2023-01-31\"\n\n// Full year\n\"start_date\": \"2023-01-01\",\n\"end_date\": \"2023-12-31\"\n\n// Multi-year\n\"start_date\": \"2020-01-01\",\n\"end_date\": \"2023-12-31\"\n\n// Partial months (rounded to full months)\n\"start_date\": \"2023-03-15\",  // Becomes March 1\n\"end_date\": \"2023-09-20\"      // Downloads through end of September\n</code></pre>"},{"location":"osme-weather-data-retrieval-documentation/configuration/#region_bounds","title":"<code>region_bounds</code>","text":"<p>Type: <code>array</code> of 4 numbers Required: Yes Format: <code>[North, West, South, East]</code></p> <p>The geographic bounding box for the data download.</p> <pre><code>\"region_bounds\": [40.0, -10.0, 35.0, 5.0]\n</code></pre> <p>Format: <code>[North, West, South, East]</code> in decimal degrees</p> Position Name Range Notes 0 North -90 to 90 Northern boundary (latitude) 1 West -180 to 180 Western boundary (longitude) 2 South -90 to 90 Southern boundary (latitude) 3 East -180 to 180 Eastern boundary (longitude) <p>Validation: - North must be &gt; South - Latitude values: -90 to 90 - Longitude values: -180 to 180 - East can be &lt; West for regions crossing the 180\u00b0 meridian</p> <p>Common Regions:</p> <pre><code>// India\n\"region_bounds\": [35.0, 68.0, 8.0, 97.5]\n\n// Europe\n\"region_bounds\": [71.0, -25.0, 35.0, 40.0]\n\n// United States (continental)\n\"region_bounds\": [50.0, -125.0, 25.0, -65.0]\n\n// Global\n\"region_bounds\": [90.0, -180.0, -90.0, 180.0]\n\n// Crossing 180\u00b0 meridian (e.g., Pacific islands)\n\"region_bounds\": [10.0, 170.0, -10.0, -170.0]\n</code></pre> <p>Tips: - Use boundingbox.klokantech.com to find coordinates - Smaller regions = faster downloads and less disk space - Include a small buffer around your study area for edge effects - Remember: larger regions with higher resolution (ERA5-Land) can be very large files</p>"},{"location":"osme-weather-data-retrieval-documentation/configuration/#variables","title":"<code>variables</code>","text":"<p>Type: <code>array</code> of strings Required: Yes Minimum: 1 variable</p> <p>The weather variables to download from the dataset.</p> <pre><code>\"variables\": [\n  \"2m_temperature\",\n  \"total_precipitation\",\n  \"10m_u_component_of_wind\",\n  \"10m_v_component_of_wind\"\n]\n</code></pre> <p>Validation: - Variable names must exactly match the CDS dataset specifications (case-sensitive) - Each variable is validated against dataset-specific available variables - Invalid variables cause immediate failure with a helpful error message</p> <p>Common ERA5/ERA5-Land Variables:</p> Variable Name Description Units Typical Use <code>2m_temperature</code> Temperature 2m above surface Kelvin Thermal analysis, comfort models <code>total_precipitation</code> Accumulated precipitation meters Hydrology, renewable energy (hydro) <code>10m_u_component_of_wind</code> Eastward wind at 10m m/s Wind power, dispersion models <code>10m_v_component_of_wind</code> Northward wind at 10m m/s Wind power (combine with u) <code>surface_pressure</code> Atmospheric pressure at surface Pa Weather patterns, calibration <code>surface_solar_radiation_downwards</code> Incoming solar radiation J/m\u00b2 Solar power potential <code>surface_thermal_radiation_downwards</code> Incoming longwave radiation J/m\u00b2 Energy balance <p>ERA5-Land Specific Variables:</p> Variable Name Description Units <code>soil_temperature_level_1</code> Top soil layer temperature Kelvin <code>soil_temperature_level_2</code> Second soil layer temperature Kelvin <code>soil_moisture_level_1</code> Top soil layer moisture m\u00b3/m\u00b3 <code>snow_depth</code> Snow depth meters <code>skin_temperature</code> Surface skin temperature Kelvin <code>leaf_area_index_low_vegetation</code> LAI for low vegetation m\u00b2/m\u00b2 <code>leaf_area_index_high_vegetation</code> LAI for high vegetation m\u00b2/m\u00b2 <p>ERA5 (World) Specific Variables:</p> Variable Name Description Units <code>sea_surface_temperature</code> Ocean surface temperature Kelvin <code>significant_height_of_combined_wind_waves_and_swell</code> Wave height meters <code>mean_wave_direction</code> Wave direction degrees <p>Finding Variable Names</p> <ul> <li>Browse the CDS ERA5 dataset page</li> <li>Browse the CDS ERA5-Land dataset page</li> <li>Check the \"Variables\" tab for complete lists</li> <li>Variable names use underscores (not spaces or hyphens)</li> </ul> <p>File Size Impact: - More variables = larger files - Some variables (like radiation) have higher data density - Test with 1-2 variables first, then expand</p>"},{"location":"osme-weather-data-retrieval-documentation/configuration/#optional-parameters","title":"Optional Parameters","text":"<p>These parameters have sensible defaults but can be customized.</p>"},{"location":"osme-weather-data-retrieval-documentation/configuration/#existing_file_action","title":"<code>existing_file_action</code>","text":"<p>Type: <code>string</code> Required: No Default: <code>\"skip_all\"</code> Options: <code>\"skip_all\"</code>, <code>\"overwrite\"</code>, <code>\"prompt\"</code></p> <p>How to handle months that already have downloaded files.</p> <pre><code>\"existing_file_action\": \"skip_all\"\n</code></pre> <p>Options:</p> Value Behavior When to Use <code>skip_all</code> Skip any month with an existing file Default, resume failed downloads <code>overwrite</code> Re-download and replace all existing files Force refresh, fix corrupted files <code>prompt</code> Ask for each file (interactive mode only) Fine-grained control <p>Validation: - In batch mode, <code>\"prompt\"</code> is automatically converted to <code>\"skip_all\"</code> (no user to prompt) - A warning is logged when this conversion happens</p> <p>Behavior Details:</p> <p><code>skip_all</code>: - Fastest option (no redundant downloads) - Safe default for resuming interrupted downloads - Checks for existing files by looking for the same filename pattern - Even if the file is corrupted, it will be skipped (use <code>overwrite</code> to force redownload)</p> <p><code>overwrite</code>: - Downloads everything from scratch - Useful if CDS has updated the dataset - Can waste significant time and bandwidth</p> <p><code>prompt</code>: - Only works in interactive mode - Shows you each file and asks: <code>Skip or overwrite? (s/o):</code> - Gives you full control but requires attention</p>"},{"location":"osme-weather-data-retrieval-documentation/configuration/#retry_settings","title":"<code>retry_settings</code>","text":"<p>Type: <code>object</code> Required: No Default: <code>{\"max_retries\": 3, \"retry_delay_sec\": 15}</code></p> <p>Controls retry behavior for failed download attempts.</p> <pre><code>\"retry_settings\": {\n  \"max_retries\": 6,\n  \"retry_delay_sec\": 15\n}\n</code></pre> <p>Sub-parameters:</p>"},{"location":"osme-weather-data-retrieval-documentation/configuration/#max_retries","title":"<code>max_retries</code>","text":"<p>Type: <code>integer</code> Range: 0 to 20 (clamped if outside this range) Default: 3</p> <p>Maximum number of times to retry a failed download.</p> <ul> <li><code>0</code>: No retries (fail immediately)</li> <li><code>1-3</code>: Fast failure, good for testing</li> <li><code>3-6</code>: Recommended for production</li> <li><code>6-10</code>: Patient, good for unreliable connections or HPC</li> <li><code>10+</code>: Very patient (auto-clamped to 20)</li> </ul>"},{"location":"osme-weather-data-retrieval-documentation/configuration/#retry_delay_sec","title":"<code>retry_delay_sec</code>","text":"<p>Type: <code>integer</code> Range: 5 to 300 seconds (clamped if outside) Default: 15</p> <p>How long to wait between retry attempts (in seconds).</p> <ul> <li><code>5-15</code>: Quick retries, good for minor hiccups</li> <li><code>15-30</code>: Recommended for CDS (gives queue time to clear)</li> <li><code>30-60</code>: Patient, good for busy periods</li> <li><code>60+</code>: Very patient, good for HPC jobs that run overnight</li> </ul> <p>Example Scenarios:</p> <pre><code>// Fast failure for testing\n\"retry_settings\": {\n  \"max_retries\": 1,\n  \"retry_delay_sec\": 10\n}\n\n// Balanced (default)\n\"retry_settings\": {\n  \"max_retries\": 3,\n  \"retry_delay_sec\": 15\n}\n\n// Patient (HPC or overnight jobs)\n\"retry_settings\": {\n  \"max_retries\": 10,\n  \"retry_delay_sec\": 60\n}\n</code></pre> <p>Validation: - Values outside the allowed ranges are automatically clamped - A warning is logged when clamping occurs - Example: <code>max_retries: 50</code> \u2192 clamped to 20 with a warning</p>"},{"location":"osme-weather-data-retrieval-documentation/configuration/#parallel_settings","title":"<code>parallel_settings</code>","text":"<p>Type: <code>object</code> Required: No Default: <code>{\"enabled\": false, \"max_concurrent\": 1}</code></p> <p>Controls parallel downloading of multiple months simultaneously.</p> <pre><code>\"parallel_settings\": {\n  \"enabled\": true,\n  \"max_concurrent\": 2\n}\n</code></pre> <p>Sub-parameters:</p>"},{"location":"osme-weather-data-retrieval-documentation/configuration/#enabled","title":"<code>enabled</code>","text":"<p>Type: <code>boolean</code> Default: <code>false</code></p> <p>Whether to enable parallel downloads.</p> <ul> <li><code>false</code>: Download one month at a time (sequential)</li> <li><code>true</code>: Download multiple months simultaneously</li> </ul>"},{"location":"osme-weather-data-retrieval-documentation/configuration/#max_concurrent","title":"<code>max_concurrent</code>","text":"<p>Type: <code>integer</code> Range: 1 to 8 (clamped if outside) Default: 1</p> <p>Maximum number of simultaneous downloads.</p> <ul> <li><code>1</code>: Sequential (same as <code>enabled: false</code>)</li> <li><code>2</code>: Good default for most cases</li> <li><code>3-4</code>: Faster for large downloads, good network needed</li> <li><code>4+</code>: Risks hitting CDS rate limits, not usually recommended</li> </ul> <p>Validation: - <code>max_concurrent</code> is clamped to 1-8 - If <code>enabled: false</code>, <code>max_concurrent</code> is ignored - A warning is logged if values are clamped</p> <p>Performance Notes:</p> <p>The tool assumes parallel downloads have ~60% efficiency compared to perfect linear scaling:</p> Months Sequential Time Parallel (2) Parallel (4) 12 60 min ~36 min ~22 min 24 120 min ~72 min ~44 min 48 240 min ~144 min ~88 min <p>This accounts for: - CDS queue management overhead - Network connection overhead - Retry delays and throttling</p> <p>Example Scenarios:</p> <pre><code>// Sequential (most reliable)\n\"parallel_settings\": {\n  \"enabled\": false\n}\n\n// Balanced speed/reliability (recommended)\n\"parallel_settings\": {\n  \"enabled\": true,\n  \"max_concurrent\": 2\n}\n\n// Fast (requires good connection)\n\"parallel_settings\": {\n  \"enabled\": true,\n  \"max_concurrent\": 4\n}\n</code></pre> <p>When NOT to use parallelization: - Slow internet connection (&lt;10 Mbps) - Unreliable connection (frequent dropouts) - Downloading from shared/metered connection - CDS is reporting degraded performance</p>"},{"location":"osme-weather-data-retrieval-documentation/configuration/#validation-and-error-handling","title":"Validation and Error Handling","text":""},{"location":"osme-weather-data-retrieval-documentation/configuration/#automatic-corrections","title":"Automatic Corrections","text":"<p>Some invalid values are automatically corrected with a warning logged:</p> <p>Clamping: <pre><code>// Input\n\"retry_settings\": {\n  \"max_retries\": 50,  // Too high\n  \"retry_delay_sec\": 3  // Too low\n}\n\n// Auto-corrected to\n\"retry_settings\": {\n  \"max_retries\": 20,  // Clamped to maximum\n  \"retry_delay_sec\": 5  // Clamped to minimum\n}\n// Warning logged: \"max_retries clamped from 50 to 20\"\n</code></pre></p> <p>Mode Conversion: <pre><code>// Input (batch mode)\n\"existing_file_action\": \"prompt\"\n\n// Auto-corrected to\n\"existing_file_action\": \"skip_all\"\n// Warning logged: \"Cannot prompt in batch mode, using skip_all\"\n</code></pre></p>"},{"location":"osme-weather-data-retrieval-documentation/configuration/#fatal-errors","title":"Fatal Errors","text":"<p>These errors cause immediate failure:</p> <ul> <li>Missing required parameters</li> <li>Invalid data_provider or dataset_short_name</li> <li>Invalid date format or impossible date range</li> <li>Invalid region_bounds (North \u2264 South, out of range coords)</li> <li>Invalid variables for chosen dataset</li> <li>Failed API authentication</li> <li>Malformed JSON</li> </ul>"},{"location":"osme-weather-data-retrieval-documentation/configuration/#environment-variables","title":"Environment Variables","text":"<p>Some settings can be controlled via environment variables (useful for CI/CD or HPC).</p> <p>Future Feature</p> <p>Environment variable support is limited in the current version. Full support is planned.</p> <p>Currently Supported:</p>"},{"location":"osme-weather-data-retrieval-documentation/configuration/#osme_data_dir","title":"<code>OSME_DATA_DIR</code>","text":"<p>Override the default data directory.</p> <pre><code>export OSME_DATA_DIR=\"/scratch/user/weather_data\"\nosme-weather --config my_config.json\n</code></pre> <p>Files will be saved to <code>$OSME_DATA_DIR/&lt;dataset&gt;/raw/</code> instead of <code>&lt;repo_root&gt;/data/</code>.</p>"},{"location":"osme-weather-data-retrieval-documentation/configuration/#osme_log_dir","title":"<code>OSME_LOG_DIR</code>","text":"<p>Override the default log directory.</p> <pre><code>export OSME_LOG_DIR=\"/scratch/user/logs\"\nosme-weather --config my_config.json\n</code></pre> <p>Logs will be saved to <code>$OSME_LOG_DIR/weather_data_retrieval/</code> instead of <code>&lt;repo_root&gt;/logs/</code>.</p>"},{"location":"osme-weather-data-retrieval-documentation/configuration/#complete-schema-reference","title":"Complete Schema Reference","text":"<p>Here's the full JSON schema for validation:</p> <pre><code>{\n  \"data_provider\": \"cds\",  // required, string, enum: [\"cds\"]\n  \"dataset_short_name\": \"era5-land\",  // required, string, enum: [\"era5-land\", \"era5-world\"]\n  \"api_url\": \"https://cds.climate.copernicus.eu/api\",  // required (for CDS), string, URL\n  \"api_key\": \"UID:KEY\",  // required (for CDS), string\n  \"start_date\": \"YYYY-MM-DD\",  // required, string, date format\n  \"end_date\": \"YYYY-MM-DD\",  // required, string, date format, &gt;= start_date\n  \"region_bounds\": [N, W, S, E],  // required, array of 4 numbers\n  \"variables\": [\"var1\", \"var2\"],  // required, array of strings, min 1\n  \"existing_file_action\": \"skip_all\",  // optional, string, enum: [\"skip_all\", \"overwrite\", \"prompt\"], default: \"skip_all\"\n  \"retry_settings\": {  // optional, object\n    \"max_retries\": 3,  // integer, 0-20, default: 3\n    \"retry_delay_sec\": 15  // integer, 5-300, default: 15\n  },\n  \"parallel_settings\": {  // optional, object\n    \"enabled\": false,  // boolean, default: false\n    \"max_concurrent\": 1  // integer, 1-8, default: 1\n  }\n}\n</code></pre>"},{"location":"osme-weather-data-retrieval-documentation/configuration/#example-configurations","title":"Example Configurations","text":""},{"location":"osme-weather-data-retrieval-documentation/configuration/#minimal-configuration","title":"Minimal Configuration","text":"<pre><code>{\n  \"data_provider\": \"cds\",\n  \"dataset_short_name\": \"era5-land\",\n  \"api_url\": \"https://cds.climate.copernicus.eu/api\",\n  \"api_key\": \"12345:abcdef\",\n  \"start_date\": \"2023-01-01\",\n  \"end_date\": \"2023-01-31\",\n  \"region_bounds\": [40, -10, 35, 5],\n  \"variables\": [\"2m_temperature\"]\n}\n</code></pre> <p>All optional parameters use defaults.</p>"},{"location":"osme-weather-data-retrieval-documentation/configuration/#production-configuration","title":"Production Configuration","text":"<pre><code>{\n  \"data_provider\": \"cds\",\n  \"dataset_short_name\": \"era5-land\",\n  \"api_url\": \"https://cds.climate.copernicus.eu/api\",\n  \"api_key\": \"YOUR_API_KEY_HERE\",\n  \"start_date\": \"2020-01-01\",\n  \"end_date\": \"2023-12-31\",\n  \"region_bounds\": [35.0, 68.0, 8.0, 97.5],\n  \"variables\": [\n    \"2m_temperature\",\n    \"10m_u_component_of_wind\",\n    \"10m_v_component_of_wind\",\n    \"surface_pressure\",\n    \"total_precipitation\",\n    \"surface_solar_radiation_downwards\"\n  ],\n  \"existing_file_action\": \"skip_all\",\n  \"retry_settings\": {\n    \"max_retries\": 6,\n    \"retry_delay_sec\": 30\n  },\n  \"parallel_settings\": {\n    \"enabled\": true,\n    \"max_concurrent\": 3\n  }\n}\n</code></pre> <p>This configuration: - Downloads 4 years of data (48 monthly files) - Covers India region - Includes 6 common variables for energy modeling - Uses robust retry settings - Enables parallel downloads for speed - Skips existing files (safe for resuming)</p>"},{"location":"osme-weather-data-retrieval-documentation/configuration/#next-steps","title":"Next Steps","text":"<ul> <li>See User Guide for usage patterns and workflows</li> <li>Check Troubleshooting for common configuration errors</li> <li>Browse example configs in the repository's <code>configs/weather/</code> directory</li> </ul>"},{"location":"osme-weather-data-retrieval-documentation/quickstart/","title":"Quickstart Guide","text":"<p>Welcome! This guide will walk you through downloading your first weather dataset. We'll start with an interactive session, then show you how to automate with configuration files.</p>"},{"location":"osme-weather-data-retrieval-documentation/quickstart/#before-you-start","title":"Before You Start","text":""},{"location":"osme-weather-data-retrieval-documentation/quickstart/#1-get-your-cds-api-credentials","title":"1. Get Your CDS API Credentials","text":"<p>To download ERA5 data, you need a free account with the Copernicus Climate Data Store:</p> <ol> <li>Register at https://cds.climate.copernicus.eu</li> <li>Log in and go to your profile page</li> <li>Copy your API key \u2013 it looks like: <code>12345:abcd1234-ef56-7890-gh12-ijklmnop3456</code></li> <li>Accept the license terms for the datasets you plan to use (ERA5, ERA5-Land)</li> </ol> <p>Keep Your API Key Safe</p> <p>Don't commit your API key to version control! The tool will prompt you for it interactively, or you can set it in a <code>.env</code> file or environment variable.</p>"},{"location":"osme-weather-data-retrieval-documentation/quickstart/#2-verify-installation","title":"2. Verify Installation","text":"<p>Check that the package is installed:</p> <pre><code>osme-weather --help\n</code></pre> <p>You should see the help message with available options.</p>"},{"location":"osme-weather-data-retrieval-documentation/quickstart/#your-first-download-interactive-mode","title":"Your First Download (Interactive Mode)","text":"<p>Let's download 3 months of temperature and precipitation data for a small region. This should take about 5-10 minutes depending on your connection.</p>"},{"location":"osme-weather-data-retrieval-documentation/quickstart/#step-1-start-the-interactive-wizard","title":"Step 1: Start the Interactive Wizard","text":"<pre><code>osme-weather\n</code></pre> <p>You'll see a welcome message explaining that you can type <code>back</code>, <code>exit</code>, or <code>Ctrl+C</code> at any time.</p>"},{"location":"osme-weather-data-retrieval-documentation/quickstart/#step-2-follow-the-prompts","title":"Step 2: Follow the Prompts","text":"<p>The wizard will guide you through each configuration step:</p>"},{"location":"osme-weather-data-retrieval-documentation/quickstart/#data-provider","title":"\ud83c\udf0d Data Provider","text":"<pre><code>Which data provider would you like to use?\n  1. CDS (Copernicus Climate Data Store - ERA5, ERA5-Land)\n  2. Open-Meteo (coming soon)\n\nEnter your choice (1-2): 1\n</code></pre> <p>Choose 1 for CDS.</p>"},{"location":"osme-weather-data-retrieval-documentation/quickstart/#dataset-selection","title":"\ud83d\udcca Dataset Selection","text":"<pre><code>Which dataset would you like to download?\n  1. ERA5-Land (0.1\u00b0 resolution, land surfaces only)\n  2. ERA5 (0.25\u00b0 resolution, global coverage)\n\nEnter your choice (1-2): 1\n</code></pre> <p>Choose 1 for ERA5-Land (higher resolution, smaller files).</p>"},{"location":"osme-weather-data-retrieval-documentation/quickstart/#api-authentication","title":"\ud83d\udd10 API Authentication","text":"<pre><code>Enter your CDS API URL (or press Enter for default):\n[default: https://cds.climate.copernicus.eu/api]\n</code></pre> <p>Just press Enter to use the default.</p> <pre><code>Enter your CDS API key (format: UID:KEY):\n</code></pre> <p>Paste your API key from your CDS profile.</p> <p>The tool will test your credentials. If successful, you'll see: <pre><code>\u2713 CDS authentication successful!\n</code></pre></p>"},{"location":"osme-weather-data-retrieval-documentation/quickstart/#date-range","title":"\ud83d\udcc5 Date Range","text":"<pre><code>Enter start date (YYYY-MM-DD): 2023-01-01\n</code></pre> <pre><code>Enter end date (YYYY-MM-DD): 2023-03-31\n</code></pre> <p>This will download data for January through March 2023 (3 monthly files).</p>"},{"location":"osme-weather-data-retrieval-documentation/quickstart/#geographic-region","title":"\ud83d\udccd Geographic Region","text":"<pre><code>Define your region of interest.\n\nEnter coordinates in [North, West, South, East] format.\nExample for India: [35.0, 68.0, 8.0, 97.5]\nExample for California: [42.0, -124.5, 32.5, -114.0]\n\nCoordinates: [40, -5, 35, 5]\n</code></pre> <p>This example covers a region in southern Europe (roughly Spain and surrounding areas).</p> <p>Finding Coordinates</p> <ul> <li>Use https://boundingbox.klokantech.com/ to find coordinates</li> <li>Format: <code>[North, West, South, East]</code> in decimal degrees</li> <li>North/South: -90 to 90 (negative = Southern hemisphere)</li> <li>West/East: -180 to 180 (negative = Western hemisphere)</li> </ul>"},{"location":"osme-weather-data-retrieval-documentation/quickstart/#variables","title":"\ud83c\udf21\ufe0f Variables","text":"<pre><code>Enter variable names (comma-separated).\n\nExample: 2m_temperature, total_precipitation\n\nAvailable variables: 2m_temperature, 10m_u_component_of_wind,\n10m_v_component_of_wind, surface_pressure, total_precipitation,\nsurface_solar_radiation_downwards, surface_thermal_radiation_downwards,\nand more...\n\nVariables: 2m_temperature, total_precipitation\n</code></pre> <p>Start simple with these two common variables.</p>"},{"location":"osme-weather-data-retrieval-documentation/quickstart/#download-settings","title":"\u2699\ufe0f Download Settings","text":"<p>Existing files: <pre><code>What should we do if files already exist?\n  1. Skip existing files (recommended)\n  2. Overwrite all files\n  3. Ask me each time\n\nChoice (1-3): 1\n</code></pre></p> <p>Choose 1 to avoid re-downloading.</p> <p>Parallel downloads: <pre><code>Enable parallel downloads? (y/n): y\n</code></pre></p> <p>Maximum concurrent downloads: <pre><code>Max concurrent downloads (1-4, recommended: 2): 2\n</code></pre></p> <p>Retry settings: <pre><code>Maximum retry attempts (0-10): 3\nDelay between retries (seconds): 15\n</code></pre></p> <p>These defaults are usually good.</p>"},{"location":"osme-weather-data-retrieval-documentation/quickstart/#step-3-review-and-confirm","title":"Step 3: Review and Confirm","text":"<p>The wizard will show you a summary:</p> <pre><code>===========================================================\nDownload Request Summary\n===========================================================\nProvider: CDS\nDataset: era5-land\nDates: 2023-01-01 \u2192 2023-03-31\nArea: [40.0, -5.0, 35.0, 5.0]\nVariables: ['2m_temperature', 'total_precipitation']\nSave Directory: &lt;repo_root&gt;/data/era5-land/raw\n...\nEstimated number of monthly files: 3\nEstimated size per file: 42.5 MB\nEstimated total size: 127.5 MB\n...\nEstimated maximum total time: 8m 45s\n</code></pre> <pre><code>Does this look correct? (yes/no): yes\n</code></pre> <p>Type yes to start downloading!</p>"},{"location":"osme-weather-data-retrieval-documentation/quickstart/#step-4-watch-the-progress","title":"Step 4: Watch the Progress","text":"<p>You'll see progress bars for each monthly file:</p> <pre><code>Downloading: era5-land_N40W5S35E5_abc123def456_2023-01.grib\nProgress: [\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588] 100% | 42.5 MB | 4.2 MB/s\n</code></pre>"},{"location":"osme-weather-data-retrieval-documentation/quickstart/#step-5-find-your-data","title":"Step 5: Find Your Data","text":"<p>When complete, your files will be saved to:</p> <pre><code>&lt;repo_root&gt;/\n  \u2514\u2500\u2500 data/\n      \u2514\u2500\u2500 era5-land/\n          \u2514\u2500\u2500 raw/\n              \u251c\u2500\u2500 era5-land_N40W5S35E5_abc123def456_2023-01.grib\n              \u251c\u2500\u2500 era5-land_N40W5S35E5_abc123def456_2023-02.grib\n              \u2514\u2500\u2500 era5-land_N40W5S35E5_abc123def456_2023-03.grib\n</code></pre> <p>Plus a detailed log file:</p> <pre><code>  \u2514\u2500\u2500 logs/\n      \u2514\u2500\u2500 weather_data_retrieval/\n          \u2514\u2500\u2500 era5-land_N40W5S35E5_abc123def456_2023-01_2023-03_retrieved-20250210T143022.log\n</code></pre>"},{"location":"osme-weather-data-retrieval-documentation/quickstart/#your-second-download-batch-mode","title":"Your Second Download (Batch Mode)","text":"<p>Now that you know what parameters you need, let's create a configuration file for reproducible downloads.</p>"},{"location":"osme-weather-data-retrieval-documentation/quickstart/#step-1-create-a-config-file","title":"Step 1: Create a Config File","text":"<p>Create <code>my_download.json</code>:</p> <pre><code>{\n  \"data_provider\": \"cds\",\n  \"dataset_short_name\": \"era5-land\",\n  \"api_url\": \"https://cds.climate.copernicus.eu/api\",\n  \"api_key\": \"YOUR_UID:YOUR_KEY_HERE\",\n  \"start_date\": \"2023-01-01\",\n  \"end_date\": \"2023-03-31\",\n  \"region_bounds\": [40, -5, 35, 5],\n  \"variables\": [\n    \"2m_temperature\",\n    \"total_precipitation\"\n  ],\n  \"existing_file_action\": \"skip_all\",\n  \"retry_settings\": {\n    \"max_retries\": 3,\n    \"retry_delay_sec\": 15\n  },\n  \"parallel_settings\": {\n    \"enabled\": true,\n    \"max_concurrent\": 2\n  }\n}\n</code></pre> <p>API Key Security</p> <p>Don't commit config files with API keys to GitHub! Either:</p> <ul> <li>Keep config files in a <code>private/</code> directory (add to <code>.gitignore</code>)</li> <li>Use <code>\"YOUR_API_KEY\"</code> as a placeholder and pass the real key via environment variable</li> <li>Use a separate credentials file</li> </ul>"},{"location":"osme-weather-data-retrieval-documentation/quickstart/#step-2-run-the-download","title":"Step 2: Run the Download","text":"<pre><code>osme-weather --config my_download.json\n</code></pre> <p>That's it! The download runs automatically with no prompts.</p>"},{"location":"osme-weather-data-retrieval-documentation/quickstart/#step-3-run-with-verbose-output-optional","title":"Step 3: Run with Verbose Output (Optional)","text":"<p>By default, batch mode only logs to files. To see progress in the terminal:</p> <pre><code>osme-weather --config my_download.json --verbose\n</code></pre>"},{"location":"osme-weather-data-retrieval-documentation/quickstart/#common-first-time-scenarios","title":"Common First-Time Scenarios","text":""},{"location":"osme-weather-data-retrieval-documentation/quickstart/#scenario-1-small-region-short-time-period","title":"Scenario 1: Small Region, Short Time Period","text":"<p>Goal: Quick test download to verify everything works</p> <pre><code>{\n  \"data_provider\": \"cds\",\n  \"dataset_short_name\": \"era5-land\",\n  \"start_date\": \"2023-01-01\",\n  \"end_date\": \"2023-01-31\",\n  \"region_bounds\": [41, -10, 36, 4],\n  \"variables\": [\"2m_temperature\"]\n}\n</code></pre> <p>Expected size: ~20 MB, ~2-3 minutes</p>"},{"location":"osme-weather-data-retrieval-documentation/quickstart/#scenario-2-full-year-medium-region","title":"Scenario 2: Full Year, Medium Region","text":"<p>Goal: Complete annual dataset for a country or large region</p> <pre><code>{\n  \"data_provider\": \"cds\",\n  \"dataset_short_name\": \"era5-land\",\n  \"start_date\": \"2023-01-01\",\n  \"end_date\": \"2023-12-31\",\n  \"region_bounds\": [35, 68, 8, 97.5],\n  \"variables\": [\n    \"2m_temperature\",\n    \"total_precipitation\",\n    \"10m_u_component_of_wind\",\n    \"10m_v_component_of_wind\"\n  ],\n  \"parallel_settings\": {\n    \"enabled\": true,\n    \"max_concurrent\": 3\n  }\n}\n</code></pre> <p>This example is for India. Expected size: ~8-12 GB, 1-3 hours depending on connection.</p>"},{"location":"osme-weather-data-retrieval-documentation/quickstart/#scenario-3-multiple-years-global","title":"Scenario 3: Multiple Years, Global","text":"<p>Goal: Long-term global analysis</p> <pre><code>{\n  \"data_provider\": \"cds\",\n  \"dataset_short_name\": \"era5\",\n  \"start_date\": \"2020-01-01\",\n  \"end_date\": \"2023-12-31\",\n  \"region_bounds\": [90, -180, -90, 180],\n  \"variables\": [\"2m_temperature\", \"total_precipitation\"],\n  \"parallel_settings\": {\n    \"enabled\": true,\n    \"max_concurrent\": 4\n  }\n}\n</code></pre> <p>Large Download</p> <p>This is a very large download (potentially 50+ GB). Make sure you have:</p> <ul> <li>Sufficient disk space</li> <li>A stable internet connection</li> <li>Time (this could take several hours to days)</li> <li>Retry settings configured</li> </ul>"},{"location":"osme-weather-data-retrieval-documentation/quickstart/#whats-next","title":"What's Next?","text":"<p>Now that you've downloaded some weather data:</p> <ol> <li> <p>Explore the files: Use <code>xarray</code> to open the <code>.grib</code> files:    <pre><code>import xarray as xr\nds = xr.open_dataset('data/era5-land/raw/era5-land_*.grib', engine='cfgrib')\nprint(ds)\n</code></pre></p> </li> <li> <p>Download grid data: Move to the grid_data_retrieval package</p> </li> <li> <p>Process your data: Continue to data_cleaning_and_joining</p> </li> <li> <p>Learn more about configs: See the Configuration Reference for all available options</p> </li> <li> <p>Automate with scripts: Check out the User Guide for HPC batch scripts</p> </li> </ol>"},{"location":"osme-weather-data-retrieval-documentation/quickstart/#troubleshooting-quick-tips","title":"Troubleshooting Quick Tips","text":"<p>\"Authentication failed\" \u2192 Double-check your API key format: <code>UID:KEY</code> with no extra spaces</p> <p>\"Request timed out\" \u2192 The CDS API can be slow during peak hours. The tool will retry automatically.</p> <p>\"Invalid variable name\" \u2192 Check the CDS dataset documentation for exact variable names (they're case-sensitive)</p> <p>\"Disk space\" \u2192 Check the estimate before downloading. Each month of ERA5-Land data is typically 30-100 MB depending on variables and region size.</p> <p>For more help, see the full Troubleshooting Guide.</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/","title":"User Guide","text":"<p>This guide covers everything you need to know about using the weather data retrieval package effectively, from basic concepts to advanced workflows.</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#overview","title":"Overview","text":"<p>The <code>weather_data_retrieval</code> package is designed to handle two main workflows:</p> <ol> <li>Interactive Mode: Step-by-step wizard for exploring options and one-off downloads</li> <li>Batch/Automatic Mode: JSON configuration files for reproducible, automated downloads</li> </ol> <p>Both modes use the same underlying download engine and produce identical outputs.</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#interactive-mode-deep-dive","title":"Interactive Mode Deep Dive","text":"<p>Interactive mode is perfect when you're:</p> <ul> <li>Exploring available datasets and variables</li> <li>Not sure exactly what parameters you need</li> <li>Doing a one-time download for analysis</li> <li>Learning how the tool works</li> </ul>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#starting-interactive-mode","title":"Starting Interactive Mode","text":"<pre><code>osme-weather\n</code></pre> <p>Or with the shorter alias:</p> <pre><code>wdr\n</code></pre>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#navigation-commands","title":"Navigation Commands","text":"<p>At any prompt, you can use:</p> <ul> <li><code>back</code> \u2013 Return to the previous question (your answers are preserved)</li> <li><code>exit</code> \u2013 Quit the wizard (your progress is not saved)</li> <li><code>Ctrl+C</code> \u2013 Immediately stop the program</li> </ul>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#quiet-mode","title":"Quiet Mode","text":"<p>If you want minimal console output (only errors and critical messages):</p> <pre><code>osme-weather --quiet\n</code></pre> <p>Logs are still written to files; you just won't see the prompt flow in your terminal.</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#understanding-the-wizard-flow","title":"Understanding the Wizard Flow","text":"<p>The interactive wizard follows this sequence:</p> <ol> <li>Data Provider (CDS or Open-Meteo - Open-Meteo coming soon)</li> <li>Dataset (ERA5-Land or ERA5)</li> <li>Authentication (API URL and key)</li> <li>Date Range (start and end dates)</li> <li>Geographic Region (bounding box coordinates)</li> <li>Variables (which weather parameters to download)</li> <li>File Handling (what to do with existing files)</li> <li>Parallel Settings (concurrent downloads)</li> <li>Retry Settings (how to handle failures)</li> <li>Confirmation (review and approve)</li> </ol> <p>You can navigate backwards through any of these steps if you need to change something.</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#smart-validation","title":"Smart Validation","text":"<p>The wizard validates your inputs in real-time:</p> <ul> <li>Dates: Must be valid and end \u2265 start</li> <li>Coordinates: Must be within valid ranges (-90 to 90 for lat, -180 to 180 for lon)</li> <li>Variables: Checked against dataset-specific availability</li> <li>API Key: Tested with CDS to ensure it works before proceeding</li> </ul> <p>If something is invalid, you'll get a clear error message and chance to re-enter.</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#batchautomatic-mode-deep-dive","title":"Batch/Automatic Mode Deep Dive","text":"<p>Batch mode is essential for:</p> <ul> <li>Reproducibility: The same config always produces the same download</li> <li>Automation: Integrate into larger data pipelines</li> <li>Version Control: Track exactly what data you downloaded (minus the API key)</li> <li>HPC Workflows: Submit jobs without interactive prompts</li> <li>Team Collaboration: Share standardized configs across researchers</li> </ul>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#basic-usage","title":"Basic Usage","text":"<pre><code>osme-weather --config path/to/config.json\n</code></pre>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#verbose-output","title":"Verbose Output","text":"<p>By default, batch mode only writes to log files. To see progress in your terminal:</p> <pre><code>osme-weather --config path/to/config.json --verbose\n</code></pre> <p>This shows the same output you'd see in interactive mode, but without requiring any input.</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#config-file-structure","title":"Config File Structure","text":"<p>Here's a complete, annotated example:</p> <pre><code>{\n  \"data_provider\": \"cds\",\n  \"dataset_short_name\": \"era5-land\",\n  \"api_url\": \"https://cds.climate.copernicus.eu/api\",\n  \"api_key\": \"12345:abcdef123456789\",\n  \"start_date\": \"2023-01-01\",\n  \"end_date\": \"2023-12-31\",\n  \"region_bounds\": [40.0, -10.0, 35.0, 5.0],\n  \"variables\": [\n    \"2m_temperature\",\n    \"10m_u_component_of_wind\",\n    \"10m_v_component_of_wind\",\n    \"surface_pressure\",\n    \"total_precipitation\"\n  ],\n  \"existing_file_action\": \"skip_all\",\n  \"retry_settings\": {\n    \"max_retries\": 6,\n    \"retry_delay_sec\": 15\n  },\n  \"parallel_settings\": {\n    \"enabled\": true,\n    \"max_concurrent\": 2\n  }\n}\n</code></pre> <p>See the Configuration Reference for detailed documentation of every field.</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#config-file-locations","title":"Config File Locations","text":"<p>The tool looks for config files in this order:</p> <ol> <li>Absolute paths: <code>/home/user/configs/download.json</code></li> <li>Relative to config directory: <code>configs/weather/download.json</code>    (resolved to <code>&lt;repo_root&gt;/configs/weather/download.json</code>)</li> <li>Relative to current directory: <code>./my_config.json</code></li> </ol> <p>We recommend keeping configs in the repository's <code>configs/weather/</code> directory for organization.</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#managing-api-keys-in-configs","title":"Managing API Keys in Configs","text":"<p>Never commit API keys to version control! Here are three safe approaches:</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#option-1-placeholder-manual-edit-simple","title":"Option 1: Placeholder + Manual Edit (Simple)","text":"<p>In your committed config: <pre><code>{\n  \"api_key\": \"YOUR_API_KEY_HERE\",\n  ...\n}\n</code></pre></p> <p>Before running, edit to add your real key (but don't commit the change).</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#option-2-separate-credentials-file-better","title":"Option 2: Separate Credentials File (Better)","text":"<p><code>download_config.json</code> (committed to repo): <pre><code>{\n  \"data_provider\": \"cds\",\n  \"dataset_short_name\": \"era5-land\",\n  \"api_url\": \"https://cds.climate.copernicus.eu/api\",\n  \"api_key\": \"PLACEHOLDER\",\n  ...\n}\n</code></pre></p> <p><code>.env</code> or <code>credentials.json</code> (in <code>.gitignore</code>): <pre><code>{\n  \"CDS_API_KEY\": \"12345:abcdef123456789\"\n}\n</code></pre></p> <p>Then merge them in a script before running (future feature).</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#option-3-environment-variables-best-for-cicd","title":"Option 3: Environment Variables (Best for CI/CD)","text":"<p>Set in your shell: <pre><code>export CDS_API_KEY=\"12345:abcdef123456789\"\n</code></pre></p> <p>Then reference in config (future feature): <pre><code>{\n  \"api_key\": \"${CDS_API_KEY}\",\n  ...\n}\n</code></pre></p> <p>Current Limitation</p> <p>Environment variable substitution is not yet implemented. For now, use Option 1 or 2.</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#provider-specific-details","title":"Provider-Specific Details","text":""},{"location":"osme-weather-data-retrieval-documentation/user-guide/#cds-copernicus-climate-data-store","title":"CDS (Copernicus Climate Data Store)","text":"<p>Currently, the only supported provider. Provides access to ERA5 and ERA5-Land datasets.</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#getting-access","title":"Getting Access","text":"<ol> <li>Register at https://cds.climate.copernicus.eu</li> <li>Accept terms for the datasets you want (ERA5, ERA5-Land)</li> <li>Get your API key from your profile page</li> </ol>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#api-rate-limits","title":"API Rate Limits","text":"<p>The CDS API has request limits:</p> <ul> <li>Max concurrent requests: 4 (per user account)</li> <li>Request queue: If the system is busy, requests wait in a queue</li> <li>Throttling: Large requests may be slowed or delayed during peak hours</li> </ul> <p>The tool handles these automatically with retries and backoff.</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#available-datasets","title":"Available Datasets","text":"<p>ERA5 (<code>era5-world</code>) - Resolution: 0.25\u00b0 (~27 km at equator) - Coverage: Global (land and ocean) - Frequency: Hourly - Variables: 100+ atmospheric, ocean, and land variables - Good for: Global analyses, ocean regions, coarse-resolution studies</p> <p>ERA5-Land (<code>era5-land</code>) - Resolution: 0.1\u00b0 (~11 km at equator) - Coverage: Land surfaces only - Frequency: Hourly - Variables: 50+ land surface variables - Good for: Regional studies, high-resolution land analysis, hydrology</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#variable-names","title":"Variable Names","text":"<p>Variable names must exactly match the CDS dataset specifications (case-sensitive).</p> <p>Common variables:</p> Variable Name Description Units Datasets <code>2m_temperature</code> Temperature at 2m above surface K Both <code>total_precipitation</code> Accumulated precipitation m Both <code>10m_u_component_of_wind</code> Eastward wind at 10m m/s Both <code>10m_v_component_of_wind</code> Northward wind at 10m m/s Both <code>surface_pressure</code> Pressure at surface Pa Both <code>surface_solar_radiation_downwards</code> Incoming solar radiation J/m\u00b2 Both <code>soil_temperature_level_1</code> Top layer soil temperature K ERA5-Land <code>snow_depth</code> Snow depth m ERA5-Land <p>For the complete list, see: - ERA5 variables - ERA5-Land variables</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#open-meteo","title":"Open-Meteo","text":"<p>Coming Soon</p> <p>Open-Meteo integration is planned but not yet available. Check the project roadmap for updates.</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#file-management","title":"File Management","text":""},{"location":"osme-weather-data-retrieval-documentation/user-guide/#output-directory-structure","title":"Output Directory Structure","text":"<p>Downloaded files are organized by dataset:</p> <pre><code>&lt;repo_root&gt;/\n  \u2514\u2500\u2500 data/\n      \u251c\u2500\u2500 era5-land/\n      \u2502   \u2514\u2500\u2500 raw/\n      \u2502       \u251c\u2500\u2500 era5-land_N40W10S35E5_abc123_2023-01.grib\n      \u2502       \u251c\u2500\u2500 era5-land_N40W10S35E5_abc123_2023-02.grib\n      \u2502       \u2514\u2500\u2500 ...\n      \u2514\u2500\u2500 era5-world/\n          \u2514\u2500\u2500 raw/\n              \u251c\u2500\u2500 era5-world_N50W20S30E10_def456_2023-01.grib\n              \u2514\u2500\u2500 ...\n</code></pre> <p>The <code>raw/</code> subdirectory indicates these files haven't been processed yet. Later pipeline stages will create <code>processed/</code>, <code>cleaned/</code>, etc.</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#filename-convention","title":"Filename Convention","text":"<p>Each file follows this pattern:</p> <pre><code>{dataset}_{coordinates}_{hash}_{year}-{month}.{ext}\n</code></pre> <p>Example: <code>era5-land_N40W10S35E5_abc123def456_2023-01.grib</code></p> <ul> <li><code>dataset</code>: <code>era5-land</code> or <code>era5-world</code></li> <li><code>coordinates</code>: Encoded bounding box (N=north, W=west, S=south, E=east)</li> <li><code>hash</code>: 12-character hash of (dataset + variables + region)</li> <li><code>year-month</code>: Data period</li> <li><code>ext</code>: File extension (<code>.grib</code> for CDS downloads)</li> </ul> <p>Why the hash? It lets you distinguish between downloads of the same region but different variables:</p> <pre><code>era5-land_N40W10S35E5_abc123_2023-01.grib  # temperature only\nera5-land_N40W10S35E5_def456_2023-01.grib  # temperature + precipitation\n</code></pre>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#existing-file-handling","title":"Existing File Handling","text":"<p>The <code>existing_file_action</code> setting controls what happens when a file already exists:</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#skip_all-recommended","title":"<code>skip_all</code> (Recommended)","text":"<pre><code>\"existing_file_action\": \"skip_all\"\n</code></pre> <p>Skips any month that already has a complete file. This is: - Fast: No re-downloads - Safe: Doesn't overwrite good data - Resume-friendly: If a download fails partway through, re-running skips completed months</p> <p>When to use: Almost always (default for batch mode)</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#overwrite","title":"<code>overwrite</code>","text":"<pre><code>\"existing_file_action\": \"overwrite\"\n</code></pre> <p>Re-downloads everything, replacing existing files.</p> <p>When to use:  - You know the existing files are corrupted - CDS has updated the dataset and you need the new version - You're testing download settings</p> <p>Warning</p> <p>This can waste a lot of time and bandwidth!</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#prompt-interactive-only","title":"<code>prompt</code> (Interactive Only)","text":"<pre><code>\"existing_file_action\": \"prompt\"\n</code></pre> <p>Asks you for each file whether to skip or overwrite.</p> <p>When to use:  - Interactive mode when you want control over individual files - Not available in batch mode (treated as <code>skip_all</code>)</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#file-validation","title":"File Validation","text":"<p>After downloading, the tool validates each file:</p> <ul> <li>ZIP files: Automatically extracts <code>.grib</code> files</li> <li>Magic number check: Verifies file starts with GRIB signature</li> <li>Size check: Warns if file is suspiciously small (&lt;50 KB)</li> </ul> <p>Corrupted or incomplete downloads are logged as failures and can be retried.</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#download-settings","title":"Download Settings","text":""},{"location":"osme-weather-data-retrieval-documentation/user-guide/#parallel-downloads","title":"Parallel Downloads","text":"<p>Download multiple months simultaneously to speed up large requests.</p> <pre><code>\"parallel_settings\": {\n  \"enabled\": true,\n  \"max_concurrent\": 2\n}\n</code></pre>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#choosing-max_concurrent","title":"Choosing <code>max_concurrent</code>","text":"<ul> <li>1: Sequential (slowest, but most reliable)</li> <li>2: Good default (balances speed and stability)</li> <li>3-4: Faster for large downloads, but risks hitting CDS rate limits</li> <li>5+: Not recommended (may cause timeouts or account warnings)</li> </ul> <p>Connection Speed Matters</p> <p>If you have slow internet (&lt;10 Mbps), parallelization won't help much. Stick with 1-2.</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#efficiency-factor","title":"Efficiency Factor","text":"<p>The tool assumes parallel downloads are about 60% as efficient as perfect linear scaling. For example:</p> <ul> <li>12 files, sequential: 60 minutes</li> <li>12 files, 2 parallel: ~36 minutes (not 30)</li> <li>12 files, 4 parallel: ~22 minutes (not 15)</li> </ul> <p>This accounts for: - CDS queue management - Connection overhead - Retry delays</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#retry-settings","title":"Retry Settings","text":"<p>Handles temporary failures gracefully.</p> <pre><code>\"retry_settings\": {\n  \"max_retries\": 6,\n  \"retry_delay_sec\": 15\n}\n</code></pre>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#how-retries-work","title":"How Retries Work","text":"<ol> <li>Download request sent to CDS</li> <li>If it fails (timeout, connection error, server error), wait <code>retry_delay_sec</code> seconds</li> <li>Try again (up to <code>max_retries</code> times total)</li> <li>If all retries exhausted, mark month as failed and continue to next month</li> </ol>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#common-failure-reasons","title":"Common Failure Reasons","text":"<ul> <li>CDS queue delays: Request waits too long in queue</li> <li>Network hiccups: Temporary connection loss</li> <li>Server overload: CDS is busy during peak hours (usually European daytime)</li> <li>API errors: Rare CDS internal errors</li> </ul> <p>Most failures are temporary and resolve with retries.</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#recommended-settings","title":"Recommended Settings","text":"Scenario max_retries retry_delay_sec Notes Default 3-6 15-30 Good for most cases Unreliable connection 10 30 More patient Fast failure 1-2 10 Fail fast and move on HPC batch job 10 60 Jobs run unattended, be patient"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#speed-estimation","title":"Speed Estimation","text":"<p>Before downloading, the tool:</p> <ol> <li>Tests your internet speed (quick 10-second test)</li> <li>Estimates file sizes based on variables, region, and resolution</li> <li>Calculates total time accounting for processing overhead and parallelization</li> </ol> <p>These are estimates and can vary based on: - CDS server load - Network variability - Actual data density (some months may be larger/smaller)</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#logging","title":"Logging","text":"<p>Every run produces detailed logs with timestamps, parameters, and outcomes.</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#log-file-locations","title":"Log File Locations","text":"<p>Logs are saved to <code>&lt;repo_root&gt;/logs/weather_data_retrieval/</code>:</p> <pre><code>logs/\n  \u2514\u2500\u2500 weather_data_retrieval/\n      \u251c\u2500\u2500 era5-land_N40W10S35E5_abc123_2023-01_2023-12_retrieved-20250210T143022.log\n      \u2514\u2500\u2500 run_automatic_20250210_120045.log\n</code></pre>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#log-file-naming","title":"Log File Naming","text":"<p>Final logs (after successful completion): <pre><code>{filename_base}_{start-date}_{end-date}_retrieved-{timestamp}.log\n</code></pre></p> <p>Temporary logs (if run fails early): <pre><code>run_{mode}_{timestamp}.log\n</code></pre></p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#whats-logged","title":"What's Logged","text":"<p>Each log file contains:</p> <ul> <li>Configuration summary: All parameters used</li> <li>Download estimates: Size and time predictions</li> <li>Progress updates: Each month started/completed</li> <li>Validation results: File checks, size verifications</li> <li>Errors and retries: Failed attempts and retry counts</li> <li>Final summary: Success/skip/fail counts</li> </ul>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#log-levels","title":"Log Levels","text":"<ul> <li>DEBUG: Everything, including prompts and internal state (file only)</li> <li>INFO: Normal progress updates</li> <li>WARNING: Issues that didn't stop the download (e.g., retries)</li> <li>ERROR: Failed downloads or critical issues</li> </ul>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#example-log-excerpt","title":"Example Log Excerpt","text":"<pre><code>2025-02-10 14:30:15 | INFO | Starting AUTOMATIC run\n2025-02-10 14:30:15 | INFO | Configuration validation successful\n2025-02-10 14:30:16 | INFO | Detected speed: 45.3 Mbps\n2025-02-10 14:30:16 | INFO | Estimated total size: 1,234.5 MB\n2025-02-10 14:30:16 | INFO | Estimated total time: 22m 15s\n2025-02-10 14:30:16 | INFO | Beginning download process\n2025-02-10 14:30:45 | INFO | Download completed: 2023-01 (42.3 MB)\n2025-02-10 14:31:12 | WARNING | Download failed: 2023-02 (Connection timeout)\n2025-02-10 14:31:27 | INFO | Retry 1/6: 2023-02\n2025-02-10 14:31:58 | INFO | Download completed: 2023-02 (41.8 MB)\n...\n2025-02-10 14:52:03 | INFO | Download process completed\n2025-02-10 14:52:03 | INFO | Successful: 12, Skipped: 0, Failed: 0\n</code></pre>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#hpc-workflows","title":"HPC Workflows","text":"<p>The package includes shell scripts optimized for HPC job submission.</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#using-the-provided-scripts","title":"Using the Provided Scripts","text":"<p>Located in the package directory:</p> <pre><code># For ERA5-Land downloads\nbash packages/weather_data_retrieval/main_land.sh\n\n# For ERA5 (world) downloads\nbash packages/weather_data_retrieval/main_world.sh\n</code></pre> <p>These scripts: - Load the conda environment - Set up proper paths - Run batch mode with a predefined config - Can be submitted to Slurm, PBS, or other job schedulers</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#example-slurm-submission","title":"Example SLURM Submission","text":"<p>Create a file <code>submit_weather_download.slurm</code>:</p> <pre><code>#!/bin/bash\n#SBATCH --job-name=weather_download\n#SBATCH --output=logs/weather_%j.out\n#SBATCH --error=logs/weather_%j.err\n#SBATCH --time=24:00:00\n#SBATCH --ntasks=1\n#SBATCH --cpus-per-task=4\n#SBATCH --mem=8G\n\n# Load environment\nmodule load anaconda3\nsource activate osme\n\n# Run download\nosme-weather --config configs/weather/era5_india_2023.json --verbose\n</code></pre> <p>Submit with: <pre><code>sbatch submit_weather_download.slurm\n</code></pre></p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#hpc-best-practices","title":"HPC Best Practices","text":"<ol> <li>Use batch mode: No prompts means it can run unattended</li> <li>Set high retry counts: Jobs may run during off-peak hours with better CDS availability</li> <li>Enable verbose logging: Helpful for debugging from log files later</li> <li>Request adequate time: Better to overestimate than have jobs killed</li> <li>Use parallelization: HPC nodes often have good network connections</li> <li>Store in scratch space: Large downloads should go to fast scratch storage, not home directories</li> </ol>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#monitoring-long-jobs","title":"Monitoring Long Jobs","text":"<p>Check progress by tailing the log file:</p> <pre><code>tail -f logs/weather_data_retrieval/era5-land_*.log\n</code></pre> <p>Or check the SLURM output:</p> <pre><code>tail -f logs/weather_12345.out\n</code></pre>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#advanced-patterns","title":"Advanced Patterns","text":""},{"location":"osme-weather-data-retrieval-documentation/user-guide/#multi-region-downloads","title":"Multi-Region Downloads","text":"<p>Download the same time period for multiple regions by using separate configs:</p> <pre><code># Europe\nosme-weather --config configs/weather/era5_europe_2023.json\n\n# Asia\nosme-weather --config configs/weather/era5_asia_2023.json\n\n# Americas\nosme-weather --config configs/weather/era5_americas_2023.json\n</code></pre>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#multi-year-pipelines","title":"Multi-Year Pipelines","text":"<p>For very long time series, break into chunks:</p> <pre><code>for year in {2010..2023}; do\n  echo \"Downloading $year...\"\n  osme-weather --config configs/weather/era5_${year}.json\ndone\n</code></pre> <p>Each config differs only in start/end dates:</p> <pre><code>{\n  \"start_date\": \"2010-01-01\",\n  \"end_date\": \"2010-12-31\",\n  ...\n}\n</code></pre>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#resuming-failed-downloads","title":"Resuming Failed Downloads","text":"<p>If a download fails partway through:</p> <ol> <li>Check the log to see which months succeeded</li> <li>Re-run with the same config \u2013 <code>skip_all</code> will skip completed months</li> <li>Only failed months will be re-attempted</li> </ol> <p>No need to manually track what's missing!</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#testing-configurations","title":"Testing Configurations","text":"<p>Before downloading years of data, test your config with a small date range:</p> <pre><code>{\n  \"start_date\": \"2023-01-01\",\n  \"end_date\": \"2023-01-31\",\n  ...\n}\n</code></pre> <p>Once you verify it works:</p> <pre><code>{\n  \"start_date\": \"2020-01-01\",\n  \"end_date\": \"2023-12-31\",\n  ...\n}\n</code></pre>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#common-workflows","title":"Common Workflows","text":""},{"location":"osme-weather-data-retrieval-documentation/user-guide/#workflow-1-exploratory-research","title":"Workflow 1: Exploratory Research","text":"<p>Goal: Download a small sample to test analysis code</p> <ol> <li>Use interactive mode to explore variables</li> <li>Download 1-3 months of data</li> <li>Develop your analysis pipeline</li> <li>When ready, create a batch config for full download</li> <li>Run the full download overnight or on HPC</li> </ol>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#workflow-2-production-pipeline","title":"Workflow 2: Production Pipeline","text":"<p>Goal: Reproducible data acquisition for published research</p> <ol> <li>Create version-controlled configs in <code>configs/weather/</code></li> <li>Use batch mode for all downloads</li> <li>Document configs in your README (which region, which dates, why)</li> <li>Archive configs with your published research for reproducibility</li> <li>Rerun identical configs if you need to verify or extend results</li> </ol>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#workflow-3-multi-country-comparison","title":"Workflow 3: Multi-Country Comparison","text":"<p>Goal: Compare marginal emissions across countries</p> <ol> <li>Create one config per country with appropriate region bounds</li> <li>Use identical variables and date ranges for fair comparison</li> <li>Name configs clearly: <code>era5_india.json</code>, <code>era5_spain.json</code>, etc.</li> <li>Run downloads in parallel (different terminal sessions or HPC jobs)</li> <li>Use <code>skip_all</code> so you can safely rerun without duplication</li> </ol>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#tips-tricks","title":"Tips &amp; Tricks","text":""},{"location":"osme-weather-data-retrieval-documentation/user-guide/#speed-up-downloads","title":"\ud83d\ude80 Speed Up Downloads","text":"<ul> <li>Use ERA5 (0.25\u00b0) instead of ERA5-Land (0.1\u00b0) if resolution doesn't matter</li> <li>Smaller regions = smaller files = faster downloads</li> <li>Fewer variables = smaller files (do you really need all 20 variables?)</li> <li>Enable parallelization with <code>max_concurrent: 2-3</code></li> <li>Download during off-peak hours (nights/weekends in Europe)</li> </ul>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#save-disk-space","title":"\ud83d\udcbe Save Disk Space","text":"<ul> <li>Compress old files: GRIB files compress well with <code>gzip</code></li> <li>Delete unnecessary intermediate files after processing</li> <li>Use external storage for archives (not actively used data)</li> <li>Sample by month: Do you need every month? Maybe every 3rd month is enough for validation?</li> </ul>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#troubleshooting-downloads","title":"\ud83d\udd27 Troubleshooting Downloads","text":"<ul> <li>Check CDS status: https://cds.climate.copernicus.eu shows system status</li> <li>Retry a different time: CDS is faster at night (Europe timezone)</li> <li>Simplify request: Fewer variables or smaller region may avoid timeouts</li> <li>Check your API key: Expired keys cause authentication failures</li> </ul>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#organizing-configs","title":"\ud83d\udccb Organizing Configs","text":"<p>Suggested structure:</p> <pre><code>configs/\n  \u2514\u2500\u2500 weather/\n      \u251c\u2500\u2500 production/\n      \u2502   \u251c\u2500\u2500 india_2020-2023.json\n      \u2502   \u2514\u2500\u2500 global_2022.json\n      \u251c\u2500\u2500 testing/\n      \u2502   \u2514\u2500\u2500 quick_test.json\n      \u2514\u2500\u2500 archive/\n          \u2514\u2500\u2500 old_india_2019.json\n</code></pre>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#sharing-configs-with-team","title":"\ud83d\udd04 Sharing Configs with Team","text":"<p>Use a template pattern:</p> <p>Template (<code>configs/weather/template_country.json</code>): <pre><code>{\n  \"data_provider\": \"cds\",\n  \"dataset_short_name\": \"era5-land\",\n  \"api_key\": \"YOUR_API_KEY_HERE\",\n  \"start_date\": \"YYYY-MM-DD\",\n  \"end_date\": \"YYYY-MM-DD\",\n  \"region_bounds\": [N, W, S, E],\n  \"variables\": [\"2m_temperature\", \"total_precipitation\"],\n  \"existing_file_action\": \"skip_all\",\n  \"retry_settings\": {\"max_retries\": 6, \"retry_delay_sec\": 15},\n  \"parallel_settings\": {\"enabled\": true, \"max_concurrent\": 2}\n}\n</code></pre></p> <p>Team members copy and fill in their values.</p>"},{"location":"osme-weather-data-retrieval-documentation/user-guide/#whats-next","title":"What's Next?","text":"<ul> <li>Dive deeper into configs: See Configuration Reference for every parameter</li> <li>Having issues?: Check Troubleshooting for solutions</li> <li>Understand the code: Browse the API Reference</li> <li>Continue the pipeline: Move to grid_data_retrieval</li> </ul>"}]}